---
description: Initialize RSpec testing plugin configuration
---

# RSpec Init Command

One-time initialization. Creates configuration for rspec-testing plugin.

## Usage

```
/rspec-init           # initialize in current project
/rspec-init --force   # overwrite existing config
```

## What It Does

1. Check Ruby runtime availability
2. Parse Gemfile for test gems (RSpec, FactoryBot, Fabrication)
3. Detect linter (RuboCop or StandardRB)
4. Scan spec directory structure
5. Create `.claude/rspec-testing-config.yml`
6. Provide CLAUDE.md integration guidance

## Prerequisites

This command has NO prerequisites (it creates them for other commands).

## Phase 1: Environment Detection

### 1.1 Check Ruby

```bash
ruby --version
```

If Ruby not found:
```
Ruby runtime not found.

This plugin requires Ruby to analyze code and run tests.
Install Ruby and ensure it's in your PATH.
```

### 1.2 Parse Gemfile

```bash
# Check for test gems
grep -E "rspec|factory_bot|fabrication" Gemfile
```

Detect:
- `rspec-rails` or `rspec` → RSpec version
- `factory_bot_rails` or `factory_bot` → FactoryBot
- `fabrication` → Fabrication gem
- Neither → no factory library

### 1.3 Detect Linter

Check for config files:
- `.rubocop.yml` or `.rubocop_todo.yml` → RuboCop
- `.standard.yml` or `standard` in Gemfile → StandardRB
- Neither → no linter configured

### 1.4 Scan Spec Directory

```bash
# Check spec structure
ls -la spec/
ls spec/spec_helper.rb spec/rails_helper.rb 2>/dev/null
ls -d spec/factories 2>/dev/null
```

Detect:
- `spec_helper.rb` vs `rails_helper.rb` (Rails project?)
- `spec/factories/` directory exists
- `spec/support/` directory exists

## Phase 2: Create Config

### 2.1 Ensure .claude/ Directory Exists

```bash
mkdir -p .claude
```

### 2.2 Generate Config File

Create `.claude/rspec-testing-config.yml`:

```yaml
# RSpec Testing Plugin Configuration
# Generated by /rspec-init
#
# Reference from CLAUDE.md:
#   See .claude/rspec-testing-config.yml for RSpec plugin settings

ruby_version: "3.2.2"

rspec:
  version: "3.12"
  helper: rails_helper  # or spec_helper

factory_gem: factory_bot  # or fabrication, or none

linter: rubocop  # or standardrb, or none

directories:
  spec: spec
  factories: spec/factories
  support: spec/support

initialized_at: "2024-01-15T10:30:00Z"
```

## Phase 3: User Guidance

### 3.1 Show Summary

```
RSpec testing plugin initialized!

Config: .claude/rspec-testing-config.yml

Detected:
  Ruby:        3.2.2
  RSpec:       3.12
  Factory gem: factory_bot
  Linter:      rubocop
  Spec helper: rails_helper

Directories:
  Specs:     spec/
  Factories: spec/factories/
```

### 3.2 Suggest CLAUDE.md Integration

```
To complete setup, add to your CLAUDE.md:

  ## RSpec Testing Plugin
  See .claude/rspec-testing-config.yml for configuration.

Commands available:
  /rspec-cover <file>       # generate tests for code
  /rspec-refactor <spec>    # improve existing tests
```

## Re-initialization

If config already exists (without --force):

Use AskUserQuestion:
```
Config already exists: .claude/rspec-testing-config.yml

Options:
- Overwrite — re-detect everything, replace config
- Cancel — keep existing config
```

With `--force`: overwrite without asking.

## Error Handling

### No Gemfile Found

```
No Gemfile found in current directory.

This plugin is designed for Ruby projects with Bundler.
Ensure you're in the project root directory.
```

### No RSpec in Gemfile

```
RSpec not found in Gemfile.

Add RSpec to your Gemfile:
  gem 'rspec-rails', '~> 6.0'

Then run:
  bundle install
  rails generate rspec:install
```

### No spec/ Directory

```
No spec/ directory found.

Initialize RSpec first:
  bundle exec rails generate rspec:install

Or for non-Rails:
  bundle exec rspec --init
```

## Output Format

On success:

```yaml
status: success
config_file: .claude/rspec-testing-config.yml
detected:
  ruby_version: "3.2.2"
  rspec_version: "3.12"
  factory_gem: factory_bot
  linter: rubocop
```

On error:

```yaml
status: error
error: "RSpec not found in Gemfile"
suggestion: "Add gem 'rspec-rails' to Gemfile and run bundle install"
```
