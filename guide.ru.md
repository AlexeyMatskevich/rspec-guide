# RSpec Style Guide

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

### –ü—Ä–æ RSpec –∏ —Ç—Ä–∏ –∏–¥–µ–∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
- [–ü—Ä–æ RSpec](#–ø—Ä–æ-rspec)
- [–¢—Ä–∏ –∏–¥–µ–∏ —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞](#—Ç—Ä–∏-–∏–¥–µ–∏-—ç—Ç–æ–≥–æ-—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞)
- [–ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: "–ü–æ—á–µ–º—É –º–æ–π —Ç–µ—Å—Ç –ø–ª–æ—Ö–æ –ø–∞—Ö–Ω–µ—Ç?"](#–±—ã—Å—Ç—Ä–∞—è-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞-–ø–æ—á–µ–º—É-–º–æ–π-—Ç–µ—Å—Ç-–ø–ª–æ—Ö–æ-–ø–∞—Ö–Ω–µ—Ç)

### –ß–∞—Å—Ç—å 1: –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

- [1. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é](#1-—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ-–ø–æ–≤–µ–¥–µ–Ω–∏–µ-–∞-–Ω–µ-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é)
- [2. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç –ª–æ–≤–∏—Ç –±–∞–≥–∏](#2-–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ-—á—Ç–æ-—Ç–µ—Å—Ç-–ª–æ–≤–∏—Ç-–±–∞–≥–∏)
- [3. –û–¥–∏–Ω `it` ‚Äî –æ–¥–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ](#3-–æ–¥–∏–Ω-it--–æ–¥–Ω–æ-–ø–æ–≤–µ–¥–µ–Ω–∏–µ)

### –ß–∞—Å—Ç—å 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º

- [4. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º](#4-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π—Ç–µ-—Ç–µ—Å—Ç—ã-–ø–æ-—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º)
  - [4.1 –í—ã–¥–µ–ª–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è](#41-–≤—ã–¥–µ–ª–∏—Ç–µ-—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è)
  - [4.2 –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é: –∑–∞–≤–∏—Å–∏–º—ã–µ ‚Üí –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ](#42-–ø–æ—Å—Ç—Ä–æ–π—Ç–µ-–∏–µ—Ä–∞—Ä—Ö–∏—é-–∑–∞–≤–∏—Å–∏–º—ã–µ--–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ)
  - [4.3 –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π + –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç](#43-–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π--–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π-—Ç–µ—Å—Ç)
  - [4.4 –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç = –æ–¥–Ω–æ —Ä–∞–∑–ª–∏—á–∏–µ](#44-–∫–∞–∂–¥—ã–π-–∫–æ–Ω—Ç–µ–∫—Å—Ç--–æ–¥–Ω–æ-—Ä–∞–∑–ª–∏—á–∏–µ)
  - [4.5 –ê—É–¥–∏—Ç: –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã](#45-–∞—É–¥–∏—Ç-–¥—É–±–ª–∏–∫–∞—Ç—ã-–∏-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã)

### –ß–∞—Å—Ç—å 3: –ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç

- [5. –¢—Ä–∏ —Ñ–∞–∑—ã: Given / When / Then](#5-—Ç—Ä–∏-—Ñ–∞–∑—ã-given--when--then)
- [6. –û–±—ä—è–≤–ª—è–π—Ç–µ `subject` —è–≤–Ω–æ](#6-–æ–±—ä—è–≤–ª—è–π—Ç–µ-subject-—è–≤–Ω–æ)
- [7. –ù–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π—Ç–µ –≤ —Ç–µ—Å—Ç–∞—Ö](#7-–Ω–µ-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π—Ç–µ-–≤-—Ç–µ—Å—Ç–∞—Ö)
- [8. –Ø–≤–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ DRY](#8-—è–≤–Ω–æ—Å—Ç—å-–≤–∞–∂–Ω–µ–µ-dry)

### –ß–∞—Å—Ç—å 4: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

- [9. FactoryBot: —Ñ–∞–±—Ä–∏–∫–∏, traits, –º–µ—Ç–æ–¥—ã](#9-factorybot-—Ñ–∞–±—Ä–∏–∫–∏-traits-–º–µ—Ç–æ–¥—ã)
  - [9.1 Traits –¥–ª—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫](#91-traits-–¥–ª—è-—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫)
  - [9.2 `attributes_for` –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤](#92-attributes_for-–¥–ª—è-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
  - [9.3 `build_stubbed` –¥–ª—è —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤](#93-build_stubbed-–¥–ª—è-—é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤)

### –ß–∞—Å—Ç—å 5: –Ø–∑—ã–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

- [10. –ü–∏—à–∏—Ç–µ —á–∏—Ç–∞–µ–º—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏](#10-–ø–∏—à–∏—Ç–µ-—á–∏—Ç–∞–µ–º—ã–µ-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)
  - [10.1 context + it = –≤–∞–ª–∏–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ](#101-context--it--–≤–∞–ª–∏–¥–Ω–æ–µ-–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ)
  - [10.2 –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞: Present Simple, –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥](#102-–≥—Ä–∞–º–º–∞—Ç–∏–∫–∞-present-simple-–∞–∫—Ç–∏–≤–Ω—ã–π-–∑–∞–ª–æ–≥)
  - [10.3 –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤: when/with/and/but/NOT](#103-–∫–ª—é—á–µ–≤—ã–µ-—Å–ª–æ–≤–∞-–∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤-whenwithandbutnot)
  - [10.4 RuboCop-–ø—Ä–∞–≤–∏–ª–∞ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è](#104-rubocop-–ø—Ä–∞–≤–∏–ª–∞-–Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è)

### –ß–∞—Å—Ç—å 6: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

- [11. `aggregate_failures` –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤](#11-aggregate_failures-–¥–ª—è-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã—Ö-—Ç–µ—Å—Ç–æ–≤)
- [12. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `any_instance`](#12-–Ω–µ-–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ-any_instance)
- [13. –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ verifying doubles](#13-–ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ-verifying-doubles)
- [14. Shared examples –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤](#14-shared-examples-–¥–ª—è-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤)
- [15. Request specs –≤–º–µ—Å—Ç–æ controller specs](#15-request-specs-–≤–º–µ—Å—Ç–æ-controller-specs)
- [16. –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è](#16-—Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π—Ç–µ-–≤—Ä–µ–º—è)
- [17. –î–µ–ª–∞–π—Ç–µ –≤—ã–≤–æ–¥ –ø–∞–¥–µ–Ω–∏—è —á–∏—Ç–∞–µ–º—ã–º](#17-–¥–µ–ª–∞–π—Ç–µ-–≤—ã–≤–æ–¥-–ø–∞–¥–µ–Ω–∏—è-—á–∏—Ç–∞–µ–º—ã–º)

### –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –∏ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- [–ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ](#—á—Ç–æ-–≤—ã-–ø–æ–ª—É—á–∞–µ—Ç–µ)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-api-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤-–≥—Ä–∞–Ω–∏—Ü—ã-–ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏-rspec)
- [–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã](#–≤–Ω–µ—à–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å—ã)
- [–ù—é–∞–Ω—Å—ã –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É Ruby –∏ PostgreSQL](#–Ω—é–∞–Ω—Å—ã-–≤—Ä–µ–º–µ–Ω–∏-–º–µ–∂–¥—É-ruby-–∏-postgresql)
- [–ú–∏–≥—Ä–∞—Ü–∏—è legacy-—Ç–µ—Å—Ç–æ–≤](#–º–∏–≥—Ä–∞—Ü–∏—è-legacy-—Ç–µ—Å—Ç–æ–≤)
- [–†–µ—Å—É—Ä—Å—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è](#—Ä–µ—Å—É—Ä—Å—ã-–¥–ª—è-–∏–∑—É—á–µ–Ω–∏—è)
- [–ì–ª–æ—Å—Å–∞—Ä–∏–π](#–≥–ª–æ—Å—Å–∞—Ä–∏–π)

---

## –ü—Ä–æ RSpec

RSpec ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Ruby —Å DSL, –∑–∞—Ç–æ—á–µ–Ω–Ω—ã–º –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –ï—ë `describe/context/it` —Å–ª–µ–¥—É—é—Ç BDD-–º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏: —Ç–µ—Å—Ç—ã —Ñ–æ—Ä–º—É–ª–∏—Ä—É—é—Ç –ø—Ä–∞–≤–∏–ª–∞ [–¥–æ–º–µ–Ω–∞](#–¥–æ–º–µ–Ω) –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ, –∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–æ–¥–∞. Given (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ `let`/`before`) ‚Üí When (–¥–µ–π—Å—Ç–≤–∏–µ) ‚Üí Then (–æ–∂–∏–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `expect`) ‚Äî —Ç—Ä–∏ —Ñ–∞–∑—ã, –∑–Ω–∞–∫–æ–º—ã–µ –∏–∑ Gherkin, –ª–µ–∂–∞—Ç –≤ –æ—Å–Ω–æ–≤–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞.

<a id="–ø–∏—Ä–∞–º–∏–¥–∞-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è-–∏-–≤—ã–±–æ—Ä-—É—Ä–æ–≤–Ω—è"></a>
<details>
<summary>BDD, TDD –∏ Gherkin ‚Äî –ø–æ–¥—Ä–æ–±–Ω–µ–µ</summary>

**TDD** (test-driven development) ‚Äî —Ü–∏–∫–ª Red ‚Üí Green ‚Üí Refactor: –ø–∏—à–µ–º —Ç–µ—Å—Ç, —Ñ–∏–∫—Å–∏—Ä—É—é—â–∏–π –∂–µ–ª–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ; –ø–∏—à–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥, —á—Ç–æ–±—ã —Ç–µ—Å—Ç –ø—Ä–æ—à—ë–ª; —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–º, —Å–æ—Ö—Ä–∞–Ω—è—è –∑–µ–ª—ë–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

**BDD** (behaviour-driven development) –≤—ã—Ä–æ—Å –∏–∑ TDD –∏ —Å–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ [–¥–æ–º–µ–Ω–∞](#–¥–æ–º–µ–Ω) –∏ —è–∑—ã–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å –±–∏–∑–Ω–µ—Å–æ–º. –¢–µ—Å—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —á–∏—Ç–∞–µ–º–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–¥–∞.

RSpec –≤–æ–ø–ª–æ—â–∞–µ—Ç BDD –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ Ruby: `describe/context/it` –ø–æ–º–æ–≥–∞—é—Ç —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ.

**Gherkin** ‚Äî —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤: Given (–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç) ‚Üí When (–¥–µ–π—Å—Ç–≤–∏–µ) ‚Üí Then (—Ä–µ–∑—É–ª—å—Ç–∞—Ç). RSpec –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç `.feature`-—Ñ–∞–π–ª—ã, –Ω–æ —Å–ª–µ–¥—É–µ—Ç —Ç–µ–º –∂–µ —Å–º—ã—Å–ª–æ–≤—ã–º —Ñ–∞–∑–∞–º:

| Gherkin | RSpec |
| --- | --- |
| Feature / Story | `describe` ‚Äî –æ–±–ª–∞—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è |
| Scenario | `it` ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä |
| Given | `let`, `before` ‚Äî –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| When | –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ / HTTP-–∑–∞–ø—Ä–æ—Å |
| Then | `expect` ‚Äî –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç |
| And / But | –í–ª–æ–∂–µ–Ω–Ω—ã–µ `context` |

**–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.** BDD —Å—Ç–∞–≤–∏—Ç –≤–æ –≥–ª–∞–≤—É —É–≥–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∂–∏–≤—É—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö: –±—ã—Å—Ç—Ä—ã–µ —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –≤ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏, —Å–µ—Ä–≤–∏—Å–Ω—ã–µ/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ ‚Äî –ø–æ—Å—Ä–µ–¥–∏–Ω–µ, end-to-end –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ ‚Äî –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –ø–æ–º–æ–≥–∞–µ—Ç –Ω–µ —Å–∫–∞—Ç—ã–≤–∞—Ç—å—Å—è –∫ –ø—Ä–æ–≤–µ—Ä–∫–∞–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

| –£—Ä–æ–≤–µ–Ω—å | –í–æ–ø—Ä–æ—Å | –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã |
| --- | --- | --- |
| –Æ–Ω–∏—Ç (–º–æ–¥–µ–ª—å, —Å–µ—Ä–≤–∏—Å) | –ö–∞–∫ –≤–µ–¥—ë—Ç —Å–µ–±—è –º–∞–ª–µ–Ω—å–∫–∏–π –∫—É—Å–æ–∫ –ª–æ–≥–∏–∫–∏? | `expect`, doubles |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π / —Å–µ—Ä–≤–∏—Å–Ω—ã–π | –ö–∞–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤? | Request specs, mailers |
| Request / API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã | –ß—Ç–æ –≤–∏–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç? | Request specs, Pact |
| –°–∏—Å—Ç–µ–º–Ω—ã–π (E2E) | –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è? | Capybara, Cypress |

</details>

## –¢—Ä–∏ –∏–¥–µ–∏ —ç—Ç–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞

–í—Å–µ 17 –ø—Ä–∞–≤–∏–ª –Ω–∏–∂–µ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç —Ç—Ä–∏ —Å–∫–≤–æ–∑–Ω—ã—Ö –∏–¥–µ–∏. –ù–µ –∫–∞–∂–¥–∞—è –∏–∑ –Ω–∏—Ö –∑–≤—É—á–∏—Ç –≤ –∫–∞–∂–¥–æ–º –ø—Ä–∞–≤–∏–ª–µ ‚Äî —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –æ–Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–∞.

**–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞.** –¢–µ—Å—Ç—ã —á–∏—Ç–∞—é—Ç —á–∞—â–µ, —á–µ–º –ø–∏—à—É—Ç. –ü—Ä–∞–≤–∏–ª–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∑–∞–ø–∏—Å–∏ –∏ —è–∑—ã–∫–∞ —Å–Ω–∏–∂–∞—é—Ç *–ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω—é—é* –Ω–∞–≥—Ä—É–∑–∫—É (–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—É—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑-–∑–∞ –ø–ª–æ—Ö–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏) –∏ —É—Å–∏–ª–∏–≤–∞—é—Ç *—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é* (—É—Å–∏–ª–∏—è –Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ –¥–æ–º–µ–Ω–∞). –ö–æ–≥–¥–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤–æ–ø—Ä–æ—Å "–∞ —á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?" –∏–ª–∏ "–æ—Ç–∫—É–¥–∞ —ç—Ç–æ –±–µ—Ä—ë—Ç—Å—è?" ‚Äî –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞.

**–¢–µ—Å—Ç—ã –∫–∞–∫ –∑–µ—Ä–∫–∞–ª–æ –¥–∏–∑–∞–π–Ω–∞.** –°–ª–æ–∂–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚Äî –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞ —Ç–µ—Å—Ç–æ–≤; –æ–Ω–∏ —á–µ—Å—Ç–Ω–æ –æ—Ç—Ä–∞–∂–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–¥–∞. –ï—Å–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–∑–¥—É–≤–∞–µ—Ç—Å—è, –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã —É—Ö–æ–¥—è—Ç –Ω–∞ 5+ —É—Ä–æ–≤–Ω–µ–π, –∞ –±–µ–∑ `any_instance` –Ω–µ –æ–±–æ–π—Ç–∏—Å—å ‚Äî –¥–µ–ª–æ –≤ –¥–∏–∑–∞–π–Ω–µ: –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏, God Object, —Ç–µ—Å–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ. –ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è—Ö: –Ω–µ "–∫–∞–∫ –æ–±–æ–π—Ç–∏ —ç—Ç–æ –≤ —Ç–µ—Å—Ç–∞—Ö?", –∞ "—á—Ç–æ –Ω–µ —Ç–∞–∫ —Å –¥–∏–∑–∞–π–Ω–æ–º –∫–æ–¥–∞?". –í —Ä–µ–¥–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –¥–µ–ª–æ –Ω–µ –≤ –∫–æ–¥–µ ‚Äî —Å–∞–º–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ —Ç–µ—Å—Ç —ç—Ç–æ —á–µ—Å—Ç–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç.

**–¢–µ—Å—Ç—ã –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.** –ö–æ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª–∞ —Å–æ–±–ª—é–¥–µ–Ω—ã, —Ç–µ—Å—Ç-—Å—å—é—Ç —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ. –û—Ç—á—ë—Ç RSpec –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –±–∏–∑–Ω–µ—Å-–¥–æ–∫—É–º–µ–Ω—Ç: –º–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ –∏ –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç, –±–µ–∑ –∑–Ω–∞–Ω–∏—è Ruby. –•–æ—Ä–æ—à–æ –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–ø–µ–∫–∏ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º –ø—Ä–∏–±–ª–∏–∂–∞—é—Ç—Å—è –∫ —Ç–µ—Å—Ç-–∫–µ–π—Å–∞–º QA ‚Äî –∏ –º–æ–≥—É—Ç —Å–ª—É–∂–∏—Ç—å –∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º.

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: "–ü–æ—á–µ–º—É –º–æ–π —Ç–µ—Å—Ç –ø–ª–æ—Ö–æ –ø–∞—Ö–Ω–µ—Ç?"

**–ï—Å–ª–∏ —Ç–µ—Å—Ç —Å–ª–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–∏ —Ü–∏–∫–ª—ã/—É—Å–ª–æ–≤–∏—è? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 7](#7-–Ω–µ-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π—Ç–µ-–≤-—Ç–µ—Å—Ç–∞—Ö)
- ‚úÖ –°–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –ª–∏ describe/context/it –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 10](#10-–ø–∏—à–∏—Ç–µ-—á–∏—Ç–∞–µ–º—ã–µ-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏)
- ‚úÖ –°–∫—Ä—ã—Ç—ã –ª–∏ –¥–µ—Ç–∞–ª–∏ –¥–∞–Ω–Ω—ã—Ö –≤ factories? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 9](#9-factorybot-—Ñ–∞–±—Ä–∏–∫–∏-traits-–º–µ—Ç–æ–¥—ã)

**–ï—Å–ª–∏ —Ç–µ—Å—Ç –¥–æ–ª–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ª–∏ `create` –≤ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 9.3](#93-build_stubbed-–¥–ª—è-—é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤)
- ‚úÖ –ï—Å—Ç—å –ª–∏ –ª–∏—à–Ω–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã? ‚Üí [–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã](#–≤–Ω–µ—à–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å—ã)

**–ï—Å–ª–∏ —Ç–µ—Å—Ç —Ñ–ª–µ–π–∫–∞–µ—Ç (–Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ –ø–∞–¥–∞–µ—Ç):**
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 1](#1-—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ-–ø–æ–≤–µ–¥–µ–Ω–∏–µ-–∞-–Ω–µ-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é)
- ‚úÖ –§–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ª–∏ –≤—Ä–µ–º—è? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 16](#16-—Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π—Ç–µ-–≤—Ä–µ–º—è) –∏ [–ù—é–∞–Ω—Å—ã –≤—Ä–µ–º–µ–Ω–∏](#–Ω—é–∞–Ω—Å—ã-–≤—Ä–µ–º–µ–Ω–∏-–º–µ–∂–¥—É-ruby-–∏-postgresql)
- ‚úÖ –ó–∞–≤–∏—Å–∏—Ç –ª–∏ –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –∑–∞–ø–∏—Å–µ–π? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 1](#1-—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ-–ø–æ–≤–µ–¥–µ–Ω–∏–µ-–∞-–Ω–µ-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é)

**–ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ:**
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 1](#1-—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ-–ø–æ–≤–µ–¥–µ–Ω–∏–µ-–∞-–Ω–µ-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é)
- ‚úÖ –°–∫—Ä—ã—Ç—ã –ª–∏ –¥–µ—Ç–∞–ª–∏ –≤ factories? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 9](#9-factorybot-—Ñ–∞–±—Ä–∏–∫–∏-traits-–º–µ—Ç–æ–¥—ã)

**–ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç, –∫–æ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ test-first –ø–æ–¥—Ö–æ–¥? ‚Üí [–ü—Ä–∞–≤–∏–ª–æ 2](#2-–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ-—á—Ç–æ-—Ç–µ—Å—Ç-–ª–æ–≤–∏—Ç-–±–∞–≥–∏)

---

## –ß–∞—Å—Ç—å 1: –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

–¢–µ—Å—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–∞–±–ª—é–¥–∞–µ–º–æ–µ [–ø–æ–≤–µ–¥–µ–Ω–∏–µ](#–ø–æ–≤–µ–¥–µ–Ω–∏–µ) ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–∂–µ–Ω –¥–ª—è –±–∏–∑–Ω–µ—Å–∞. –ï—Å–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ `it` –Ω–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç, *—á—Ç–æ* –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞, —Ç–µ—Å—Ç –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Å—Ç–∞–Ω–µ—Ç –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ.

–í–æ–∑—å–º—ë–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞. –ü–ª–æ—Ö–æ–π —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –≤—ã–∑–≤–∞–Ω; —Ö–æ—Ä–æ—à–∏–π ‚Äî —á—Ç–æ –∑–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω:

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
describe OrderService do
  it "true" do
    expect(service).to receive(:charge)
    service.place(order)
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ
describe OrderService do
  it "places the order" do
    service.place(order)
    expect(order.status).to eq("placed")
  end
end
```

–í –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç "true", –∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `receive(:charge)` —Å–ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±–æ–º –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –º–µ—Ç–æ–¥–∞. –í —Ö–æ—Ä–æ—à–µ–º ‚Äî `it "places the order"` —Å—Ä–∞–∑—É –æ–±—ä—è—Å–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-—Å–º—ã—Å–ª, –∞ —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å–ø–∏—Å–∞–Ω–∏–µ.

–ï—Å–ª–∏ –≤–∞–º —Å–ª–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏: –ø—É–±–ª–∏—á–Ω—ã–π API –Ω–µ –≤—ã—Ä–∞–∂–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏.

–¢–∞ –∂–µ –ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `match_array` –∏–ª–∏ `contain_exactly`, –∫–æ–≥–¥–∞ –ø–æ—Ä—è–¥–æ–∫ –Ω–µ –≤–∞–∂–µ–Ω:

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–æ—Ä—è–¥–∫—É
expect(some_action).to eq [1, 2, 3]
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–∞–≤
expect(some_action).to match_array [2, 3, 1]
expect(some_action).to contain_exactly(1, 2, 3)
```

–°—Ä–∞–≤–Ω–µ–Ω–∏–µ `eq` –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ç–µ—Å—Ç –∫ –ø–æ—Ä—è–¥–∫—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –≤–µ–¥—ë—Ç –∫ –ª–æ–∂–Ω—ã–º –ø–∞–¥–µ–Ω–∏—è–º ‚Äî –µ—Å–ª–∏ –ø–æ—Ä—è–¥–æ–∫ –≤ –º–∞—Å—Å–∏–≤–µ –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–∑-–∑–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ë–î, –¥—é–∂–∏–Ω–∞ —Ç–µ—Å—Ç–æ–≤ —É–ø–∞–¥—ë—Ç. `match_array` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ—Å—Ç–∞–≤, –∞ –Ω–µ –ø–æ—Ä—è–¥–æ–∫.

–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ `eq` –¥–∞—ë—Ç –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–π diff ("expected [1,2,3] got [2,1,3]" ‚Äî —á—Ç–æ –Ω–µ —Ç–∞–∫?), –∞ `match_array` ‚Äî —è—Å–Ω–æ–µ "missing elements" / "extra elements":

```
# –≤—ã–≤–æ–¥ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å match_array:
expected collection contained: [1, 2, 3]
actual collection contained:   [2, 3]
the missing elements were:     [1]
```

–í —Ü–µ–ª–æ–º, –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∫–∞–∫ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `eq` ‚Äî —ç—Ç–æ –∑–≤–æ–Ω–æ—á–µ–∫. –í–æ–∑–º–æ–∂–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–∞—Ç—á–µ—Ä –∏–∑ `RSpec Expectations`, –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è, –∞ –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã –Ω–µ —Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ.

### 2. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç –ª–æ–≤–∏—Ç –±–∞–≥–∏

–ï—Å–ª–∏ —Å–ª–æ–º–∞—Ç—å –∫–æ–¥, –∞ —Ç–µ—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –∑–µ–ª—ë–Ω—ã–º ‚Äî –æ–Ω –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç. –ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç: —Å–ª–æ–º–∞–π—Ç–µ –∫–æ–¥ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç.

–í –∏–¥–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ TDD —Ü–∏–∫–ª Red ‚Üí Green ‚Üí Refactor –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ç–µ—Å—Ç —Å–Ω–∞—á–∞–ª–∞ –ø–∞–¥–∞–µ—Ç. –ù–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —á–∞—â–µ –ø–∏—à—É—Ç –∫–æ–¥, –ø–æ—Ç–æ–º —Ç–µ—Å—Ç—ã. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–∏—Å–∫—É "–ø–æ–¥–≥–æ–Ω–∫–∏ —Ç–µ—Å—Ç–∞ –ø–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é".

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã
describe NotificationService do
  let(:user) { double(email: 'user@example.com') }
  let(:mailer) { double(deliver_later: true) }

  before { allow(UserMailer).to receive(:notification).and_return(mailer) }

  it 'sends notification to user' do
    service.notify_user(user, 'Hello')
    expect(UserMailer).to have_received(:notification)
  end
end
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç –≤—ã–∑–æ–≤–∞ `notification`, –Ω–æ –Ω–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã. –ï—Å–ª–∏ –∫–æ–¥ –Ω–∞—á–Ω—ë—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `nil` –≤–º–µ—Å—Ç–æ email ‚Äî —Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∑–µ–ª—ë–Ω—ã–º.

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã
it 'sends notification to user' do
  service.notify_user(user, 'Hello')
  expect(UserMailer).to have_received(:notification).with(user.email, 'Hello')
end
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ `nil` –≤–º–µ—Å—Ç–æ `user.email` —Ç–µ—Å—Ç —É–ø–∞–¥—ë—Ç —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

**–ß–µ–∫-–ª–∏—Å—Ç "—Ä—É—á–Ω–æ–π Red"** –ø–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞:

1. ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç (Green)
2. üî® –°–ª–æ–º–∞–π—Ç–µ –∫–æ–¥: –≤–µ—Ä–Ω–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–µ–≤—É—é —Å—Ç—Ä–æ–∫—É, –∏–∑–º–µ–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏–µ
3. ‚ùå –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å (Red)
4. üîÑ –í–µ—Ä–Ω–∏—Ç–µ –∫–æ–¥ –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
5. ‚úÖ –¢–µ—Å—Ç —Å–Ω–æ–≤–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç (Green)

–ï—Å–ª–∏ –Ω–∞ —à–∞–≥–µ 3 —Ç–µ—Å—Ç –æ—Å—Ç–∞–ª—Å—è –∑–µ–ª—ë–Ω—ã–º ‚Äî –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π—Ç–µ: –æ–Ω –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

–†—É—á–Ω–æ–π Red ‚Äî –ø–æ —Å—É—Ç–∏ —Ä—É—á–Ω–∞—è –º—É—Ç–∞—Ü–∏—è –∫–æ–¥–∞. –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç mutation testing: –≥–µ–º [mutant](https://github.com/mbj/mutant) –≤–Ω–æ—Å–∏—Ç –º—É—Ç–∞—Ü–∏–∏ –≤ –∫–æ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (–º–µ–Ω—è–µ—Ç —É—Å–ª–æ–≤–∏—è, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç `nil`, —É–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫–∏) –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç. –ï—Å–ª–∏ –º—É—Ç–∞—Ü–∏—è –≤—ã–∂–∏–ª–∞ ‚Äî —Ç–µ—Å—Ç –Ω–µ –ª–æ–≤–∏—Ç —ç—Ç–æ—Ç –∫–ª–∞—Å—Å –æ—à–∏–±–æ–∫. Mutation testing –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç —Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É, –Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –Ω–∞–π—Ç–∏ —Å–ª–µ–ø—ã–µ –∑–æ–Ω—ã –≤ —Ç–µ—Å—Ç-—Å—å—é—Ç–µ.

### 3. –û–¥–∏–Ω `it` ‚Äî –æ–¥–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–û–ø–∏—Å–∞–Ω–∏–µ –≤ `it` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ–± –æ–¥–Ω–æ–π –±–∏–∑–Ω–µ—Å-–∏—Å—Ç–∏–Ω–µ. –û–¥–∏–Ω `it` = –æ–¥–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ = –æ–¥–Ω–æ –∫–ª—é—á–µ–≤–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ. –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–µ–¥—Å—Ç–≤–∏–π –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞, —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ –∏—Ö –Ω–∞ —Ä–∞–∑–Ω—ã–µ `it`.

–ü—Ä–æ–¥–æ–ª–∂–∏–º —Å `OrderService`:

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –¥–≤–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º it
describe OrderService do
  it "processes order successfully" do
    expect { service.place(order) }.to change(Order, :count).by(1)
    expect(ActionMailer::Base.deliveries.count).to eq(1)
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –∫–∞–∂–¥–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ
describe OrderService do
  it "creates the order" do
    expect { service.place(order) }.to change(Order, :count).by(1)
  end

  it "sends confirmation email" do
    expect { service.place(order) }.to change { ActionMailer::Base.deliveries.count }.by(1)
  end
end
```

"processes order successfully" –ø–∞–¥–∞–µ—Ç –≤ CI. –ß—Ç–æ —Å–ª–æ–º–∞–ª–æ—Å—å ‚Äî –∑–∞–∫–∞–∑ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–ª–∏ –ø–∏—Å—å–º–æ –Ω–µ —É—Ö–æ–¥–∏—Ç? –ï—Å–ª–∏ –ø—Ä–∏ –≤–∏–¥–µ —É–ø–∞–≤—à–µ–≥–æ —Ç–µ—Å—Ç–∞ –Ω—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å ‚Äî —Å—Ç–æ–∏—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å. "creates the order ‚Äî FAILED" –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏. –ü—Ä–æ—Å—Ç–æ–π –∫—Ä–∏—Ç–µ—Ä–∏–π: –µ—Å–ª–∏ –¥–ª—è `it` –Ω—É–∂–Ω–æ –¥–≤–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ("—Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑" –∏ "–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∏—Å—å–º–æ") ‚Äî —ç—Ç–æ –¥–≤–∞ `it`.

–ö–æ–≥–¥–∞ `it` –æ–ø–∏—Å—ã–≤–∞–µ—Ç –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—ä–µ–∫—Ç–∞ (–≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞), –Ω–µ—Å–∫–æ–ª—å–∫–æ `expect` –¥–æ–ø—É—Å—Ç–∏–º—ã ‚Äî —ç—Ç–æ —É–∂–µ —Ç–µ–º–∞ [–ø—Ä–∞–≤–∏–ª–∞ 11](#11-aggregate_failures-–¥–ª—è-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã—Ö-—Ç–µ—Å—Ç–æ–≤).

–ï—Å–ª–∏ –≤ `it` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–≥–æ `expect`, —ç—Ç–æ –æ–±—ã—á–Ω–æ —Å–∏–≥–Ω–∞–ª: –≤—ã –ø—ã—Ç–∞–µ—Ç–µ—Å—å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤–º–µ—Å—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –ß—Ç–æ–±—ã —Ä–∞–∑–¥–µ–ª–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è, –ø–æ–ª–µ–∑–Ω–æ —Ä–∞–∑–ª–∏—á–∞—Ç—å —Ç—Ä–∏ —Ç–∏–ø–∞:

- **–û—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî —Ç–æ, —Ä–∞–¥–∏ —á–µ–≥–æ –≤—ã–∑–≤–∞–ª–∏ –º–µ—Ç–æ–¥: –∑–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω, –ø–ª–∞—Ç—ë–∂ –ø—Ä–æ–≤–µ–¥—ë–Ω, –æ—Ç—á—ë—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω.
- **–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã** ‚Äî —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è: –æ—Ç–ø—Ä–∞–≤–∫–∞ email, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏, –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è.
- **–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** ‚Äî –æ—Ç–∫–∞–∑—ã –∏ edge cases: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Å—Ä–µ–¥—Å—Ç–≤, –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∞–¥—Ä–µ—Å, 403 Forbidden.

–î–ª—è `OrderService#place` —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```ruby
describe OrderService, '#place' do
  context 'when order is valid' do
    # –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Ç–æ, –∑–∞—á–µ–º –≤—ã–∑–≤–∞–ª–∏ –º–µ—Ç–æ–¥
    it 'creates the order' do
      expect { service.place(order) }.to change(Order, :count).by(1)
    end

    # –ø–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç ‚Äî —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    it 'sends confirmation email' do
      expect { service.place(order) }
        .to change { ActionMailer::Base.deliveries.count }.by(1)
    end

    # –ø–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç ‚Äî –µ—â—ë –æ–¥–Ω–æ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
    it 'enqueues inventory sync job' do
      expect { service.place(order) }.to have_enqueued_job(InventorySyncJob)
    end
  end

  # —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –æ—Ç–∫–∞–∑
  context 'when card balance is insufficient' do
    it 'rejects the order' do
      expect(service.place(order).status).to eq('rejected')
    end
  end
end
```

–ö–∞–∂–¥—ã–π `it` ‚Äî –æ–¥–∏–Ω —Ç–∏–ø. –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ: –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–≤–µ—á–∞–µ—Ç ¬´—á—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ¬ª, –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã ‚Äî ¬´—á—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ –ø–æ–ø—É—Ç–Ω–æ¬ª, —Ç–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Äî ¬´—á—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫¬ª. –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã —Ç–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ `it`, –∏ —á–∞—Å—Ç–æ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Ä–æ–≤–Ω–µ –ø–∏—Ä–∞–º–∏–¥—ã: —Ñ–∞–∫—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ –ª—É—á—à–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–µ –º–µ–π–ª–µ—Ä–∞, –∞ –≤ request spec ‚Äî —Å—Ç–∞—Ç—É—Å –∏ –æ—Ç–≤–µ—Ç API.

---

–í—ã –∑–Ω–∞–µ—Ç–µ —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–∫–æ–ª—å–∫–æ –ø–æ–≤–µ–¥–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º `it`. –°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å ‚Äî –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –¥–µ—Å—è—Ç–∫–∏ —Ç–µ—Å—Ç–æ–≤, —á—Ç–æ–±—ã –≤ –Ω–∏—Ö –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å—Å—è.

## –ß–∞—Å—Ç—å 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º

–≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –≤ –∏–µ—Ä–∞—Ä—Ö–∏—é `context`: –æ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.

–ü—è—Ç—å —à–∞–≥–æ–≤: (1) –≤—ã–¥–µ–ª–∏—Ç—å [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, (2) –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –∏–µ—Ä–∞—Ä—Ö–∏—é –æ—Ç –∑–∞–≤–∏—Å–∏–º—ã—Ö –∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º, (3) –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç—ã, (4) –æ—Ñ–æ—Ä–º–∏—Ç—å –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π, (5) –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤. –í –º–∞–Ω—É–∞–ª—å–Ω–æ–º QA —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –∏–∑–≤–µ—Å—Ç–µ–Ω –∫–∞–∫ Decision Table Testing (ISTQB) ‚Äî –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –º–∞—Ç—Ä–∏—Ü—É —É—Å–ª–æ–≤–∏–π –∏ –æ–∂–∏–¥–∞–µ–º—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤ RSpec ‚Äî —ç—Ç–æ —É—Å–ª–æ–≤–∏—è —Ç–∞–±–ª–∏—Ü—ã, `context` ‚Äî —Å—Ç—Ä–æ–∫–∏, `it` ‚Äî –æ–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

–°–Ω–∞—á–∞–ª–∞ ‚Äî –≥–æ—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –ø–æ—Ç–æ–º ‚Äî –∫–∞–∫ –∫ –Ω–µ–º—É –ø—Ä–∏–π—Ç–∏. –¢–∏–ø–∏—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ ‚Äî –ø–ª–æ—Å–∫–∏–π describe, –≥–¥–µ –≤—Å–µ —Ç–µ—Å—Ç—ã –ª–µ–∂–∞—Ç –≤ –æ–¥–Ω–æ–º –±–ª–æ–∫–µ:

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –ø–ª–æ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫, –Ω–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
describe OrderService, '#place' do
  it 'places the order with card and sufficient balance' do
    order = build(:order, :with_card, card_balance: 10_000, address: build(:address, :valid))
    expect(described_class.new.place(order).status).to eq('placed')
  end

  it 'rejects the order with insufficient balance' do
    order = build(:order, :with_card, card_balance: 0, address: build(:address, :valid))
    expect(described_class.new.place(order).status).to eq('rejected')
  end

  it 'rejects the order without card' do
    order = build(:order, :without_card)
    expect(described_class.new.place(order).status).to eq('rejected')
  end

  it 'rejects the order with invalid address' do
    order = build(:order, :with_card, card_balance: 10_000, address: build(:address, :invalid))
    expect(described_class.new.place(order).status).to eq('rejected')
  end
end
```

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–æ–ø–ª–∞—Ç–∞, –±–∞–ª–∞–Ω—Å, –∞–¥—Ä–µ—Å) —É—Ç–æ–ø–ª–µ–Ω—ã –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ ‚Äî –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –≤—ã—á–∏—Å–ª—è—Ç—å, —á–µ–º –æ–¥–∏–Ω —Ç–µ—Å—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥—Ä—É–≥–æ–≥–æ. –í–æ—Ç –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:

```ruby
describe OrderService, '#place' do
  subject(:result) { described_class.new.place(order) }

  let(:order) { build(:order, :with_card, card_balance: card_balance, address: address) }

  context 'when user has a payment card' do
    context 'and card balance covers the price' do
      let(:card_balance) { order.total + 100 }

      context 'with valid shipping address' do
        let(:address) { build(:address, :valid) }

        it 'places the order' do
          expect(result.status).to eq('placed')
        end
      end

      context 'with invalid shipping address' do
        let(:address) { build(:address, :invalid) }

        it 'rejects the order' do
          expect(result.status).to eq('rejected')
          expect(result.error).to include('address')
        end
      end
    end

    context 'but card balance does NOT cover the price' do
      let(:card_balance) { 0 }
      let(:address) { build(:address, :valid) }

      it 'rejects the order with insufficient funds' do
        expect(result.status).to eq('rejected')
        expect(result.error).to include('insufficient')
      end
    end
  end

  context 'when user has NO payment card' do
    let(:order) { build(:order, :without_card) }

    it 'rejects the order' do
      expect(result.status).to eq('rejected')
    end
  end
end
```

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–∏–¥–Ω—ã –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (—Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã ‚Üí –±–∞–ª–∞–Ω—Å ‚Üí –∞–¥—Ä–µ—Å), happy path –∏–¥—ë—Ç –ø–µ—Ä–≤—ã–º, –∫–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞—ë—Ç —Å–≤–æ—ë —Ä–∞–∑–ª–∏—á–∏–µ —á–µ—Ä–µ–∑ `let`. –ù–∏–∂–µ ‚Äî –∫–∞–∫ –∫ —ç—Ç–æ–º—É –ø—Ä–∏–π—Ç–∏ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º.

#### 4.1 –í—ã–¥–µ–ª–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

[–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞) ‚Äî –¥–æ–º–µ–Ω–Ω—ã–π –∞—Å–ø–µ–∫—Ç, –≤–ª–∏—è—é—â–∏–π –Ω–∞ –∏—Å—Ö–æ–¥ –ø–æ–≤–µ–¥–µ–Ω–∏—è (—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã, —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞). [–°–æ—Å—Ç–æ—è–Ω–∏–µ](#—Å–æ—Å—Ç–æ—è–Ω–∏–µ) ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∑–Ω–∞—á–µ–Ω–∏—è (–ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –±–∞–ª–∞–Ω—Å –Ω–∏–∂–µ –ª–∏–º–∏—Ç–∞).

–ö–∞–∫ –Ω–∞–π—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É: —Å–ø—Ä–æ—Å–∏—Ç–µ "–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∞—Å–ø–µ–∫—Ç, –∏–∑–º–µ–Ω–∏—Ç—Å—è –ª–∏ –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?". –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–µ—á—å –æ –±–∏–∑–Ω–µ—Å-—Ñ–∞–∫—Ç–µ, –∞ –Ω–µ –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–µ—Ç–∞–ª–∏ (`user has subscription`, –∞ –Ω–µ `premium_flag`).

–ö–∞–∫ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è: –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –±–∏–∑–Ω–µ—Å. –ß–∏—Å–ª–æ–≤—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã –≥—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω—ã, –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ. –ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã—Ä–∞–∂–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º `context`.

–î–ª—è `OrderService#place` —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–∞–∫–æ–≤—ã:

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –°–æ—Å—Ç–æ—è–Ω–∏—è | –¢–∏–ø |
| --- | --- | --- |
| –°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã | –µ—Å—Ç—å –∫–∞—Ä—Ç–∞ / –Ω–µ—Ç –∫–∞—Ä—Ç—ã | –±–∏–Ω–∞—Ä–Ω–∞—è |
| –ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã | –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π / –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ / –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–π | –¥–∏–∞–ø–∞–∑–æ–Ω |
| –ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ | –≤–∞–ª–∏–¥–Ω—ã–π / –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π | –±–∏–Ω–∞—Ä–Ω–∞—è |

**–ì—Ä–∞–Ω–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤.** –í —Ç–∞–±–ª–∏—Ü–µ –±–∞–ª–∞–Ω—Å –∑–∞–ø–∏—Å–∞–Ω –∫–∞–∫ –¥–∏–∞–ø–∞–∑–æ–Ω ‚Äî –∑–Ω–∞—á–∏—Ç, –≥–¥–µ-—Ç–æ –µ—Å—Ç—å —Ç–æ—á–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞. –ï—Å–ª–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ `balance >= order.total`, —Ç–æ –ø—Ä–∏ `balance == order.total` –∑–∞–∫–∞–∑ –ø—Ä–æ—Ö–æ–¥–∏—Ç –∏–ª–∏ –Ω–µ—Ç? –ë–µ–∑ —Ç–µ—Å—Ç–∞ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –≤—ã —ç—Ç–æ–≥–æ –Ω–µ –∑–Ω–∞–µ—Ç–µ.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏—â–∏—Ç–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ –∏ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ç—Ä–∏ —Ç–æ—á–∫–∏: —É–≤–µ—Ä–µ–Ω–Ω–æ –≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞, —Ä–æ–≤–Ω–æ –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ, –∏ —Å—Ä–∞–∑—É –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π.

```ruby
context 'and card balance covers the price' do
  let(:card_balance) { order.total + 100 }

  it 'places the order' do
    expect(result.status).to eq('placed')
  end
end

context 'and card balance exactly equals the price' do
  let(:card_balance) { order.total }

  it 'places the order' do
    expect(result.status).to eq('placed')  # –≥—Ä–∞–Ω–∏—Ü–∞ ‚Äî –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–æ –∂–µ
  end
end

context 'but card balance does NOT cover the price' do
  let(:card_balance) { order.total - 1 }

  it 'rejects the order with insufficient funds' do
    expect(result.status).to eq('rejected')
  end
end
```

–í –æ—Å–Ω–æ–≤–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ –±–∞–ª–∞–Ω—Å —É–ø—Ä–æ—â—ë–Ω –¥–æ –¥–≤—É—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏; –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ. –í –º–∞–Ω—É–∞–ª—å–Ω–æ–º QA —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è Boundary Value Analysis ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–≤–Ω–æ –Ω–∞ —Ç–æ—á–∫–µ –ø–µ—Ä–µ—Ö–æ–¥–∞, –≥–¥–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç—Å—è.

**–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∏ –≤–Ω–µ—à–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏.** –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è –ø–æ –∏—Å—Ç–æ—á–Ω–∏–∫—É —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∏ —ç—Ç–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ç–µ—Å—Ç–∞.

- **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Å–∞–º–∏–º –æ–±—ä–µ–∫—Ç–æ–º: `account.verified?`, `order.cancelled?`, `user.role`. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É –∏–ª–∏ `let` –Ω–∞–ø—Ä—è–º—É—é.
- **–í–Ω–µ—à–Ω—è—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞** ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏—Ö–æ–¥–∏—Ç –æ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –ø–ª–∞—Ç—ë–∂–Ω—ã–π —à–ª—é–∑ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É, –≤–Ω–µ—à–Ω–∏–π API –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª, –æ—á–µ—Ä–µ–¥—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞–± –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

```ruby
# –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∞–±—Ä–∏–∫–æ–π
context 'when user has a payment card' do
  let(:user) { create(:user, :with_card) }
  # ...
end

# –≤–Ω–µ—à–Ω—è—è ‚Äî —Å—Ç–∞–±–∏–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
context 'when payment gateway accepts the charge' do
  before { allow(gateway).to receive(:charge).and_return(Success.new) }
  # ...
end
```

–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ **—Å–≤–æ–∏** –≤–µ—Ç–∫–∏, –∞ –Ω–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –ï—Å–ª–∏ `PaymentGateway` –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å 10 —Ä–∞–∑–Ω—ã—Ö –æ—à–∏–±–æ–∫, –Ω–æ `OrderService#place` —Ä–∞–∑–ª–∏—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ ¬´—É—Å–ø–µ—Ö¬ª, ¬´–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ —Å—Ä–µ–¥—Å—Ç–≤¬ª –∏ ¬´–≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ¬ª ‚Äî —ç—Ç–æ —Ç—Ä–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∞ –Ω–µ –¥–µ—Å—è—Ç—å. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **–Ω–∞—à–∏–º –≤–µ—Ç–≤–ª–µ–Ω–∏–µ–º**, –∞ –Ω–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

–û—Ç—Å—é–¥–∞ —Å–ª–µ–¥—É–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏: –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∞–±—Ä–∏–∫–æ–π, –≤–Ω–µ—à–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî —Å—Ç–∞–±–∏–º —á–µ—Ä–µ–∑ `allow`. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ä–∞–±–æ—Ç–µ —Å–æ —Å—Ç–∞–±–∞–º–∏ –∏ –¥—É–±–ª—ë—Ä–∞–º–∏ ‚Äî [–ø—Ä–∞–≤–∏–ª–∞ 12-13](#12-–Ω–µ-–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ-any_instance).

<a id="42-–ø–æ—Å—Ç—Ä–æ–π—Ç–µ-–∏–µ—Ä–∞—Ä—Ö–∏—é-–∑–∞–≤–∏—Å–∏–º—ã–µ--–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ"></a>

#### 4.2 –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é: –∑–∞–≤–∏—Å–∏–º—ã–µ ‚Üí –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –±—ã–≤–∞—é—Ç:

- **–∑–∞–≤–∏—Å–∏–º—ã–µ** ‚Äî –±–µ–∑ –±–∞–∑–æ–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —É—Ç–æ—á–Ω—è—é—â–∞—è –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ (–Ω–µ—Ç –∫–∞—Ä—Ç—ã ‚Üí –Ω–µ—Ç –±–∞–ª–∞–Ω—Å–∞);
- **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ** ‚Äî –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞ (—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ñ–ª–∞–≥ beta-—Ç–µ—Å—Ç–∞).

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –í—ã–ø–∏—à–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
2. –û—Ç–º–µ—Ç—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: B –∑–∞–≤–∏—Å–∏—Ç –æ—Ç A, –µ—Å–ª–∏ B –æ—Å–º—ã—Å–ª–µ–Ω–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ A.
3. –î–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ `context` –æ—Ç –±–∞–∑–æ–≤–æ–π –∫ —É—Ç–æ—á–Ω—è—é—â–µ–π, —É–ø–æ—Ä—è–¥–æ—á–∏–≤: **happy path –ø–µ—Ä–≤—ã–º**, corner cases –Ω–∏–∂–µ.

**–ó–∞–≤–∏—Å–∏–º—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

```ruby
describe '#purchase' do
  context 'when user has a payment card' do               # happy path: –∫–∞—Ä—Ç–∞ –µ—Å—Ç—å
    context 'and card balance covers the price' do         # happy path: –±–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
      it 'charges the card'
    end

    context 'but card balance does NOT cover the price' do # corner case
      it 'rejects the purchase'
    end
  end

  context 'when user has NO payment card' do               # corner case: –∫–∞—Ä—Ç—ã –Ω–µ—Ç
    it 'rejects the purchase'
  end
end
```

–ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω: —á–∏—Ç–∞—Ç–µ–ª—å —Å–Ω–∞—á–∞–ª–∞ –≤–∏–¥–∏—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π ("–∫–∞—Ä—Ç–∞ –µ—Å—Ç—å, –±–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω, –≤—Å—ë —Ö–æ—Ä–æ—à–æ"), –∞ –ø–æ—Ç–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è. –ï—Å–ª–∏ happy path –∑–∞—Ç–µ—Ä—è–Ω –≤–Ω–∏–∑—É ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞:

```ruby
# –ø–ª–æ—Ö–æ ‚Äî happy path –∑–∞—Ç–µ—Ä—è–Ω
describe '#enroll' do
  context 'when enrollment is rejected because email is invalid' do
    it('shows a validation error') { ... }
  end

  context 'when enrollment is rejected because plan is sold out' do
    it('puts the user on the waitlist') { ... }
  end

  context 'when enrollment is accepted' do # ‚Üê happy path –≤–Ω–∏–∑—É
    it('activates the membership') { ... }
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî happy path –ø–µ—Ä–≤—ã–º
describe '#enroll' do
  context 'when enrollment is accepted' do
    it('activates the membership') { ... }
  end

  context 'when enrollment is rejected because email is invalid' do
    it('shows a validation error') { ... }
  end

  context 'when enrollment is rejected because plan is sold out' do
    it('puts the user on the waitlist') { ... }
  end
end
```

**–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**

```ruby
describe '#feature_access' do
  context 'when user role is admin' do
    it('grants access to admin tools') { ... }

    context 'and beta feature is enabled' do
      it('grants access to beta tools') { ... }
    end

    context 'but beta feature is disabled' do
      it('falls back to standard tools') { ... }
    end
  end

  context 'when user role is customer' do
    it('denies access to admin tools') { ... }

    context 'and beta feature is enabled' do
      it('grants access to beta tools') { ... }
    end

    context 'but beta feature is disabled' do
      it('denies access to beta tools') { ... }
    end
  end
end
```

–ö–æ–≥–¥–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –±–æ–ª—å—à–µ 3-4, –ø–æ–ª–Ω—ã–π –ø–µ—Ä–µ–±–æ—Ä –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –Ω–µ–ø—Ä–∞–∫—Ç–∏—á–µ–Ω (2‚Å¥ = 16 –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤). –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ –ø–∞—Ä–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª—å–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∏ –Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏—è—Ö. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∫—Ä—ã—Ç–∏—è ‚Äî [Pairwise Testing](https://www.pairwise.org/).

**–ù–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —É—Ä–æ–≤–Ω–µ** –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è –æ–¥–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω–∞ –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç:

```ruby
# request spec: –¥–µ—Ç–∞–ª–∏ –¥–æ–º–µ–Ω–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã
describe 'POST /api/payments' do
  context 'when user is authenticated' do
    context 'with valid payment prerequisites' do
      let(:user) { create(:user, :authenticated, :with_verified_card, :with_sufficient_balance) }

      it 'processes payment successfully' do
        post "/api/payments", params: { amount: 100 }
        expect(response).to have_http_status(:created)
      end
    end

    context 'when card is not verified' do
      let(:user) { create(:user, :authenticated, :with_unverified_card) }

      it 'returns 422 Unprocessable Entity' do
        post "/api/payments", params: { amount: 100 }
        expect(response).to have_http_status(:unprocessable_entity)
      end
    end
  end

  context 'when user is not authenticated' do
    it 'returns 401 Unauthorized' do
      post "/api/payments", params: { amount: 100 }
      expect(response).to have_http_status(:unauthorized)
    end
  end
end
```

**–¢–∏–ø–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–æ—ë–≤ –¥–ª—è request specs:**

```ruby
context 'when user is authenticated' do               # –°–ª–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  context 'when user is authorized' do                 # –°–ª–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    context 'with valid domain prerequisites' do       # –î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π
      it 'performs the action' do ... end               # happy path
    end

    context 'when domain prerequisite violated' do
      it 'returns domain error' do ... end              # corner case –¥–æ–º–µ–Ω–∞
    end
  end

  context 'when user is NOT authorized' do
    it 'returns 403 Forbidden' do ... end               # corner case –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  end
end

context 'when user is NOT authenticated' do
  it 'returns 401 Unauthorized' do ... end              # corner case –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
end
```

–ö–∞–∂–¥—ã–π —É—Ä–æ–≤–µ–Ω—å –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ = –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–ª–æ—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏. –ú–∞—Ä–∫–µ—Ä –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è: –µ—Å–ª–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç (`PaymentService`), –∑–Ω–∞—á–∏—Ç –≤ request spec –¥–µ—Ç–∞–ª–∏ –¥–æ–º–µ–Ω–∞ –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å. –î–ª—è corner cases –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ ‚Äî –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö.

**–ö–æ–≥–¥–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å —Å–ª–∏—à–∫–æ–º –≥–ª—É–±–æ–∫–∞:** –ï—Å–ª–∏ –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ —É—Ö–æ–¥–∏—Ç –≥–ª—É–±–∂–µ 3-4 —É—Ä–æ–≤–Ω–µ–π ‚Äî –¥–µ–ª–æ –Ω–µ –≤ —Ç–µ—Å—Ç–µ, –∞ –≤ –∫–æ–¥–µ: –º–µ—Ç–æ–¥ –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ. –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:
- **–°–º–µ—à–∏–≤–∞–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏** ‚Äî –º–µ—Ç–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π, –∏ —Å –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º–∏ –¥–µ—Ç–∞–ª—è–º–∏. –í—ã–Ω–µ—Å–∏—Ç–µ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥.
- **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å** ‚Äî –º–µ—Ç–æ–¥ —Ä–µ—à–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–¥–∞—á. –†–∞–∑–±–µ–π—Ç–µ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–µ—Ç–æ–¥–æ–≤, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –¥–µ–ª–∞–µ—Ç –æ–¥–Ω–æ –¥–µ–ª–æ.
- **–ù–µ—á—ë—Ç–∫–∏–µ –≥—Ä–∞–Ω–∏—Ü—ã —Å–ª–æ—ë–≤** ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, –∏–ª–∏ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Å HTTP. –†–∞–∑–¥–µ–ª–∏—Ç–µ —Å–ª–æ–∏ (controller ‚Üí service ‚Üí repository).

#### 4.3 –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π + –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç

–ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ happy path ‚Äî –≤—ã –Ω–µ —É–∑–Ω–∞–µ—Ç–µ, —á—Ç–æ –∫–æ–¥ –º–æ–ª—á–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ. –ö–∞–∂–¥–∞—è –≤–µ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π, –∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –Ω—É–∂–µ–Ω –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∏ –æ–¥–∏–Ω ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –æ—Ç–∫–∞–∑. –¢–∞–∫ –º—ã –∑–∞—â–∏—â–∞–µ–º—Å—è –æ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã (—Å–º. —Ç–∞–∫–∂–µ [–ø—Ä–∞–≤–∏–ª–æ 2](#2-–ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ-—á—Ç–æ-—Ç–µ—Å—Ç-–ª–æ–≤–∏—Ç-–±–∞–≥–∏) ‚Äî —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞).

```ruby
# –ø–ª–æ—Ö–æ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç
describe "#some_action" do
  let(:user) { build :user, blocked: blocked, blocked_at: blocked_at }

  context "when user is blocked by admin" do
    let(:blocked) { true }

    context "and blocking duration is over a month" do
      let(:blocked_at) { 2.month.ago }

      it "allows unlocking the user" do
        expect(some_action).to be(true)
      end
    end
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –æ–±–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
describe "#some_action" do
  let(:user) { build :user, blocked: blocked, blocked_at: blocked_at }

  context "when user is blocked by admin" do
    let(:blocked) { true }

    context "and blocking duration is over a month" do
      let(:blocked_at) { 2.month.ago }
      it("allows unlocking the user") { ... }
    end

    context "but blocking duration is under a month" do
      let(:blocked_at) { 1.month.ago }
      it("does NOT allow unlocking the user") { ... }
    end
  end

  context "when user is NOT blocked by admin" do
    let(:blocked) { false }
    it("does NOT allow unlocking the user") { ... }
  end
end
```

–ë–µ–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Ç–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –Ω–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è: –æ–Ω–∏ –Ω–µ –æ—Ç—Ä–∞–∑—è—Ç —Ñ–∞–∫—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∫–æ–¥–µ.

#### 4.4 –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç = –æ–¥–Ω–æ —Ä–∞–∑–ª–∏—á–∏–µ

–ï—Å–ª–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å `let` –≤—ã—à–µ –ø–æ —Ñ–∞–π–ª—É ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–æ–∏—Ç –Ω–µ –Ω–∞ –º–µ—Å—Ç–µ. `let`, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Ç–∏–Ω–Ω—ã–º, –¥–æ–ª–∂–µ–Ω —Å—Ç–æ—è—Ç—å —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `context "..." do`. –ï—Å–ª–∏ –º–µ–∂–¥—É `context` –∏ `it` –ø—É—Å—Ç–æ ‚Äî –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω–µ –Ω—É–∂–µ–Ω.

```ruby
# –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞–ª–µ–∫–æ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
describe "#some_action" do
  let(:user) { build :user }
  let(:blocked_user) { build :user, blocked: true }
  let(:old_blocked_user) { build :user, blocked: true, blocked_at: 2.month.ago }

  it "does NOT allow unlocking the user" do
    expect(user.some_action).to be(false)
  end

  context "when user is blocked by admin" do
    # –ø—É—Å—Ç–æ ‚Äî –æ—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è blocked_user?
    it "allows unlocking the user" do
      expect(blocked_user.some_action).to be(true)
    end

    context "and blocking duration is over a month" do
      # —Ç–æ–∂–µ –ø—É—Å—Ç–æ ‚Äî –∫–∞–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è?
      it "allows unlocking the user" do
        expect(old_blocked_user.some_action).to be(true)
      end
    end
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ –º–µ—Å—Ç–µ
describe "#some_action" do
  let(:blocked) { false }
  let(:blocked_at) { nil }
  let(:user) { build :user, blocked: blocked, blocked_at: blocked_at }
  subject(:result) { user.some_action }

  it "does NOT allow unlocking the user" do
    expect(result).to be(false)
  end

  context "when user is blocked by admin" do
    let(:blocked) { true } # ‚Üê –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ

    context "and blocking duration is over a month" do
      let(:blocked_at) { 2.month.ago } # ‚Üê —Ç–æ–∂–µ –∑–¥–µ—Å—å

      it "allows unlocking the user" do
        expect(result).to be(true)
      end
    end

    context "but blocking duration is under a month" do
      let(:blocked_at) { 1.month.ago }

      it "does NOT allow unlocking the user" do
        expect(result).to be(false)
      end
    end
  end
end
```

–í –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ —á–∏—Ç–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∏—Å–∫–∞—Ç—å `blocked_user` –ø–æ –≤—Å–µ–º—É —Ñ–∞–π–ª—É, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è. –í —Ö–æ—Ä–æ—à–µ–º ‚Äî `let(:blocked) { true }` —Å—Ç–æ–∏—Ç —Å—Ä–∞–∑—É –ø–æ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±—ä—è—Å–Ω—è–µ—Ç, —á–µ–º —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ.

#### 4.5 –ê—É–¥–∏—Ç: –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

–ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ –¥–≤–∞ —Ç–∏–ø–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.

**–î—É–±–ª–∏–∫–∞—Ç—ã `let`/`before` –≤—ã–¥–∞—é—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è.** –ï—Å–ª–∏ –≤ —Å–æ—Å–µ–¥–Ω–∏—Ö –≤–µ—Ç–∫–∞—Ö –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Äî —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –≤—ã—à–µ –∏–ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ let(:loyalty_status) –≤ –∫–∞–∂–¥–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
describe Billing::DiscountEvaluator do
  subject(:discount) { described_class.call(order) }
  let(:order) { build(:order, segment: segment, loyalty_status: loyalty_status) }

  context 'when segment is b2c' do
    let(:segment) { :b2c }

    context 'with gold loyalty' do
      let(:loyalty_status) { :gold }
      it('returns 0.15') { expect(discount).to eq(0.15) }
    end

    context 'with silver loyalty' do
      let(:loyalty_status) { :silver }
      it('returns 0.10') { expect(discount).to eq(0.10) }
    end

    context 'with no loyalty' do
      let(:loyalty_status) { :none }
      it('returns 0') { expect(discount).to eq(0) }
    end
  end

  context 'when segment is b2b' do
    let(:segment) { :b2b }

    context 'with gold loyalty' do
      let(:loyalty_status) { :gold }    # ‚Üê –¥—É–±–ª–∏–∫–∞—Ç!
      it('returns 0.12') { expect(discount).to eq(0.12) }
    end
    # ...
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî currency –≤—ã–Ω–µ—Å–µ–Ω–∞ –Ω–∞ —Å–≤–æ—ë –º–µ—Å—Ç–æ –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏
describe Billing::DiscountEvaluator do
  subject(:discount) { described_class.call(order) }
  let(:order) { build(:order, segment: segment, currency: currency, loyalty_status: loyalty_status) }

  context 'when segment is b2c' do
    let(:segment) { :b2c }

    context 'with USD currency' do
      let(:currency) { :usd }

      context 'and loyalty is gold' do
        let(:loyalty_status) { :gold }
        it('returns 0.15') { ... }
      end

      context 'and loyalty is silver' do
        let(:loyalty_status) { :silver }
        it('returns 0.10') { ... }
      end
    end
  end

  context 'when segment is b2b' do
    let(:segment) { :b2b }

    context 'with USD currency' do
      let(:currency) { :usd }
      # ...
    end

    context 'with EUR currency' do
      let(:currency) { :eur }
      # ...
    end
  end
end
```

**–î—É–±–ª–∏–∫–∞—Ç—ã `it` —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º–∏ –≤—ã–¥–∞—é—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.** –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ `it` –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö ‚Äî —ç—Ç–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –í—ã–Ω–µ—Å–∏—Ç–µ –∏—Ö –≤ `shared_examples` (—Å–º. [–ø—Ä–∞–≤–∏–ª–æ 14](#14-shared-examples-–¥–ª—è-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤)).

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç:**
1. –ü—Ä–æ–π—Ç–∏ –ø–æ `let`/`before` –≤ —Å–∏–±–ª–∏–Ω–≥–∞—Ö ‚Äî –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–¥–Ω—è—Ç—å –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ. –ï—Å–ª–∏ –ø—Ä–∏ —ç—Ç–æ–º —Ç–µ—Å—Ç—ã –ª–æ–º–∞—é—Ç—Å—è, –≤—ã –Ω–∞—à–ª–∏ —Å–∫—Ä—ã—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
2. –°–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ —Å–æ —Å–ø–∏—Å–∫–æ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∏–≥–¥–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è ‚Äî –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏—è.
3. –ü—Ä–æ–π—Ç–∏ –ø–æ `it` –≤ –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö ‚Äî –æ–∂–∏–¥–∞–Ω–∏—è, –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –≤–æ –≤—Å–µ—Ö –≤–µ—Ç–∫–∞—Ö, –≤—ã–Ω–µ—Å—Ç–∏ –≤ `shared_examples`.

---

–ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≥–æ—Ç–æ–≤–∞. –¢–µ–ø–µ—Ä—å ‚Äî –∫–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç: —Ñ–∞–∑—ã, subject, —á—Ç–æ –º–æ–∂–Ω–æ –∏ –Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å –≤ —Ç–µ–ª–µ —Ç–µ—Å—Ç–∞.

## –ß–∞—Å—Ç—å 3: –ö–∞–∫ –∑–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç

### 5. –¢—Ä–∏ —Ñ–∞–∑—ã: Given / When / Then

–ï—Å–ª–∏ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –≥–¥–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –∏ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è ‚Äî —Ñ–∞–∑—ã —Å–º–µ—à–∞–Ω—ã. `let`/`let!` –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ (Given), `before` –¥–æ–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º—É –¥–æ –Ω—É–∂–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (When), –æ–∂–∏–¥–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ `it` —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (Then).

```ruby
# –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ ‚Äî –≤—Å—ë –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
describe "#block" do
  before do
    user = create :user
    admin = create :admin
    admin.block(user)
  end

  it "true" do
    expect(User.find(1).blocked).to be(true)
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî —Ñ–∞–∑—ã —Ä–∞–∑–¥–µ–ª–µ–Ω—ã
describe "#block" do
  # Given: –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  let(:user) { create :user }
  let(:admin) { create :admin }

  # When: –¥–µ–π—Å—Ç–≤–∏–µ
  before { admin.block(user) }

  # Then: –ø—Ä–æ–≤–µ—Ä–∫–∞
  it "marks the user as blocked" do
    expect(user.blocked).to be(true)
  end
end
```

–í–æ–∑–≤—Ä–∞—â–∞—è—Å—å –∫ `OrderService` ‚Äî —Ñ–∞–∑—ã –≤–∏–¥–Ω—ã —è–≤–Ω–æ:

```ruby
describe OrderService, '#place' do
  # Given
  let(:order) { build(:order, :with_card, :sufficient_balance) }

  # When
  subject(:result) { described_class.new.place(order) }

  # Then
  it 'places the order' do
    expect(result.status).to eq('placed')
  end
end
```

–í –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ Given/When/Then —Å–º–µ—à–∞–Ω—ã –≤–Ω—É—Ç—Ä–∏ `before`, —Ç–µ—Å—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `User.find(1)` –≤–º–µ—Å—Ç–æ `let`, –∏ –æ–ø–∏—Å–∞–Ω–∏–µ `it "true"` –Ω–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏.

–î–µ–π—Å—Ç–≤–∏–µ –º–æ–∂–Ω–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –ø—Ä—è–º–æ –≤ `it`, –µ—Å–ª–∏ —Ç–∞–∫ —á–∏—Ç–∞–µ—Ç—Å—è —è—Å–Ω–µ–µ:

```ruby
# –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî –¥–µ–π—Å—Ç–≤–∏–µ –≤ it
describe "#block" do
  let(:user) { create :user }
  let(:admin) { create :admin }

  it "marks the user as blocked" do
    admin.block(user)
    expect(user.blocked).to be(true)
  end
end
```

`let` –ª–µ–Ω–∏–≤—ã–π: –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏. –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –¥–æ `it`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `before` –∏–ª–∏ `let!`.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –≤—ã–∑–æ–≤ let –≤ before –¥–ª—è eager initialization
let(:product) { create(:product) }
let(:order) { create(:order, product: product) }

before do
  product  # ‚Üê –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤, —á—Ç–æ–±—ã product —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª –¥–æ —Ç–µ—Å—Ç–∞
  order
end

# —Ö–æ—Ä–æ—à–æ ‚Äî let! —Å–æ–∑–¥–∞–Ω –¥–ª—è —ç—Ç–æ–≥–æ
let!(:product) { create(:product) }
let!(:order) { create(:order, product: product) }
```

`let!` = Given (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö). `before` = When (–¥–µ–π—Å—Ç–≤–∏–µ). –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `before` —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ–±–æ–π—Ç–∏ –ª–µ–Ω–∏–≤–æ—Å—Ç—å `let`.

–í —Ç—è–∂—ë–ª—ã—Ö —Ç–µ—Å—Ç–∞—Ö, –≥–¥–µ `create` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ, –≥–µ–º [test-prof](https://test-prof.evilmartians.io/) –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç `let_it_be` –∏ `before_all` ‚Äî –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –≥—Ä—É–ø–ø—É —Ç–µ—Å—Ç–æ–≤, –∞ –Ω–µ –Ω–∞ –∫–∞–∂–¥—ã–π `it`. Given-—Ñ–∞–∑–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π, –Ω–æ `let_it_be` –∑–∞–º–µ–Ω—è–µ—Ç `let` –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –º–µ–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–∏–º–µ—Ä–∞–º–∏:

```ruby
# –≤–º–µ—Å—Ç–æ let(:user) { create(:user) } ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
let_it_be(:user) { create(:user, :verified) }
let_it_be(:product) { create(:product, :active) }

context 'when order is valid' do
  # –∏–∑–º–µ–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —á–µ—Ä–µ–∑ let
  let(:order) { create(:order, user: user, product: product) }

  it 'places the order' do
    expect(service.place(order).status).to eq('placed')
  end
end
```

–î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç (–æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å, —É–¥–∞–ª—è–µ—Ç), –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —Ç—Ä–µ–±—É—é—Ç `let` –∏–ª–∏ `create` –≤ –∫–∞–∂–¥–æ–º `it` ‚Äî –∏–Ω–∞—á–µ –º—É—Ç–∞—Ü–∏—è –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π.

### 6. –û–±—ä—è–≤–ª—è–π—Ç–µ `subject` —è–≤–Ω–æ

–ï—Å–ª–∏ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ `it` ‚Äî "–∞ —á—Ç–æ –º—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º?" ‚Äî `subject` –Ω–µ –æ–±—ä—è–≤–ª–µ–Ω. –Ø–≤–Ω—ã–π `subject` —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –±–µ–∑ –ø–æ–∏—Å–∫–∞ –ø–æ –æ–∂–∏–¥–∞–Ω–∏—è–º.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî subject —Å–∫—Ä—ã—Ç, currency –±–µ—Ä—ë—Ç—Å—è –∏–∑ default factory
describe CurrencyConverter do
  let(:amount) { build(:money) }   # factory —Å–æ–∑–¥–∞—ë—Ç Money.new(100, :usd) ‚Äî –Ω–æ :usd –Ω–µ –≤–∏–¥–Ω–æ

  it 'converts to EUR' do
    expect(described_class.convert(amount, :eur)).to eq(Money.new(92, :eur))
  end
end

# —Ö–æ—Ä–æ—à–æ ‚Äî –∏—Å—Ö–æ–¥–Ω–∞—è –≤–∞–ª—é—Ç–∞ –≤–∏–¥–Ω–∞ –≤ —Ç–µ—Å—Ç–µ
describe CurrencyConverter do
  subject(:result) { described_class.convert(amount, :eur) }

  let(:amount) { build(:money, currency: :usd) }

  it 'converts to EUR' do
    expect(result).to eq(Money.new(92, :eur))
  end
end
```

`subject` –ø–æ–ª–µ–∑–µ–Ω –∫–æ–≥–¥–∞:
- –û–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö `it` –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
- –î–µ–π—Å—Ç–≤–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏–ª–∏ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ù—É–∂–Ω–æ –¥–∞—Ç—å –∏–º—è –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —á–µ—Ä–µ–∑ `subject(:result)`

### 7. –ù–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π—Ç–µ –≤ —Ç–µ—Å—Ç–∞—Ö

–ï—Å–ª–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è setup –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –∫–æ–¥ —Ö–µ–ª–ø–µ—Ä–∞ ‚Äî —Ç–µ—Å—Ç –ø–µ—Ä–µ—Å—Ç–∞–ª –±—ã—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π. –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —á–∏—Ç–∞—Ç—å—Å—è –∫–∞–∫ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∞ –Ω–µ –∫–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞. –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ `let` –∏ —Ñ–∞–±—Ä–∏–∫ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã —Å –ø—Ä—è–º–æ–π —Ä–∞–±–æ—Ç–æ–π —Å –ë–î, —ç—Ç–æ —Å–∏–≥–Ω–∞–ª.

```ruby
# —É–∂–∞—Å–Ω–æ ‚Äî SQL –≤ —Ç–µ—Å—Ç–µ, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã
describe SomeService do
  it 'stores report' do
    result = described_class.call(raw_payload)

    expect(result).to be_success
    expect(find_report(result.id)).to have_attributes(status: 'done', rows: 3)
  end

  private

  def raw_payload
    DB[:reports].insert(name: 'daily', data: '{"rows":[1,2,3]}')
    DB[:reports].where(name: 'daily').first
  end

  def find_report(id)
    DB[:reports].where(id: id).first
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî —Ñ–∞–±—Ä–∏–∫–∏ –∏ RSpec DSL
describe SomeService do
  let(:report) { create(:report, :daily, :with_rows) }
  subject(:result) { described_class.call(report.payload) }

  it 'stores report' do
    expect(result).to be_success
    expect(report.reload).to have_attributes(status: 'done', rows_count: 3)
  end
end
```

–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å–∫—Ä—ã–≤–∞—é—Ç, –∫–∞–∫ –∑–∞–¥–∞—é—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è: —á–∏—Ç–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ "–≤—ã–ø–æ–ª–Ω–∏—Ç—å" –∫–æ–¥ –≤ –≥–æ–ª–æ–≤–µ. –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î –º–∏–Ω—É–µ—Ç —Ñ–∞–±—Ä–∏–∫–∏ –∏ —Å–æ–∑–¥–∞—ë—Ç –∂—ë—Å—Ç–∫—É—é –ø—Ä–∏–≤—è–∑–∫—É –∫ —Å—Ö–µ–º–µ.

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Å–ª–æ–∂–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ (–ø—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã, –æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏) ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏: –æ–±—ä–µ–∫—Ç –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞—Ç—å —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π API.

### 8. –Ø–≤–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ DRY

–í BDD-—Ç–µ—Å—Ç–∞—Ö –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –±—ã–ª–æ —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, –ß–¢–û –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è. –ï—Å–ª–∏ extraction –º–µ—Ç–æ–¥–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç –º–µ–Ω–µ–µ –æ—á–µ–≤–∏–¥–Ω—ã–º ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.

–¢–µ—Å—Ç—ã ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã. –ö–æ–≥–¥–∞ —á–∏—Ç–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç spec-—Ñ–∞–π–ª, –æ–Ω –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ –ø—Ä—ã–≥–∞—è –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî —Ö–µ–ª–ø–µ—Ä —Å–∫—Ä—ã–≤–∞–µ—Ç —Å—É—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏
def create_paid_order(user)
  order = create(:order, user: user, status: :paid)
  create(:payment, order: order, amount: order.total)
  order
end

it 'refunds paid order' do
  order = create_paid_order(user)
  expect { service.refund(order) }.to change(order, :status).to('refunded')
end

# —Ö–æ—Ä–æ—à–æ ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∏–¥–Ω–æ —Å—Ä–∞–∑—É
it 'refunds paid order' do
  order = create(:order, :paid, user: user)
  create(:payment, order: order, amount: order.total)

  expect { service.refund(order) }.to change(order, :status).to('refunded')
end
```

–ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω DRY ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ RSpec DSL: `let`, `before`, `subject`, traits, shared contexts. –≠—Ç–æ –æ–±—â–∏–π —è–∑—ã–∫, –ø–æ–Ω—è—Ç–Ω—ã–π –≤—Å–µ–π –∫–æ–º–∞–Ω–¥–µ, –∏ –Ω–µ –Ω—É–∂–Ω–æ –∏–∑–æ–±—Ä–µ—Ç–∞—Ç—å —Å–≤–æ–∏ —Ö–µ–ª–ø–µ—Ä—ã (—Å–º. [–ø—Ä–∞–≤–∏–ª–æ 7](#7-–Ω–µ-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π—Ç–µ-–≤-—Ç–µ—Å—Ç–∞—Ö)). –ù–æ –µ—Å–ª–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Å–∫—Ä—ã–≤–∞–µ—Ç –≤–∞–∂–Ω—É—é –¥–µ—Ç–∞–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî –ª—É—á—à–µ –Ω–∞–ø–∏—Å–∞—Ç—å —è–≤–Ω–æ.

---

–§–∞–∑–∞ Given —Ç—Ä–µ–±—É–µ—Ç –¥–∞–Ω–Ω—ã—Ö. FactoryBot ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏; –æ—Ç —Ç–æ–≥–æ –∫–∞–∫ –≤—ã –µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ, –∑–∞–≤–∏—Å–∏—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –≤—Å–µ–π —Å–µ–∫—Ü–∏–∏ setup.

## –ß–∞—Å—Ç—å 4: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### 9. FactoryBot: —Ñ–∞–±—Ä–∏–∫–∏, traits, –º–µ—Ç–æ–¥—ã

FactoryBot –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞) [–¥–æ–º–µ–Ω–Ω—ã—Ö](#–¥–æ–º–µ–Ω) –æ–±—ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ç—Ä–µ–π—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ö—ç—à–∏, –ø–æ—ç—Ç–æ–º—É —Ç–µ—Å—Ç—ã –≥–æ–≤–æ—Ä—è—Ç –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏, –∞ –Ω–µ –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∞—Ç—Ä–∏–±—É—Ç–∞—Ö.

#### 9.1 Traits –¥–ª—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫

–î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å ¬´—Å—Ä–µ–¥–Ω–∏–π¬ª –æ–±—ä–µ–∫—Ç, –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è happy path. –í—Å—ë, —á—Ç–æ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –ø—Ä—è—á—å—Ç–µ –≤–Ω—É—Ç—Ä—å —Ñ–∞–±—Ä–∏–∫–∏. –ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ—Ñ–æ—Ä–º–ª—è–π—Ç–µ —á–µ—Ä–µ–∑ —Ç—Ä–µ–π—Ç—ã: `:blocked`, `:with_verified_email`, `:expired`.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –≤ —Ç–µ—Å—Ç–µ
describe '#unlock' do
  let(:user) do
    create(:user,
           blocked: true,
           blocked_at: 2.months.ago,
           email_confirmed: true
           # ... –µ—â–µ 2 –∞—Ç—Ä–∏–±—É—Ç–∞
    )
  end

  it 'allows unlocking the user' do
    expect(UserUnlocker.call(user)).to be_allowed
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî —Ç—Ä–µ–π—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
FactoryBot.define do
  factory :user do
    email { Faker::Internet.email }
    password { 'secret123' }

    trait :blocked do
      blocked { true }
      blocked_at { 2.months.ago }
    end

    trait :verified do
      email_confirmed { true }
    end
  end
end

describe '#unlock' do
  let(:user) { create(:user, :blocked, :verified) }

  it 'allows unlocking the user' do
    expect(UserUnlocker.call(user)).to be_allowed
  end
end
```

–ß–∏—Ç–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (`:blocked`, `:verified`) –∏ —Å–æ–æ—Ç–Ω–æ—Å–∏—Ç –∏—Ö —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ —Ñ–∞–±—Ä–∏–∫–µ ‚Äî —Ç–µ—Å—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è —á–∏—Å—Ç—ã–º–∏.

–í `OrderService` —Ç—Ä–µ–π—Ç—ã —Ç–æ–∂–µ –ø–æ–º–æ–≥–∞—é—Ç: –≤–º–µ—Å—Ç–æ `create(:order, card_type: 'visa', card_balance: 1000, card_verified: true)` –ø–∏—à–µ–º `create(:order, :with_card, :sufficient_balance)` ‚Äî —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–æ–º–µ–Ω–∞ –≤–∏–¥–Ω—ã, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Å–∫—Ä—ã—Ç—ã.

#### 9.2 `attributes_for` –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

–ï—Å–ª–∏ —Ç–µ—Å—Ç—É –Ω–µ –≤–∞–∂–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π ‚Äî –∑–∞—á–µ–º –∏—Ö –ø—Ä–æ–ø–∏—Å—ã–≤–∞—Ç—å? `attributes_for` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π —Ö—ç—à –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ —Ñ–∞–±—Ä–∏–∫–∏ –∏ —É–±–∏—Ä–∞–µ—Ç —à—É–º –∏–∑ setup.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–±—Ä–∏–∫–∏ –≤ —Ç–µ—Å—Ç–µ
describe 'POST /api/orders' do
  let(:order_params) do
    { customer_email: 'user@example.com', total: 150.0 }
  end

  before { post '/api/orders', params: order_params }

  it('creates new order') { expect(response).to have_http_status(:created) }
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ñ–∞–±—Ä–∏–∫–∏
describe 'POST /api/orders' do
  let(:order_params) { attributes_for(:order) }
  before { post '/api/orders', params: order_params }

  it('creates new order') { expect(response).to have_http_status(:created) }
end
```

–ï—Å–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–∞–∂–Ω–æ –¥–ª—è –ø–æ–≤–µ–¥–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —è–≤–Ω–æ:

```ruby
let(:order_params) { attributes_for(:order, segment: 'b2b', discount: 0.15) }
```

–¢—Ä–µ–π—Ç—ã —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç: `attributes_for(:order, :international, :with_insurance)`.

**–í–ª–æ–∂–µ–Ω–Ω—ã–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏.** `attributes_for` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏. –ï—Å–ª–∏ API –ø—Ä–∏–Ω–∏–º–∞–µ—Ç nested attributes (–Ω–∞–ø—Ä–∏–º–µ—Ä, `order[items_attributes]`), –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –Ω—É–∂–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:

```ruby
# attributes_for(:order) –Ω–µ –≤–∫–ª—é—á–∏—Ç items_attributes
let(:order_params) do
  attributes_for(:order).merge(
    items_attributes: [attributes_for(:item), attributes_for(:item)]
  )
end
```

**–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:** –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å API –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –º–æ–¥–µ–ª–∏ (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –∏–º–µ—é—Ç –¥—Ä—É–≥–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è/—Å—Ç—Ä—É–∫—Ç—É—Ä—É), —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —è–≤–Ω–æ:

```ruby
# API –æ–∂–∏–¥–∞–µ—Ç { email: '...', amount: 150.0 },
# –∞ —Ñ–∞–±—Ä–∏–∫–∞ –º–æ–¥–µ–ª–∏ ‚Äî { customer_email: '...', total_cents: 15000 }
let(:order_params) do
  { email: 'user@example.com', amount: 150.0 }
end
```

–ï—Å–ª–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ —á–∏—Ç–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–±—Ä–∏–∫—É ‚Äî –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ª—É—á—à–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —è–≤–Ω–æ.

#### 9.3 `build_stubbed` –¥–ª—è —é–Ω–∏—Ç-—Ç–µ—Å—Ç–æ–≤

–Æ–Ω–∏—Ç-—Å–ø–µ–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤, –ø–æ–ª–∏—Ç–∏–∫, presenter'–æ–≤ –∏ form-–æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ë–î. `build_stubbed` —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç ActiveRecord –±–µ–∑ `INSERT`/`UPDATE`, –Ω–æ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ `id`, `created_at`, `updated_at` –∏ –∑–∞–ø—Ä–µ—Ç–æ–º –Ω–∞ `save`.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –∑–∞–ø–∏—Å—å –≤ –ë–î —Ä–∞–¥–∏ –¥–∞–Ω–Ω—ã—Ö
describe Orders::PriceCalculator do
  let(:order) { create(:order, items_count: 3, total_cents: 100_00) }
  let(:discount) { create(:discount, percent: 10) }

  it 'applies discount to order total' do
    result = described_class.new(order, discount).calculate
    expect(result).to eq(90_00)
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –ë–î –Ω–µ –Ω—É–∂–Ω–∞
describe Orders::PriceCalculator do
  let(:order) { build_stubbed(:order, items_count: 3, total_cents: 100_00) }
  let(:discount) { build_stubbed(:discount, percent: 10) }

  it 'applies discount to order total' do
    result = described_class.new(order, discount).calculate
    expect(result).to eq(90_00)
  end
end
```

–ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ —Ç—Ä–µ–±—É–µ—Ç `save` –∏–ª–∏ —á—Ç–µ–Ω–∏—è –∏–∑ –±–∞–∑—ã, –∑–Ω–∞—á–∏—Ç –≤—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è ‚Äî –ø–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π.

–ö–æ–≥–¥–∞ `build_stubbed` –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç: —Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–µ–π, —Å–∫–æ—É–ø–æ–≤, callbacks, –≤–∞–ª–∏–¥–∞—Ü–∏–π —Å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å—é –∏–ª–∏ foreign keys ‚Äî –∑–¥–µ—Å—å –Ω—É–∂–µ–Ω `create`.

<a id="–≤—ã–±–æ—Ä-–º–µ—Ç–æ–¥–∞-factorybot-decision-tree"></a>
<details>
<summary>–í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ FactoryBot: Decision Tree</summary>

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –ù—É–∂–µ–Ω –ª–∏ –≤–∞–º –æ–±—ä–µ–∫—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è?                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ
              ‚îú‚îÄ‚îÄ‚îÄ –ù–ï–¢ (—Ç–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è API/–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞)
              ‚îÇ    ‚îî‚îÄ‚Üí attributes_for(:user)
              ‚îÇ
              ‚îî‚îÄ‚îÄ‚îÄ –î–ê (–Ω—É–∂–µ–Ω –æ–±—ä–µ–∫—Ç)
                   ‚îÇ
                   ‚îú‚îÄ‚îÄ‚îÄ –û–±—ä–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –ë–î?
                   ‚îÇ    ‚îÇ
                   ‚îÇ    ‚îú‚îÄ‚îÄ‚îÄ –î–ê (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏, –∫–æ–ª–±—ç–∫–∏)
                   ‚îÇ    ‚îÇ    ‚îî‚îÄ‚Üí create(:order, :with_items)
                   ‚îÇ    ‚îÇ
                   ‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ –ù–ï–¢ (—Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏)
                   ‚îÇ         ‚îÇ
                   ‚îÇ         ‚îú‚îÄ‚îÄ‚îÄ –¢–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –ü–û–í–ï–î–ï–ù–ò–ï –æ–±—ä–µ–∫—Ç–∞?
                   ‚îÇ         ‚îÇ    (–≤–∞–ª–∏–¥–∞—Ü–∏–∏, –º–µ—Ç–æ–¥—ã –º–æ–¥–µ–ª–∏)
                   ‚îÇ         ‚îÇ    ‚îî‚îÄ‚Üí build(:user)
                   ‚îÇ         ‚îÇ
                   ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ –û–±—ä–µ–∫—Ç –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –∫–∞–∫ –î–ê–ù–ù–´–ï?
                   ‚îÇ              (–ø–µ—Ä–µ–¥–∞—ë—Ç–µ –≤ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å)
                   ‚îÇ              ‚îî‚îÄ‚Üí build_stubbed(:user)
```

</details>

–ï—Å–ª–∏ —Ñ–∞–±—Ä–∏–∫–∏ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–ª–æ–∂–Ω—ã–º–∏ (–¥–µ—Å—è—Ç–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —Å–ª–æ–∂–Ω—ã–µ callbacks) ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª: –º–æ–¥–µ–ª—å –¥–µ–ª–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤—ã–Ω–æ—Å–∏—Ç–µ –≤ —Å–µ—Ä–≤–∏—Å—ã, —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ —É–º–µ–Ω—å—à–∞–π—Ç–µ —á–µ—Ä–µ–∑ Dependency Injection.

---

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –¥–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã. –ü–æ—Å–ª–µ–¥–Ω–∏–π —Å–ª–æ–π ‚Äî –∫–∞–∫ –Ω–∞–∑–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏ –ø—Ä–∏–º–µ—Ä—ã, —á—Ç–æ–±—ã –æ—Ç—á—ë—Ç RSpec —á–∏—Ç–∞–ª—Å—è –∫–∞–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è.

## –ß–∞—Å—Ç—å 5: –Ø–∑—ã–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

### 10. –ü–∏—à–∏—Ç–µ —á–∏—Ç–∞–µ–º—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

–ü—Ä–∞–≤–∏–ª–∞ –∏–∑ —ç—Ç–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç –æ—Ç—á—ë—Ç RSpec –≤ –¥–æ–∫—É–º–µ–Ω—Ç, –ø–æ–Ω—è—Ç–Ω—ã–π –±–µ–∑ –∑–Ω–∞–Ω–∏—è Ruby. –°—Ä–∞–≤–Ω–∏—Ç–µ:

```
# –Ω–µ—á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á—ë—Ç
#some_action blocked month ago /it/ true

# —á–∏—Ç–∞–µ–º—ã–π –æ—Ç—á—ë—Ç
#some_action when user is blocked by admin and blocking duration is over a month
  allows unlocking the user
```

–†–∞–∑–Ω–∏—Ü–∞ ‚Äî –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –Ω–∏–∂–µ. –ß–µ—Ç—ã—Ä–µ –∞—Å–ø–µ–∫—Ç–∞: –∫–∞–∫ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –∏–∑ context + it, –∫–∞–∫—É—é –≥—Ä–∞–º–º–∞—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤—ã–±–∏—Ä–∞—Ç—å, –∏ –∫–∞–∫ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ RuboCop.

#### 10.1 context + it = –≤–∞–ª–∏–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ

–û–ø–∏—Å–∞–Ω–∏—è `describe`/`context`/`it` –ø–∏—à–∏—Ç–µ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏: —Ç–∞–∫ –æ—Ç—á—ë—Ç—ã RSpec –æ—Å—Ç–∞—é—Ç—Å—è —á–∏—Ç–∞–µ–º—ã–º–∏ –≤ CI, –∞ –∫–æ–º–∞–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–¥–∏–Ω—ã–π —è–∑—ã–∫.

```ruby
# –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ
describe "#some_action" do
  context "blocked" do          # —á—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –∫–æ–≥–¥–∞, –∫–µ–º?
    context "month ago" do      # –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥ —á—Ç–æ?
      it("true") { test }      # true ‚Äî –æ —á—ë–º —ç—Ç–æ?
    end
  end
end
# –≤—ã–≤–æ–¥: #some_action blocked month ago /it/ true
```

```ruby
# –∏–¥–µ–∞–ª—å–Ω–æ
describe "#some_action" do
  context "when user is blocked by admin" do
    context "and blocking duration is over a month" do
      it("allows unlocking the user") { test }
    end
  end
end
# –≤—ã–≤–æ–¥: #some_action when user is blocked by admin and blocking duration is over a month
#   allows unlocking the user
```

–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω–æ –ª—é–±–æ–º—É —á–µ–ª–æ–≤–µ–∫—É ‚Äî –Ω–µ —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É. –ú–µ–Ω–µ–¥–∂–µ—Ä, —á–∏—Ç–∞—é—â–∏–π –≤—ã–≤–æ–¥ —Ç–µ—Å—Ç–æ–≤, –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑ –∑–Ω–∞–Ω–∏—è –∫–æ–¥–∞:

```ruby
when user is blocked by admin and blocking duration is over a month /it/ allows unlocking the user
when user is blocked by admin but blocking duration is under a month /it/ does NOT allow unlocking the user
```

–ï—Å–ª–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ `it` –ø–æ—è–≤–ª—è–µ—Ç—Å—è `when`/`with`/`but` ‚Äî –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç. –í—ã–Ω–µ—Å–∏—Ç–µ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ `context`.

–ò–∑–±–µ–≥–∞–π—Ç–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∂–∞—Ä–≥–æ–Ω–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏—è—Ö. `when premium_flag is true` ‚Üí `when user has premium subscription`. `when role_id = 3` ‚Üí `when user is admin`.

#### 10.2 –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞: Present Simple, –∞–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥

–ï—Å–ª–∏ `it` –∑–≤—É—á–∏—Ç –∫–∞–∫ –ø—Ä–æ—Å—å–±–∞ ("should return") –∞ –Ω–µ –∫–∞–∫ —Ñ–∞–∫—Ç ("returns") ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–µ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç. –ú—ã –æ–ø–∏—Å—ã–≤–∞–µ–º —É—Å—Ç–æ–π—á–∏–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã, –ø–æ—ç—Ç–æ–º—É —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∑–≤—É—á–∞—Ç –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–º–µ–Ω–∞.

1. **Present Simple.** –ü–æ–≤–µ–¥–µ–Ω–∏–µ –≤–µ—Ä–Ω–æ –≤—Å–µ–≥–¥–∞: `it 'returns the summary'`.
2. **–ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥ –≤ `it`, —Ç—Ä–µ—Ç—å–µ –ª–∏—Ü–æ.** –°—É–±—ä–µ–∫—Ç ‚Äî –æ–±—ä–µ–∫—Ç —Å–∏—Å—Ç–µ–º—ã: `it 'places the order'`, `it 'sends confirmation email'`. –î–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏–π: `it 'has parent'`, `it 'is valid'`.
3. **–ü–∞—Å—Å–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤.** –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞—ë—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `when user is blocked`, `when account has balance`.
4. **Zero conditional.** `context/it` –æ—Å—Ç–∞—é—Ç—Å—è –≤ Present Simple: `when payment is confirmed, it issues receipt`.
5. **–ë–µ–∑ –º–æ–¥–∞–ª—å–Ω—ã—Ö –≥–ª–∞–≥–æ–ª–æ–≤.** –ù–∏–∫–∞–∫–∏—Ö `should`, `can`, `must`: `it 'creates an order'`, –Ω–µ `it 'should create an order'`.
6. **–Ø–≤–Ω–æ–µ `NOT` –∫–∞–ø—Å–æ–º.** `when user is NOT verified`, `it 'does NOT unlock user'`.

```ruby
# –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω
describe OrderMailer do
  context 'when invoice is generated' do
    it 'sends the invoice email'
  end
end
```

```ruby
# –ø–ª–æ—Ö–æ
it 'should send email'         # ‚Üí it 'sends email'
context 'if user paid'         # ‚Üí context 'when user has paid'
it 'returns'                   # ‚Üí it 'returns the summary'
```

#### 10.3 –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤: when/with/and/but/NOT

–ö–∞–∂–¥–∞—è —Å–≤—è–∑–∫–∞ –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–∏–ø—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —É—Ä–æ–≤–Ω—é –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏:

- **`when ‚Ä¶`** ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Ç–∫—É, –æ–ø–∏—Å—ã–≤–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É: `context 'when user has a payment card'`
- **`with ‚Ä¶`** ‚Äî –≤–≤–æ–¥–∏—Ç –ø–µ—Ä–≤–æ–µ —É—Ç–æ—á–Ω—è—é—â–µ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `context 'with verified email'`
- **`and ‚Ä¶`** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –µ—â—ë –æ–¥–Ω–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: `context 'and balance covers the price'`
- **`without ‚Ä¶`** ‚Äî –±–∏–Ω–∞—Ä–Ω–∞—è –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ—Å—Ç—å: `context 'without verified email'`
- **`but ‚Ä¶`** ‚Äî –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ happy path: `context 'but balance does NOT cover the price'`
- **`NOT`** ‚Äî –∫–∞–ø—Å–æ–º –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ `it` –¥–ª—è –æ—Ç—Ä–∏—Ü–∞–Ω–∏—è: `context 'when user does NOT have a payment card'`

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å: `when` ‚Üí `with` ‚Üí `and` ‚Üí `but`/`without` ‚Üí `it`.

```ruby
describe '#charge' do
  context 'when user has a payment card' do                    # –±–∞–∑–æ–≤–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞
    context 'with verified email' do                           # happy path —É—Ç–æ—á–Ω–µ–Ω–∏–µ
      context 'and balance covers the price' do                # –µ—â—ë –æ–¥–Ω–æ happy path —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        it 'charges the card'
      end

      context 'but balance does NOT cover the price' do        # corner case
        it 'does NOT charge the card'
      end
    end

    context 'without verified email' do                        # corner case
      it 'does NOT charge the card'
    end
  end

  context 'when user does NOT have a payment card' do          # –¥—Ä—É–≥–∞—è –≤–µ—Ç–∫–∞
    it 'does NOT charge the card'
  end
end
```

–£ –¥–æ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –µ—Å—Ç—å –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: –∞–∫–∫–∞—É–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –∑–∞–∫–∞–∑ –Ω–µ –æ—Ç–º–µ–Ω—ë–Ω. Happy path –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –Ω–µ–≥–æ –∏–∑–±—ã—Ç–æ—á–µ–Ω ‚Äî `when account is NOT blocked` –ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –ª–æ–≥–∏–∫—É, —Å–æ–∑–¥–∞–≤–∞—è –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ, —á—Ç–æ "–Ω–µ–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω" —ç—Ç–æ edge case. –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –Ω–æ—Ä–º—ã:

```ruby
describe '#authenticate' do
  context 'when account exists' do
    it 'signs the user in'                                     # happy path —Å—Ä–∞–∑—É

    context 'but account is blocked' do
      it 'denies the sign-in'
    end
  end

  context 'when account does NOT exist' do
    it 'denies the sign-in'
  end
end
```

#### 10.4 RuboCop-–ø—Ä–∞–≤–∏–ª–∞ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

RuboCop RSpec –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≤–∏—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏:

```ruby
# –ø–ª–æ—Ö–æ ‚Äî RSpec/ExampleWording: –Ω–∞—Ä—É—à–µ–Ω–∏–µ
it 'should send email' do ...          # should ‚Üí Present Simple
it 'will return 42' do ...             # will ‚Üí Present Simple

# —Ö–æ—Ä–æ—à–æ
it 'sends email' do ...
it 'returns 42' do ...
```

–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª ‚Äî [RSpec Style Guide: Naming](https://rspec.rubystyle.guide/#naming).

---

–ü—Ä–∞–≤–∏–ª–∞ –≤—ã—à–µ ‚Äî –ø—Ä–æ –º—ã—à–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤. –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª ‚Äî –ø—Ä–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã RSpec, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–º–æ–≥–∞—é—Ç —Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞–º –∏ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã.

## –ß–∞—Å—Ç—å 6: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### 11. `aggregate_failures` –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–¥–∏–Ω `it` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω—É –ø—Ä–æ–≤–µ—Ä–∫—É (–ø—Ä–∞–≤–∏–ª–æ 3). –ù–æ –∫–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ `expect` –æ–ø–∏—Å—ã–≤–∞—é—Ç **–µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –æ–±—ä–µ–∫—Ç–∞ ‚Äî –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Äî –∏—Ö –º–æ–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω `it` —Å `:aggregate_failures`. –ë–µ–∑ –Ω–µ–≥–æ RSpec –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —É–ø–∞–≤—à–µ–º `expect`, –∏ –≤—ã –ø–æ—Ç–µ—Ä—è–µ—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö.

**–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ + –æ—Ç–ø—Ä–∞–≤–∫–∞ email) ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è, —Ä–∞–∑–Ω—ã–µ `it`. **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** (–∞—Ç—Ä–∏–±—É—Ç—ã Value Object, –ø–æ–ª—è HTTP-–æ—Ç–≤–µ—Ç–∞, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è) ‚Äî –µ–¥–∏–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ "–æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å", –æ–¥–∏–Ω `it`.

**–ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ:**
- Value objects (Money, Address, Coordinate)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (Settings, Config)
- Presenter/Decorator –æ–±—ä–µ–∫—Ç—ã
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ HTTP-–æ—Ç–≤–µ—Ç–∞ (—Å—Ç–∞—Ç—É—Å + –∑–∞–≥–æ–ª–æ–≤–∫–∏ + –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è)
- –°–≤—è–∑–∞–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (subtotal + tax + total)

```ruby
# –ø–ª–æ—Ö–æ ‚Äî over-splitting –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
describe ProductPresenter do
  let(:product) { create(:product, name: 'Laptop', price: 999.99, stock: 5) }
  subject(:presenter) { described_class.new(product) }

  it('returns product name') { expect(presenter.display_name).to eq('Laptop') }
  it('returns formatted price') { expect(presenter.formatted_price).to eq('$999.99') }
  it('returns availability') { expect(presenter.availability).to eq('In Stock') }
end
```

```ruby
# –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî aggregate_failures
describe ProductPresenter do
  let(:product) { create(:product, name: 'Laptop', price: 999.99, stock: 5) }
  subject(:presenter) { described_class.new(product) }

  it 'exposes product display interface', :aggregate_failures do
    expect(presenter.display_name).to eq('Laptop')
    expect(presenter.formatted_price).to eq('$999.99')
    expect(presenter.availability).to eq('In Stock')
  end

  context 'when product is out of stock' do
    let(:product) { create(:product, stock: 0) }
    it('indicates unavailability') { expect(presenter.availability).to eq('Out of Stock') }
  end
end
```

```ruby
# –∏–¥–µ–∞–ª—å–Ω–æ ‚Äî have_attributes
it 'exposes product display interface' do
  expect(presenter).to have_attributes(
    display_name: 'Laptop',
    formatted_price: '$999.99',
    availability: 'In Stock'
  )
end
```

`have_attributes` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è ‚Äî `aggregate_failures` –Ω–µ –Ω—É–∂–µ–Ω.

**–ó–∞—á–µ–º `aggregate_failures` –Ω—É–∂–µ–Ω –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ.** –ë–µ–∑ –Ω–µ–≥–æ RSpec –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–∞–¥–µ–Ω–∏–∏. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–π —Ü–∏–∫–ª –æ—Ç–ª–∞–¥–∫–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ CI:

```ruby
# –±–µ–∑ aggregate_failures
it 'returns order details' do
  get "/api/orders/#{order.id}"

  expect(response.parsed_body['id']).to eq(order.id)      # ‚ùå nil ‚Äî —Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
  expect(response.parsed_body['status']).to eq('pending')  # –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
  expect(response.parsed_body['total']).to eq(150.0)       # –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è
end
```

–í–∏–¥—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –æ—à–∏–±–∫—É ("expected order.id, got nil"), –≤—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å ID. –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ, –∂–¥—ë—Ç–µ CI 15 –º–∏–Ω—É—Ç ‚Äî –ø–∞–¥–∞–µ—Ç `status`. –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ, –µ—â—ë 15 –º–∏–Ω—É—Ç ‚Äî –ø–∞–¥–∞–µ—Ç `total`. –ù–∞–∫–æ–Ω–µ—Ü –ø–æ–Ω–∏–º–∞–µ—Ç–µ: —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –≤–æ–æ–±—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. **45+ –º–∏–Ω—É—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω–æ** –∏–∑-–∑–∞ –Ω–µ–ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

```ruby
# —Å aggregate_failures ‚Äî –≤—Å—ë –≤–∏–¥–Ω–æ —Å—Ä–∞–∑—É
it 'returns order details', :aggregate_failures do
  get "/api/orders/#{order.id}"

  expect(response.parsed_body['id']).to eq(order.id)
  expect(response.parsed_body['status']).to eq('pending')
  expect(response.parsed_body['total']).to eq(150.0)
end
```

**–¢—Ä–∏ –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è:**

1. "–ú–æ–∂–Ω–æ –ª–∏ –æ–ø–∏—Å–∞—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º?" ‚Äî –î–∞ ‚Üí –æ–¥–∏–Ω `it`. –ù–µ—Ç ‚Üí —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ.
2. "–ö–∞–∂–¥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø—É—Ç—å –∫–æ–¥–∞?" ‚Äî –î–∞ ‚Üí —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ. –ù–µ—Ç ‚Üí –æ–¥–∏–Ω `it`.
3. "–ü—Ä–æ–≤–µ—Ä—è—é –ª–∏ —è –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ —Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–∏ API?" ‚Äî –û–¥–∏–Ω ‚Üí –æ–±—ä–µ–¥–∏–Ω—è–π—Ç–µ. –†–∞–∑–Ω—ã–µ ‚Üí —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ.

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –†–∞–∑–¥–µ–ª—è—Ç—å | –û–±—ä–µ–¥–∏–Ω—è—Ç—å |
|----------|-----------|------------|
| –ú–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º | ‚úÖ | ‚ùå |
| –ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—É—Ç–∏ –∫–æ–¥–∞ | ‚úÖ | ‚ùå |
| –í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/—Å–æ—Å—Ç–æ—è–Ω–∏—è | ‚ùå | ‚úÖ |
| –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—ä–µ–∫—Ç–∞ (value object, presenter) | ‚ùå | ‚úÖ |

–ï—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç–µ—Å—å ‚Äî —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ.

**–î–ª—è JSON API —Å –±–æ–ª—å—à–∏–º–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏** –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ `let`:

```ruby
describe 'GET /api/orders/:id' do
  let(:order) { create(:order, customer: customer) }
  let(:customer) { create(:customer) }

  let(:expected_customer) do
    { 'id' => customer.id, 'name' => 'John Doe', 'email' => 'john@example.com' }
  end

  let(:expected_response) do
    { 'id' => order.id, 'status' => 'pending', 'customer' => expected_customer }
  end

  it 'returns complete order details' do
    get "/api/orders/#{order.id}"
    expect(response.parsed_body).to match(expected_response)
  end
end
```

–î–ª—è –ø–æ–ª–Ω–æ–π —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (JSON Schema, rswag, Pact). –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî [guide.api.ru.md](guide.api.ru.md).

**–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –î–µ—Ä–∂–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ `it` –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –¥–∞–∂–µ —Å `aggregate_failures` ‚Äî "works correctly" –Ω–µ –≥–æ–¥–∏—Ç—Å—è.
- –ï—Å–ª–∏ –≤ –æ–¥–Ω–æ–º `it` –Ω–∞–±—Ä–∞–ª–æ—Å—å 10-15+ –æ–∂–∏–¥–∞–Ω–∏–π ‚Äî —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ. –≠—Ç–æ —É–∂–µ –Ω–µ –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- –î–æ—Ä–æ–≥–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–µ –æ–ø—Ä–∞–≤–¥—ã–≤–∞–µ—Ç —Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–π: –µ—Å–ª–∏ `it` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞, –∏ –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∏—Å—å–º–∞, –∏ –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥ ‚Äî —ç—Ç–æ —Ç—Ä–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∞ –Ω–µ –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
- `aggregate_failures` ‚Äî –Ω–µ —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–æ–≤–∏–Ω—É –ø–∏—Ä–∞–º–∏–¥—ã –≤ –æ–¥–Ω–æ–º `it`.

### 12. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `any_instance`

`allow_any_instance_of` / `expect_any_instance_of` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–æ–¥–º–µ–Ω–∞, –∫–æ—Ç–æ—Ä–∞—è –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –≤—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–ª–∞—Å—Å–∞. –≠—Ç–æ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ —Å–∏–≥–Ω–∞–ª –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ Dependency Injection.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–æ–∫
describe HighLevelClass do
  before do
    allow_any_instance_of(LowLevelClass).to receive(:foo).and_return({ some_key: :some_value })
  end

  it "returns the processed value" do
    expect(HighLevelClass.new.some_method).to eq(:some_expected_value)
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
describe HighLevelClass do
  let(:low_level_dependency) { instance_double(LowLevelClass) }
  subject(:instance) { described_class.new(low_level_dependency) }

  before do
    allow(low_level_dependency).to receive(:foo).and_return({ some_key: :some_value })
  end

  it "returns the processed value" do
    expect(instance.some_method).to eq(:some_expected_value)
  end
end
```

–ö–ª–∞—Å—Å –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —è–≤–Ω–æ, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–æ–±–∏–≤–∞—Ç—å –º–æ–∫ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É. –†–µ—à–µ–Ω–∏–µ ‚Äî –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [why any_instance is not recommended](https://rspec.info/features/3-13/rspec-mocks/working-with-legacy-code/any-instance/).

### 13. –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ verifying doubles

`double` —Å–æ–∑–¥–∞—ë—Ç ¬´–∞–Ω–æ–Ω–∏–º–Ω—ã–π¬ª –¥–≤–æ–π–Ω–∏–∫ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ‚Äî –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–º–æ–∫–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã. `instance_double` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –∏ –ª–æ–≤–∏—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî double –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±—ã–µ –º–µ—Ç–æ–¥—ã
let(:gateway) { double('PaymentGateway', charge: true) }
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî instance_double –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
let(:gateway) { instance_double(PaymentGateway, charge: true) }
```

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ: `PaymentGateway` –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–ª `charge` ‚Üí `process_charge`. –° `double` —Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∑–µ–ª—ë–Ω—ã–º ‚Äî –≤—ã —É–∑–Ω–∞–µ—Ç–µ –æ –ø—Ä–æ–±–ª–µ–º–µ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. –° `instance_double` —Ç–µ—Å—Ç —É–ø–∞–¥—ë—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ:

```
PaymentGateway does not implement #charge
```

- `instance_double(SomeClass)` ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–µ—Ç–æ–¥—ã —ç–∫–∑–µ–º–ø–ª—è—Ä–∞
- `class_double(SomeClass)` ‚Äî –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞ (`.find`, `.call`)
- `object_double(existing_object)` ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

**–ö–æ–≥–¥–∞ verifying double –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç:** –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –∫–ª–∞—Å—Å—ã, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —á–µ—Ä–µ–∑ `method_missing`, –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã –±–µ–∑ Ruby-–∫–ª–∞—Å—Å–∞. –í —ç—Ç–∏—Ö —Å–ª—É—á–∞—è—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∏ –¥–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç.

**–ß—Ç–æ —Å—Ç–∞–±–∏—Ç—å, –∞ —á—Ç–æ ‚Äî –Ω–µ—Ç.** –ü—Ä–∞–≤–∏–ª–∞ 12-13 –æ–±—ä—è—Å–Ω—è—é—Ç *–∫–∞–∫* —Å—Ç–∞–±–∏—Ç—å, –Ω–æ –Ω–µ –º–µ–Ω–µ–µ –≤–∞–∂–Ω–æ ‚Äî *–∫–æ–≥–¥–∞*. –ü—Ä–∏–Ω—Ü–∏–ø –∏–∑–æ–ª—è—Ü–∏–∏: —Å—Ç–∞–±—å—Ç–µ –≤–Ω–µ—à–Ω–µ–µ, –Ω–µ —Å—Ç–∞–±—å—Ç–µ —Å–≤–æ—ë.

–°—Ç–∞–±–∏—Ç—å –Ω—É–∂–Ω–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞ –≥—Ä–∞–Ω–∏—Ü–µ–π –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: HTTP-–≤—ã–∑–æ–≤—ã –∫ –ø–ª–∞—Ç—ë–∂–Ω—ã–º —à–ª—é–∑–∞–º, —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ API, –æ—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ñ–∞–π–ª–æ–≤—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ù–µ –Ω—É–∂–Ω–æ —Å—Ç–∞–±–∏—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏, —Å–µ—Ä–≤–∏—Å—ã –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Äî –¥–ª—è –Ω–∏—Ö –µ—Å—Ç—å —Ñ–∞–±—Ä–∏–∫–∏.

```ruby
describe OrderService, '#place' do
  # PaymentGateway ‚Äî HTTP-–≤—ã–∑–æ–≤ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É ‚Üí —Å—Ç–∞–±–∏–º
  let(:gateway) { instance_double(PaymentGateway) }

  before { allow(gateway).to receive(:charge).and_return(charge_result) }

  # Order, User ‚Äî —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ ‚Üí –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —á–µ—Ä–µ–∑ —Ñ–∞–±—Ä–∏–∫—É
  let(:order) { create(:order, :with_card) }
  let(:user) { create(:user, :verified) }

  # ...
end
```

–ï—Å–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –Ω—É–∂–Ω–æ –∑–∞—Å—Ç–∞–±–∏—Ç—å –¥—Ä—É–≥–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –æ —Å–ª–∏—à–∫–æ–º —Ç–µ—Å–Ω–æ–π —Å–≤—è–∑–∏. –î–µ–ª–æ –Ω–µ –≤ —Ç–µ—Å—Ç–µ, –∞ –≤ –∫–æ–¥–µ (—Å–º. [–ø—Ä–∞–≤–∏–ª–æ 4.2](#42-–ø–æ—Å—Ç—Ä–æ–π—Ç–µ-–∏–µ—Ä–∞—Ä—Ö–∏—é-–∑–∞–≤–∏—Å–∏–º—ã–µ--–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ) ‚Äî ¬´–∫–æ–≥–¥–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å —Å–ª–∏—à–∫–æ–º –≥–ª—É–±–æ–∫–∞¬ª). –í—ã–Ω–µ—Å–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∑–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ –æ—Å–ª–∞–±—å—Ç–µ —Å–≤—è–∑—å.

–≠—Ç–æ—Ç –ø—Ä–∏–Ω—Ü–∏–ø –∑–∞–º—ã–∫–∞–µ—Ç —Å–≤—è–∑–∫—É: [–≤–Ω–µ—à–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏](#41-–≤—ã–¥–µ–ª–∏—Ç–µ-—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç **—á—Ç–æ** —Å—Ç–∞–±–∏—Ç—å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ —Ç–µ—Å—Ç–æ–≤, –ø—Ä–∞–≤–∏–ª–∞ 12-13 ‚Äî **–∫–∞–∫** —ç—Ç–æ –¥–µ–ª–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏.

### 14. Shared examples –¥–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

–ï—Å–ª–∏ –ø—Ä–∏ [–∞—É–¥–∏—Ç–µ](#45-–∞—É–¥–∏—Ç-–¥—É–±–ª–∏–∫–∞—Ç—ã-–∏-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã) –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ `it` –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö ‚Äî —ç—Ç–æ –Ω–µ—è–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç. `shared_examples` –¥–µ–ª–∞—é—Ç –µ–≥–æ —è–≤–Ω—ã–º. –≠—Ç–æ –Ω–µ DRY —Ä–∞–¥–∏ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ ‚Äî —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

**–î–ª—è –æ–±—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤:**

```ruby
RSpec.shared_examples 'a pageable API' do
  it('returns the second page') { expect(resource.paginate(page: 2).current_page).to eq 2 }
  it('limits page size') { expect(resource.paginate(page: 1, per_page: 5).items.count).to eq 5 }
end

describe OrdersQuery do
  subject(:resource) { described_class.new(scope: Order.all) }
  it_behaves_like 'a pageable API'
end

describe UsersQuery do
  subject(:resource) { described_class.new(scope: User.active) }
  it_behaves_like 'a pageable API'
end
```

–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –ø–æ —Ñ–æ—Ä–º—É–ª–µ: **`'a/an + [–ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ] + —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ'`**. –ü—Ä–æ–≤–µ—Ä–∫–∞: "it behaves like [–≤–∞—à–µ_–Ω–∞–∑–≤–∞–Ω–∏–µ]" –¥–æ–ª–∂–Ω–æ –∑–≤—É—á–∞—Ç—å –∫–∞–∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ.

**`it_behaves_like` vs `include_examples`.** `it_behaves_like` —Å–æ–∑–¥–∞—ë—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî –≤ –≤—ã–≤–æ–¥–µ RSpec –ø—Ä–∏–º–µ—Ä—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º ¬´behaves like ...¬ª. `include_examples` –≤—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –≤ —Ç–µ–∫—É—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (inline, –±–µ–∑ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏).

–î–ª—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –ø–æ–¥—Ö–æ–¥–∏—Ç `it_behaves_like` ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤–∏–¥–µ–Ω –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω–∞—è ¬´—Ä–æ–ª—å¬ª –≤ –æ—Ç—á—ë—Ç–µ:

```
BookingSearchValidator when client is b2c and region is domestic
  behaves like a booking search validator
    responds to valid?
    responds to errors
  validates check_in date
```

`include_examples` —É–¥–æ–±–µ–Ω –∫–æ–≥–¥–∞ –æ–±—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ‚Äî —á–∞—Å—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—â–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ `describe`), –∏ –≤–ª–æ–∂–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∞ –≤ –≤—ã–≤–æ–¥–µ –Ω–µ –Ω—É–∂–Ω–∞.

**–î–ª—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã—Ö –æ–∂–∏–¥–∞–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞** (–æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏ [–∞—É–¥–∏—Ç–µ](#45-–∞—É–¥–∏—Ç-–¥—É–±–ª–∏–∫–∞—Ç—ã-–∏-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã)):

```ruby
RSpec.shared_examples 'a booking search validator' do
  it('responds to valid?') { expect(validator).to respond_to(:valid?) }
  it('responds to errors') { expect(validator).to respond_to(:errors) }
  it('responds to normalized_params') { expect(validator).to respond_to(:normalized_params) }
end

describe BookingSearchValidator do
  subject(:validator) { described_class.new(params, client_type: client_type, region: region) }

  context 'when client is b2c' do
    let(:client_type) { :b2c }

    context 'and region is domestic' do
      let(:region) { :domestic }
      let(:params) { { check_in: '2025-11-01', check_out: '2025-11-03', guests: 2 } }

      it_behaves_like 'a booking search validator'

      it 'validates check_in date' do
        expect(validator.valid?).to be true
      end
    end
    # ...
  end
end
```

–ö–∞–∂–¥—ã–π –ª–∏—Å—Ç–æ–≤–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### 15. Request specs –≤–º–µ—Å—Ç–æ controller specs

Controller specs —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏: Rails core –∏ RSpec core –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç Request specs –Ω–∞—á–∏–Ω–∞—è —Å RSpec 3.5 –∏ Rails 5.0. Request specs –ø—Ä–æ–≤–µ—Ä—è—é—Ç HTTP-–∫–æ–Ω—Ç—Ä–∞–∫—Ç —á–µ—Ä–µ–∑ –ø–æ–ª–Ω—ã–π —Å—Ç–µ–∫ Rack ‚Üí middleware ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Äî —Ç–æ, —á—Ç–æ –≤–∏–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç. Controller specs –æ–±—Ö–æ–¥—è—Ç middleware, —Ä–æ—É—Ç–∏–Ω–≥ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é ‚Äî —Ç–µ—Å—Ç –º–æ–∂–µ—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç—å, –ø–æ–∫–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è.

```ruby
# —É—Å—Ç–∞—Ä–µ–≤—à–∏–π controller spec
describe UsersController do
  it 'shows user' do
    get :show, params: { id: 1 }
    expect(assigns(:user)).to be_present
  end
end
```

```ruby
# request spec ‚Äî HTTP-–∫–æ–Ω—Ç—Ä–∞–∫—Ç
describe 'GET /users/:id' do
  let(:user) { create(:user) }

  it 'returns user data' do
    get "/users/#{user.id}"
    expect(response).to have_http_status(:ok)
    expect(response.parsed_body['id']).to eq(user.id)
  end
end
```

**–ù–∞–±–ª—é–¥–∞–π—Ç–µ —á–µ—Ä–µ–∑ HTTP-–∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∞ –Ω–µ —á–µ—Ä–µ–∑ –ë–î.** Request spec –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ, —á—Ç–æ –≤–∏–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç API. –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ –ë–î ‚Äî –≤–∞–ª–∏–¥–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ, –Ω–æ –Ω–∞ –¥—Ä—É–≥–æ–º —É—Ä–æ–≤–Ω–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏; –¥–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –º–æ–¥–µ–ª–∏.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî –∫–ª–∏–µ–Ω—Ç API –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ Session.count
it "creates a session" do
  post "/sessions", params: creds
  expect(Session.count).to eq 1
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º HTTP-–∫–æ–Ω—Ç—Ä–∞–∫—Ç
it "returns an access token" do
  post "/sessions", params: creds
  expect(response).to have_http_status(:created)
  expect(response.parsed_body.fetch("token")).to be_present
end
```

–î–ª—è –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤—ã–±–∏—Ä–∞–π—Ç–µ Request specs. Legacy controller specs –ø–æ–º–µ—á–∞–π—Ç–µ —Ç–µ–≥–æ–º `:legacy` –∏ –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é.

### 16. –°—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è

–ï—Å–ª–∏ —Ç–µ—Å—Ç –∑–∞–≥–∞–¥–æ—á–Ω–æ –ø–∞–¥–∞–µ—Ç –æ–∫–æ–ª–æ –ø–æ–ª—É–Ω–æ—á–∏, –ø—Ä–∏ —Å–º–µ–Ω–µ DST –∏–ª–∏ –≤ –∫–æ–Ω—Ü–µ –º–µ—Å—è—Ü–∞ ‚Äî –≤—Ä–µ–º—è –Ω–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ. Rails –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç [`ActiveSupport::Testing::TimeHelpers`](https://api.rubyonrails.org/v5.2.3/classes/ActiveSupport/Testing/TimeHelpers.html) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî flaky —Ç–µ—Å—Ç —Å Time.now
describe 'daily report' do
  it 'includes today transactions' do
    create(:transaction, created_at: Time.now)
    report = DailyReport.generate
    expect(report.transactions).not_to be_empty
  end
end
# –ï—Å–ª–∏ —Ç–µ—Å—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –≤ 23:59:59, –∞ report.generate –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤ 00:00:00 ‚Äî
# —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ–∫–∞–∂–µ—Ç—Å—è "–≤—á–µ—Ä–∞" –∏ —Ç–µ—Å—Ç —É–ø–∞–¥—ë—Ç.
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî –≤—Ä–µ–º—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
describe 'daily report' do
  it 'includes today transactions' do
    freeze_time do
      create(:transaction, created_at: Time.current)
      report = DailyReport.generate
      expect(report.transactions).not_to be_empty
    end
  end
end
```

- `freeze_time` / `travel_to` –±–µ–∑ –±–ª–æ–∫–∞ —Ç—Ä–µ–±—É—é—Ç `after { travel_back }` ‚Äî –∏–Ω–∞—á–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Ç–µ—á—ë—Ç.
- –û–ø–∏—Ä–∞–π—Ç–µ—Å—å –Ω–∞ `Time.zone.now`/`Time.current`, –Ω–µ –Ω–∞ `Time.now`/`Date.today` (–æ–Ω–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç –∑–æ–Ω—É).
- –§–∏–∫—Å–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –¥–Ω—è (`travel_to(Time.zone.parse('2024-03-25 12:00'))`). –ü–æ–ª–Ω–æ—á—å ‚Äî –∑–æ–Ω–∞ —Ä–∏—Å–∫–∞: –ø–µ—Ä–µ—Ö–æ–¥ DST —Å–¥–≤–∏–≥–∞–µ—Ç —á–∞—Å—ã –Ω–∞ ¬±1 —á–∞—Å, `Date.today` –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å `Date.yesterday`, timezone offset –º–µ–Ω—è–µ—Ç—Å—è. –ï—Å–ª–∏ —Ç–µ—Å—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –Ω–∞ 23:30 –∏ DST —Å–¥–≤–∏–≥–∞–µ—Ç –≤—Ä–µ–º—è –Ω–∞ +1 —á–∞—Å ‚Äî –≤—ã –ø–æ–ø–∞–¥–∞–µ—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å. 12:00 –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ ¬±1 —á–∞—Å (—Ç–∏–ø–∏—á–Ω—ã–π DST-—Å–¥–≤–∏–≥) –Ω–µ –ø–µ—Ä–µ–±—Ä–æ—Å–∏—Ç –≤—Ä–µ–º—è –≤ –¥—Ä—É–≥–æ–π –¥–µ–Ω—å.

### 17. –î–µ–ª–∞–π—Ç–µ –≤—ã–≤–æ–¥ –ø–∞–¥–µ–Ω–∏—è —á–∏—Ç–∞–µ–º—ã–º

–ï—Å–ª–∏ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –≤—ã –≤–∏–¥–∏—Ç–µ —Å—Ç–µ–Ω—É escaped JSON –∏–ª–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–π diff ‚Äî –≤—ã–≤–æ–¥ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –∞ –º–µ—à–∞–µ—Ç. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –º–∞—Ç—á–µ—Ä—ã: –≤—ã–≤–æ–¥ –¥–æ–ª–∂–µ–Ω –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ.

```ruby
# –ø–ª–æ—Ö–æ ‚Äî escaped JSON —Å—Ç–µ–Ω–∞
it 'returns response payload' do
  expect(response.body).to eq(
    "{\"meta\":{\"status\":\"ok\",\"total\":3},\"data\":[...]}"
  )
end
# –≤—ã–≤–æ–¥ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏:
# expected: "{\"meta\":{\"status\":\"ok\",\"total\":3},\"data\":[{\"id\":1,\"name\":\"Alice\"},{\"id\":2,\"name\":\"Bob\"},{\"id\":3,\"name\":\"Carol\"}],\"errors\":[]}"
#      got: "{\"meta\":{\"status\":\"ok\",\"total\":2},\"data\":[{\"id\":1,\"name\":\"Alice\"},{\"id\":3,\"name\":\"Carol\"}],\"errors\":[]}"
# ‚Äî –Ω–∞–π–¥–∏—Ç–µ –¥–≤–∞ –æ—Ç–ª–∏—á–∏—è
```

```ruby
# —Ö–æ—Ä–æ—à–æ ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –¥–∏—Ñ—Ñ
describe 'GET /users' do
  subject(:payload) { JSON.parse(response.body, symbolize_names: true) }

  it 'returns metadata and users' do
    expect(payload.fetch(:meta)).to include(status: 'ok', total: 3)
    expect(payload.fetch(:data)).to match_array([
      include(id: 1, name: 'Alice'),
      include(id: 2, name: 'Bob'),
      include(id: 3, name: 'Carol')
    ])
    expect(payload.fetch(:errors)).to be_empty
  end
end
# –≤—ã–≤–æ–¥ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏:
# expected collection contained: [{id: 1, name: "Alice"}, {id: 2, name: "Bob"}, {id: 3, name: "Carol"}]
# actual collection contained:   [{id: 1, name: "Alice"}, {id: 3, name: "Carol"}]
# the missing elements were:     [{id: 2, name: "Bob"}]
```

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è (`match_array`, `include`, `have_attributes`), —á—Ç–æ–±—ã RSpec –ø–æ–∫–∞–∑—ã–≤–∞–ª –ø—Ä–µ–¥–º–µ—Ç–Ω—ã–π –¥–∏—Ñ—Ñ. –§–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º (`JSON.parse`, `deep_symbolize_keys`).

---

## –ß—Ç–æ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ

–ö–æ–≥–¥–∞ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –≤–º–µ—Å—Ç–µ, —Ç–µ—Å—Ç—ã –ø—Ä–∏–æ–±—Ä–µ—Ç–∞—é—Ç —Ç—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:

**–õ–µ–≥–∫–æ —á–∏—Ç–∞—Ç—å.** –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞—ë—Ç –æ–¥–Ω–æ —Ä–∞–∑–ª–∏—á–∏–µ, –∫–∞–∂–¥—ã–π `it` –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Ñ–∞–±—Ä–∏–∫–∏ –ø—Ä—è—á—É—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —Ä—É—Ç–∏–Ω—É, –∞ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∞ –æ–ø–∏—Å–∞–Ω–∏–π —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π —Ä–∏—Ç–º —á—Ç–µ–Ω–∏—è. –ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞ ‚Äî —É—Å–∏–ª–∏—è —Ç—Ä–∞—Ç—è—Ç—Å—è –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –¥–æ–º–µ–Ω–∞, –∞ –Ω–µ –Ω–∞ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫—É —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–¥–∞.

**–°–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –¥–∏–∑–∞–π–Ω–∞.** –ì–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å `any_instance`, —Ä–∞–∑–¥—É—Ç—ã–µ —Ñ–∞–±—Ä–∏–∫–∏ —Å –¥–µ—Å—è—Ç–∫–∞–º–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ ‚Äî –∫–∞–∂–¥—ã–π –∏–∑ —ç—Ç–∏—Ö —Å–∏–º–ø—Ç–æ–º–æ–≤ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –≤ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–º –∫–æ–¥–µ (Do One Thing, —Ç–µ—Å–Ω–æ–µ —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ, God Object). –¢–µ—Å—Ç—ã ‚Äî —á–µ—Å—Ç–Ω–æ–µ –∑–µ—Ä–∫–∞–ª–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

**–†–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è.** –û—Ç—á—ë—Ç RSpec —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –±–∏–∑–Ω–µ—Å-–¥–æ–∫—É–º–µ–Ω—Ç: –º–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤—ã–≤–æ–¥ –∏ –≤–∏–¥–∏—Ç `OrderService#place when user has a payment card and card balance covers the price places the order` ‚Äî –Ω–∏–∫–∞–∫–æ–≥–æ Ruby, —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–º–µ–Ω–∞. –¢–µ—Å—Ç-—Å—å—é—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∂–∏–≤–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Å—Ç–∞—Ä–µ–≤–∞–µ—Ç.

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤: –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ RSpec

–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä ‚Äî –≤ [guide.api.ru.md](guide.api.ru.md).

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ RSpec Request specs –¥–ª—è –ø–æ–≤–µ–¥–µ–Ω–∏—è: HTTP-—Å—Ç–∞—Ç—É—Å—ã, –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –∏ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã.
- –î–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON-–æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (JSON Schema, rswag, Pact).
- –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤ –¥–µ—Å—è—Ç–∫–∞—Ö `expect`: –¥–µ—Ä–∂–∏—Ç–µ –µ–≥–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞ –≤ RSpec –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞.

## –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

- **HTTP-–∑–∞–ø—Ä–æ—Å—ã.** –†–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤ —Ç–µ—Å—Ç–∞—Ö –∑–∞–ø—Ä–µ—â–µ–Ω—ã: –≤–∫–ª—é—á–∞–π—Ç–µ WebMock –∏ —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ —ç–º—É–ª–∏—Ä—É–µ–º—ã–µ —Ö–æ—Å—Ç—ã.
- **–§–∏–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.** –ü—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º –ø—Ä–æ—Ç–æ–∫–æ–ª–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VCR. –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–µ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç ‚Äî –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã: Pact –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å ‚Üî –ø–æ—Å—Ç–∞–≤—â–∏–∫, `rspec-openapi` –∏–ª–∏ RSwag –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π OpenAPI-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.
- **–û—á–µ—Ä–µ–¥–∏ –∏ —Ñ–æ–Ω–æ–≤—ã–µ –¥–∂–æ–±—ã.** –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ñ–∞–∫—Ç –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (`expect { ... }.to have_enqueued_job`) –∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –¥–∂–æ–±—ã ‚Äî –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —é–Ω–∏—Ç-—Ç–µ—Å—Ç.

## –ù—é–∞–Ω—Å—ã –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É Ruby –∏ PostgreSQL

- `Date#wday` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 –¥–ª—è –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è; `EXTRACT(DOW FROM ...)` –≤ PostgreSQL ‚Äî —Ç–æ–∂–µ 0 –¥–ª—è –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è, –Ω–æ 1 –¥–ª—è –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞. –°–æ–≤–º–µ—â–∞—è Ruby- –∏ SQL-–ø—Ä–æ–≤–µ—Ä–∫–∏, —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –æ–∂–∏–¥–∞–µ–º—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ —è–≤–Ω–æ.
- `Date.current.beginning_of_week` –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è `Rails.application.config.beginning_of_week`, –∞ `date_trunc('week', ...)` –≤ PostgreSQL –ø–æ ISO –≤—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞.
- `Date.parse`/`Time.parse` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç `Time.zone`, —Ç–æ–≥–¥–∞ –∫–∞–∫ ActiveRecord —Ö—Ä–∞–Ω–∏—Ç `timestamp` –≤ UTC. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Time.zone.parse`, `Time.zone.local` –∏ `in_time_zone`.
- –ü–µ—Ä–µ—Ö–æ–¥—ã —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å –∏ DST: —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –¥–Ω—è –∏ –ø–∏—à–∏—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥—ã, –µ—Å–ª–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –∫—Ä–∞–π–Ω–∏–µ —Ç–æ—á–∫–∏.

## –ú–∏–≥—Ä–∞—Ü–∏—è legacy-—Ç–µ—Å—Ç–æ–≤

<details>
<summary>–ú–∏–≥—Ä–∞—Ü–∏—è –æ—Ç implementation-focused –∫ behavior-focused —Ç–µ—Å—Ç–∞–º</summary>

1. –ù–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π—Ç–µ –≤—Å—ë —Å—Ä–∞–∑—É ‚Äî –Ω–∞—á–Ω–∏—Ç–µ —Å —Ñ–∞–π–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—â–µ –º–µ–Ω—è—é—Ç—Å—è –∏–ª–∏ –ª–æ–º–∞—é—Ç—Å—è.
2. –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏: –Ω–∞–π–¥–∏—Ç–µ —Ç–µ—Å—Ç—ã —Å `receive`/`allow`/–ø—Ä–∏–≤–∞—Ç–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ ‚Üí –ø–µ—Ä–µ–ø–∏—à–∏—Ç–µ —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
3. –ú–∞—Ä–∫–∏—Ä—É–π—Ç–µ legacy-—Ç–µ—Å—Ç—ã —Ç–µ–≥–æ–º `:legacy` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.

```ruby
# –¥–æ: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
it 'calls notification service' do
  expect(NotificationService).to receive(:send_email).with(user.email)
  subject.process_order(order)
end

# –ø–æ—Å–ª–µ: –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ
it 'sends confirmation email to user' do
  expect { subject.process_order(order) }
    .to change { ActionMailer::Base.deliveries.count }.by(1)

  email = ActionMailer::Base.deliveries.last
  expect(email.to).to include(user.email)
  expect(email.subject).to include('Order Confirmation')
end
```

</details>

<details>
<summary>–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≥–ª—É–±–æ–∫–∏—Ö –∏–µ—Ä–∞—Ä—Ö–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤</summary>

1. –í—ã–ø–∏—à–∏—Ç–µ –≤—Å–µ —É—Å–ª–æ–≤–∏—è –∏–∑ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö `context` –∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞).
2. –û–±—ä–µ–¥–∏–Ω–∏—Ç–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —É—Å–ª–æ–≤–∏—è –≤ –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `shared_examples` –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –ø—Ä–æ–≤–µ—Ä–æ–∫.
4. –ï—Å–ª–∏ –≥–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –æ—Å—Ç–∞—ë—Ç—Å—è ‚Äî —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç–µ –∫–æ–¥ (Do One Thing).

```ruby
# –¥–æ: 6 —É—Ä–æ–≤–Ω–µ–π
describe '#process_payment' do
  context 'when user is authenticated' do
    context 'when user has payment card' do
      context 'when card is verified' do
        context 'when balance is sufficient' do
          context 'when transaction is not duplicate' do
            context 'when fraud check passes' do
              it 'processes payment'
            end
          end
        end
      end
    end
  end
end

# –ø–æ—Å–ª–µ: –ª–æ–≥–∏—á–µ—Å–∫–∏–µ –≥—Ä—É–ø–ø—ã
describe '#process_payment' do
  context 'when all payment prerequisites are met' do
    let(:user) { create(:user, :authenticated, :with_verified_card) }
    before { user.payment_card.update(balance: 1000) }

    it 'processes payment successfully'
  end

  context 'when payment is blocked' do
    # fraud/duplicate checks
  end

  context 'when payment fails' do
    # failure cases
  end
end
```

</details>

<details>
<summary>–í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º</summary>

1. –í—ã–±–µ—Ä–∏—Ç–µ spec-—Ñ–∞–π–ª —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–æ 4.
2. –ü–æ–∫–∞–∂–∏—Ç–µ –∫–æ–º–∞–Ω–¥–µ —Ä–∞–∑–Ω–∏—Ü—É –≤ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.
3. –§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö: flaky —Ç–µ—Å—Ç—ã, —Å–ª–æ–∂–Ω—ã–µ —Ñ–∞–π–ª—ã, —á–∞—Å—Ç–æ –ª–æ–º–∞—é—â–∏–µ—Å—è.
4. –ù–µ —Ç—Ä–µ–±—É–π—Ç–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –¥–µ–ª–∞–π—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–∞—Å–∞–Ω–∏–∏ –∫–æ–¥–∞.

</details>

## –†–µ—Å—É—Ä—Å—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

- **Better Specs** ‚Äî —Å—Ç–∏–ª—å –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏: —á–∏—Ç–∞–µ–º—ã–µ `describe/context/it`, –≤—ã–±–æ—Ä –º–∞—Ç—á–µ—Ä–æ–≤ –∏ –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã. <https://www.betterspecs.org>
- **Testing for Beginners** ‚Äî –≤–≤–æ–¥–Ω–∞—è –∫–Ω–∏–≥–∞: —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –º—ã—Å–ª–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –∏ —Ä–∞–∑–±–∏—Ä–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã. <http://testing-for-beginners.rubymonstas.org/index.html>
- **Pluralsight: RSpec Ruby Application Testing** ‚Äî hands-on –∫—É—Ä—Å: BDD-—Ü–∏–∫–ª, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `describe/context/it` –∏ —Ç—Ä–∏ —Ñ–∞–∑—ã —Ç–µ—Å—Ç–∞. <https://www.pluralsight.com/courses/rspec-ruby-application-testing>
- **Everyday Rails Testing with RSpec** ‚Äî –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: factory_bot, VCR/WebMock, –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã. <https://leanpub.com/everydayrailsrspec>

## –ì–ª–æ—Å—Å–∞—Ä–∏–π

<details>
<summary>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è</summary>

##### –ü–æ–≤–µ–¥–µ–Ω–∏–µ

–ù–∞–±–ª—é–¥–∞–µ–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ –µ—ë —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –≤–Ω–µ—à–Ω–µ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ.

**–ü—Ä–∏–º–µ—Ä—ã –ø–æ–≤–µ–¥–µ–Ω–∏–π:**
- "–°–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
- "–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ email"
- "–ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
- "–í—ã—á–∏—Å–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å —É—á—ë—Ç–æ–º —Å–∫–∏–¥–∫–∏"

**–ù–ï —è–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è–º–∏:**
- –ö–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
- –ö–∞–∂–¥–æ–µ –ø–æ–ª–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ API-–æ—Ç–≤–µ—Ç–∞
- –ö–∞–∂–¥—ã–π –≥–µ—Ç—Ç–µ—Ä value object

–ï—Å–ª–∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —ç—Ç–æ —á–∞—Å—Ç—å –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

##### –î–æ–º–µ–Ω

–ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∏–ª–∏ –±–∏–∑–Ω–µ—Å-–¥–æ–º–µ–Ω. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –∏–∑ Domain-Driven Design (DDD). –í —Ç–µ—Å—Ç–∞—Ö –º—ã —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–º–µ–Ω–∞ –¥–æ–º–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º –≤–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤.

##### –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —á–µ—Ä–µ–∑ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–µ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã. –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç, –≤–∞–∂–Ω—ã–π –¥–ª—è –±–∏–∑–Ω–µ—Å–∞. –ú–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—ã–π —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º: "—Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç X".

##### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–±–æ—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –æ–±—ä–µ–∫—Ç–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –µ–¥–∏–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –û–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "–æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å X". –î–ª—è HTTP API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (—Å–º. [guide.api.ru.md](guide.api.ru.md)).

</details>

<a id="—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è"></a>
<details>
<summary>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è</summary>

##### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞

[–î–æ–º–µ–Ω–Ω—ã–π](#–¥–æ–º–µ–Ω) –∞—Å–ø–µ–∫—Ç, –≤–ª–∏—è—é—â–∏–π –Ω–∞ –∏—Å—Ö–æ–¥ –ø–æ–≤–µ–¥–µ–Ω–∏—è (—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã, —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞). *–ö–∞–∫ –Ω–∞–π—Ç–∏:* —Å–ø—Ä–æ—Å–∏—Ç–µ "–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç—É —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É, –∏–∑–º–µ–Ω–∏—Ç—Å—è –ª–∏ –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?".

##### –°–æ—Å—Ç–æ—è–Ω–∏–µ

–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –≤–∞–∂–Ω—ã–π –¥–ª—è –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –±–∞–ª–∞–Ω—Å –Ω–∏–∂–µ –ª–∏–º–∏—Ç–∞). –¢–∏–ø—ã: –±–∏–Ω–∞—Ä–Ω—ã–µ (–¥–∞/–Ω–µ—Ç), –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ (enum), –¥–∏–∞–ø–∞–∑–æ–Ω—ã (—á–∏—Å–ª–æ/–¥–∞—Ç–∞).

##### –ö–æ–Ω—Ç–µ–∫—Å—Ç

–ë–ª–æ–∫ `context`, —Ñ–∏–∫—Å–∏—Ä—É—é—â–∏–π –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. –¢–∏–ø—ã: –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è), –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π (–Ω–∞—Ä—É—à–µ–Ω–æ/–æ—Ç—Ä–∏—Ü–∞–µ—Ç—Å—è), –≤–ª–æ–∂–µ–Ω–Ω—ã–π (—É—Ç–æ—á–Ω—è–µ—Ç –≤–Ω–µ—à–Ω–∏–π).

##### –ö–µ–π—Å

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π (–±–ª–æ–∫ `it`), –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –Ω–∞–±–æ—Ä–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π. Happy path ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫; corner case ‚Äî –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ.

##### –ó–∞–¥–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–û–±—ä—è–≤–ª–µ–Ω–∏–µ (`let`/`before`), –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∞–µ—Ç —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–∏–Ω–Ω–æ–π. –†–∞–∑–º–µ—â–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ–¥ `context`.

##### Flaky test

–¢–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–æ–≥–¥–∞ –∑–µ–ª—ë–Ω—ã–π, –∏–Ω–æ–≥–¥–∞ –∫—Ä–∞—Å–Ω—ã–π –ø—Ä–∏ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–º –∫–æ–¥–µ. –ß–∞—â–µ —Å–≤—è–∑–∞–Ω —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º, –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

</details>

<a id="–ø—Ä–∏–Ω—Ü–∏–ø—ã-–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"></a>
<details>
<summary>–ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</summary>

##### Do One Thing

–ü—Ä–∏–Ω—Ü–∏–ø –∏–∑ Clean Code: —Ñ—É–Ω–∫—Ü–∏—è/–º–µ—Ç–æ–¥/–∫–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –¥–µ–ª–æ. **–°–∏–≥–Ω–∞–ª –≤ —Ç–µ—Å—Ç–∞—Ö:** –≥–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (5+ —É—Ä–æ–≤–Ω–µ–π), –¥–µ—Å—è—Ç–∫–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –¥–ª—è –æ–¥–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞.

##### Single Responsibility Principle

–ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø—Ä–∏—á–∏–Ω—É –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è. **–°–∏–≥–Ω–∞–ª –≤ —Ç–µ—Å—Ç–∞—Ö:** —Å–ª–æ–∂–Ω—ã–µ —Ñ–∞–±—Ä–∏–∫–∏ —Å –¥–µ—Å—è—Ç–∫–∞–º–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π.

##### –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è

–°–æ–∫—Ä—ã—Ç–∏–µ –¥–µ—Ç–∞–ª–µ–π –∑–∞ –ø—É–±–ª–∏—á–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º. **–°–∏–≥–Ω–∞–ª –≤ —Ç–µ—Å—Ç–∞—Ö:** —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –≤—ã–∑–æ–≤—ã (`receive`), –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∑–Ω–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Å—Ö–µ–º—ã –ë–î.

##### Dependency Injection

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ–±—ä–µ–∫—Ç—É –∏–∑–≤–Ω–µ, –∞ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏. **–°–∏–≥–Ω–∞–ª –≤ —Ç–µ—Å—Ç–∞—Ö:** –Ω—É–∂–µ–Ω `any_instance_of`, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∏–∑–æ–ª—è—Ü–∏–∏.

##### Tight Coupling

–ö–ª–∞—Å—Å—ã —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞. **–°–∏–≥–Ω–∞–ª –≤ —Ç–µ—Å—Ç–∞—Ö:** –¥–ª—è —Ç–µ—Å—Ç–∞ –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.

##### Leaky Abstraction

–î–µ—Ç–∞–ª–∏ –Ω–∏–∂–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è "–ø—Ä–æ—Ç–µ–∫–∞—é—Ç" —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. **–°–∏–≥–Ω–∞–ª –≤ —Ç–µ—Å—Ç–∞—Ö:** –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∑–Ω–∞—Ç—å –¥–µ—Ç–∞–ª–∏ —Å—Ö–µ–º—ã –ë–î –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª—å—é.

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã —Å–ª–æ–∂–Ω—ã–µ ‚Äî –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥–∏–∑–∞–π–Ω–µ –∫–æ–¥–∞. –ù–µ —É—Å–ª–æ–∂–Ω—è–π—Ç–µ —Ç–µ—Å—Ç—ã, —É–ø—Ä–æ—â–∞–π—Ç–µ –∫–æ–¥.

</details>
