# –ù–∞–≤–∏–≥–∞—Ü–∏—è

- [–ß—Ç–æ –º–æ–∂–Ω–æ –∏–∑—É—á–∏—Ç—å –ø–æ —Ç–µ—Å—Ç–∞–º](#—á—Ç–æ-–º–æ–∂–Ω–æ-–∏–∑—É—á–∏—Ç—å-–ø–æ-—Ç–µ—Å—Ç–∞–º)
- [–ü—Ä–æ RSpec](#–ø—Ä–æ-rspec)
- [–ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è](#–ø–∏—Ä–∞–º–∏–¥–∞-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è-–∏-–≤—ã–±–æ—Ä-—É—Ä–æ–≤–Ω—è)
- [–ì–ª–æ—Å—Å–∞—Ä–∏–π](#–≥–ª–æ—Å—Å–∞—Ä–∏–π)
- [RSpec style guide](#rspec-style-guide)
  - [–ü–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤](#–ø–æ–≤–µ–¥–µ–Ω–∏–µ-–∏-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ç–µ—Å—Ç–æ–≤)
  - [–°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å](#—Å–∏–Ω—Ç–∞–∫—Å–∏—Å-–∏-—á–∏—Ç–∞–µ–º–æ—Å—Ç—å)
  - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –¥–∞–Ω–Ω—ã—Ö](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞-–∏-–¥–∞–Ω–Ω—ã—Ö)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤: –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ RSpec](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-api-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤-–≥—Ä–∞–Ω–∏—Ü—ã-–ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏-rspec)
  - [–ü–æ–ª–Ω—ã–π –≥–∞–π–¥ –ø–æ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º](guide.api.ru.md)
- [–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã](#–≤–Ω–µ—à–Ω–∏–µ-—Å–µ—Ä–≤–∏—Å—ã)
- [–ù—é–∞–Ω—Å—ã –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É Ruby –∏ PostgreSQL](#–Ω—é–∞–Ω—Å—ã-–≤—Ä–µ–º–µ–Ω–∏-–º–µ–∂–¥—É-ruby-–∏-postgresql)

# –ß—Ç–æ –º–æ–∂–Ω–æ –∏–∑—É—á–∏—Ç—å –ø–æ —Ç–µ—Å—Ç–∞–º

- **Better Specs** ‚Äî —Å—Ç–∏–ª—å –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏: –Ω–∞—É—á–∏—Ç–µ—Å—å –ø–∏—Å–∞—Ç—å —á–∏—Ç–∞–µ–º—ã–µ `describe/context/it`, –≤—ã–±–∏—Ä–∞—Ç—å –º–∞—Ç—á–µ—Ä—ã –∏ –∏–∑–±–µ–≥–∞—Ç—å –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤. <https://www.betterspecs.org>
- **Testing for Beginners** ‚Äî –≤–≤–æ–¥–Ω–∞—è –∫–Ω–∏–≥–∞: –ø–æ–π–º—ë—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫ –º—ã—Å–ª–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ –∏ —Ä–∞–∑–±–∏—Ä–∞—Ç—å –∫—Ä–∞—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã. <http://testing-for-beginners.rubymonstas.org/index.html>
- **Pluralsight: RSpec Ruby Application Testing** ‚Äî hands-on –∫—É—Ä—Å: —à–∞–≥ –∑–∞ —à–∞–≥–æ–º –ø–æ—Å—Ç—Ä–æ–∏—Ç–µ BDD-—Ü–∏–∫–ª, –∑–∞–∫—Ä–µ–ø–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `describe/context/it` –∏ —Ç—Ä–∏ —Ñ–∞–∑—ã —Ç–µ—Å—Ç–∞. <https://www.pluralsight.com/courses/rspec-ruby-application-testing>
- **Everyday Rails Testing with RSpec** ‚Äî –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: –æ—Ç factory_bot –¥–æ VCR/WebMock, –ø–ª—é—Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±–∞–∑–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è. <https://leanpub.com/everydayrailsrspec>

–≠—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–∞–¥—É—Ç –±–∞–∑—É. –ù–∏–∂–µ ‚Äî —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è RSpec/BDD, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –¥–µ—Ä–∂–∞—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞.

# –ü—Ä–æ RSpec

RSpec ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Ruby —Å DSL, –∑–∞—Ç–æ—á–µ–Ω–Ω—ã–º –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∞ –Ω–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

```ruby
describe "my app" do
  it "works" do
    expect(MyApp.working).to eq(true)
  end
end
```

–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª–æ–≥–∞–Ω –Ω–∞ <https://rspec.info/>:

```
Behaviour Driven Development for Ruby.
Making TDD Productive and Fun.
```

–ö–ª—é—á–µ–≤–∞—è –º—ã—Å–ª—å: RSpec ‚Äî –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç BDD –¥–ª—è Ruby. –û–Ω –¥–µ–ª–∞–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫—É TDD –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–π –∏ –±–æ–ª–µ–µ "—á–µ–ª–æ–≤–µ—á–Ω–æ–π" –∑–∞ —Å—á–µ—Ç —è–∑—ã–∫–∞, –±–ª–∏–∑–∫–æ–≥–æ –∫ –±–∏–∑–Ω–µ—Å-—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º.

## –ö–∞–∫ —Å–≤—è–∑–∞–Ω—ã RSpec, BDD –∏ TDD

TDD (test-driven development) ‚Äî –∫–æ—Ä–æ—Ç–∫–∏–π —Ü–∏–∫–ª Red -> Green -> Refactor:

- –ø–∏—à–µ–º —Ç–µ—Å—Ç, —Ñ–∏–∫—Å–∏—Ä—É—é—â–∏–π –∂–µ–ª–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ;
- –ø–∏—à–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥, —á—Ç–æ–±—ã —Ç–µ—Å—Ç –ø—Ä–æ—à–µ–ª;
- —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–º, —Å–æ—Ö—Ä–∞–Ω—è—è –∑–µ–ª–µ–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

BDD (behaviour-driven development) –≤—ã—Ä–æ—Å –∏–∑ TDD –∏ —Å–º–µ—â–∞–µ—Ç —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–º–µ–Ω–∞ –∏ —è–∑—ã–∫ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å –±–∏–∑–Ω–µ—Å–æ–º. –¢–µ—Å—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —á–∏—Ç–∞–µ–º–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∫–æ–¥–∞.

RSpec –≤–æ–ø–ª–æ—â–∞–µ—Ç BDD –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º–µ Ruby: `describe/context/it` –ø–æ–º–æ–≥–∞—é—Ç —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ.

## –ó–∞—á–µ–º –Ω–∞–º BDD –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ

- –ï–¥–∏–Ω—ã–π —è–∑—ã–∫ —Å –±–∏–∑–Ω–µ—Å–æ–º: —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ–º –ø—Ä–∞–≤–∏–ª–∞ –¥–æ–º–µ–Ω–∞ "—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º–∏" —Ñ—Ä–∞–∑–∞–º–∏, –Ω–µ –∑–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
- –ò—Å–ø–æ–ª–Ω—è–µ–º–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: —Ç–µ—Å—Ç—ã ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ–º–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è.
- –ë—ã—Å—Ç—Ä–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º: —É–ø–∞–≤—à–∏–π —Ç–µ—Å—Ç —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞—Ä—É—à–µ–Ω–æ.
- –°–≤–æ–±–æ–¥–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥: —Ñ–æ–∫—É—Å –Ω–∞ —Ç–æ–º, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞, –∞ –Ω–µ –∫–∞–∫ –æ–Ω–∞ —É—Å—Ç—Ä–æ–µ–Ω–∞.

**–ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å** ‚Äî –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª –∏ –ø–æ–Ω—è—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±–∏–∑–Ω–µ—Å —Ö–æ—á–µ—Ç –≤–∏–¥–µ—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –±–∏–ª–ª–∏–Ω–≥). –í –∫–æ–¥–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –∏–º–µ–Ω–Ω–æ —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

## –û—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞ –∫ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ–º—É —Å–∏–Ω—Ç–∞–∫—Å–∏—Å—É Gherkin

BDD —á–∞—Å—Ç–æ –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ Gherkin ‚Äî —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π, –Ω–æ —á–∏—Ç–∞–µ–º—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–π –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤. –û–Ω —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ç—Ä–∏ –∫–ª—é—á–µ–≤—ã–µ —Ñ–∞–∑—ã: Given (–∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç), When (–¥–µ–π—Å—Ç–≤–∏–µ), Then (—Ä–µ–∑—É–ª—å—Ç–∞—Ç).

–ü—Ä–∏–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

```
As a store owner
In order to keep track of stock
I want to add items back to stock when they're returned.

Scenario 1: Refunded items should be returned to stock
  Given that a customer previously bought a black sweater from me
  And I have three black sweaters in stock
  When they return the black sweater for a refund
  Then I should have four black sweaters in stock

Scenario 2: Replaced items should be returned to stock
  Given that a customer previously bought a blue garment from me
  And I have two blue garments in stock
  And three black garments in stock
  When they return the blue garment for a replacement in black
  Then I should have three blue garments in stock
  And two black garments in stock
```

–ò –∞–¥–∞–ø—Ç–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º:

```
–ö–∞–∫ –≤–ª–∞–¥–µ–ª–µ—Ü –º–∞–≥–∞–∑–∏–Ω–∞
–ß—Ç–æ–±—ã —Å–ª–µ–¥–∏—Ç—å –∑–∞ –∑–∞–ø–∞—Å–∞–º–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ
–Ø —Ö–æ—á—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –Ω–∞ —Å–∫–ª–∞–¥, –∫–æ–≥–¥–∞ –∏—Ö –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª–∏.

–°—Ü–µ–Ω–∞—Ä–∏–π 1: –í–æ–∑–≤—Ä–∞—â–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∫–ª–∞–¥
  –î–∞–Ω–æ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç —Ä–∞–Ω–µ–µ –∫—É–ø–∏–ª —É –º–µ–Ω—è —á–µ—Ä–Ω—ã–π —Å–≤–∏—Ç–µ—Ä
  –ò –Ω–∞ —Å–∫–ª–∞–¥–µ –µ—Å—Ç—å —Ç—Ä–∏ —Ç–∞–∫–∏—Ö —Å–≤–∏—Ç–µ—Ä–∞
  –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–∏—Ç–µ—Ä
  –¢–æ–≥–¥–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–µ—Ç—ã—Ä–µ —á–µ—Ä–Ω—ã—Ö —Å–≤–∏—Ç–µ—Ä–∞

–°—Ü–µ–Ω–∞—Ä–∏–π 2: –û–±–º–µ–Ω–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ —Å–∫–ª–∞–¥
  –î–∞–Ω–æ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –ø–æ–∫—É–ø–∞–ª —É –º–µ–Ω—è –æ–¥–µ–∂–¥—É —Å–∏–Ω–µ–≥–æ —Ü–≤–µ—Ç–∞
  –ò –Ω–∞ —Å–∫–ª–∞–¥–µ –µ—Å—Ç—å –¥–≤–∞ —Ç–∞–∫–∏—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Å–∏–Ω–µ–≥–æ —Ü–≤–µ—Ç–∞
  –ò —Ç—Ä–∏ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —á–µ—Ä–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
  –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–∏–Ω—é—é –≤–µ—â—å, —á—Ç–æ–±—ã –æ–±–º–µ–Ω—è—Ç—å –Ω–∞ —á–µ—Ä–Ω—É—é
  –¢–æ–≥–¥–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç—Ä–∏ —Å–∏–Ω–∏—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
  –ò –¥–≤–∞ —á–µ—Ä–Ω—ã—Ö –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è
```

### –Ø–∑—ã–∫ Gherkin ‚Äî –ø–∞–º—è—Ç–∫–∞

| –ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ (EN) | –†—É—Å—Å–∫–∏–π | –ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ |
| --- | --- | --- |
| Story / Feature | –ò—Å—Ç–æ—Ä–∏—è | –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏, —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç —Ü–µ–Ω–Ω–æ—Å—Ç—å. |
| As a | –ö–∞–∫ (–≤ —Ä–æ–ª–∏) | –†–æ–ª—å –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–∏—Ü–∞. |
| In order to | –ß—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å | –¶–µ–ª—å —Ä–æ–ª–∏. |
| I want to | –Ø —Ö–æ—á—É | –ö—Ä–∞—Ç–∫–∏–π –∂–µ–ª–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. |
| Scenario | –°—Ü–µ–Ω–∞—Ä–∏–π | –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å—Ç–æ—Ä–∏–∏. |
| Given | –î–∞–Ω–æ | –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ And). |
| When | –ö–æ–≥–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ, –∑–∞–ø—É—Å–∫–∞—é—â–µ–µ —Å—Ü–µ–Ω–∞—Ä–∏–π. |
| Then | –¢–æ–≥–¥–∞ | –ù–∞–±–ª—é–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å And/But). |
| And / But | –ò / –ù–æ | –£—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è. |

### –ö–∞–∫ —ç—Ç–æ —Å–æ–æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Å RSpec

RSpec –Ω–µ —Ç—Ä–µ–±—É–µ—Ç Gherkin –∏ –Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ—Ç `.feature`-—Ñ–∞–π–ª—ã, –Ω–æ —Å–ª–µ–¥—É–µ—Ç —Ç–µ–º –∂–µ —Å–º—ã—Å–ª–æ–≤—ã–º —Ñ–∞–∑–∞–º:

- **Given** -> –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`let`, `before`, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã).
- **When** -> –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º (–≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞, HTTP-–∑–∞–ø—Ä–æ—Å, –∫–æ–º–∞–Ω–¥–∞).
- **Then** -> –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`expect`-—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è).
- **Feature / Story** -> –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å `describe`, –∑–∞–¥–∞—é—â–∏–π –æ–±–ª–∞—Å—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏—è.
- **Scenario** -> `it`, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –ø–æ–≤–µ–¥–µ–Ω–∏—è.
- **And / But** -> —É—Ç–æ—á–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ `context`.

–≠—Ç–æ –Ω–µ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–¥–∏–Ω-–∫-–æ–¥–Ω–æ–º—É, –Ω–æ —Ç–∞–∫–∞—è –æ–ø—Ç–∏–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç –ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –∫–∞–∫ —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–æ–º–µ–Ω–∞. –ù–∞ —ç—Ç–æ–π –±–∞–∑–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–¥–µ–ª–∞.

## –ü–∏—Ä–∞–º–∏–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è

BDD —Å—Ç–∞–≤–∏—Ç –≤–æ –≥–ª–∞–≤—É —É–≥–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–æ —Å–∞–º–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∂–∏–≤—É—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö. –î–µ—Ä–∂–∏—Ç–µ –≤ –≥–æ–ª–æ–≤–µ –ø–∏—Ä–∞–º–∏–¥—É: –±—ã—Å—Ç—Ä—ã–µ –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏, —Å–µ—Ä–≤–∏—Å–Ω—ã–µ/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ ‚Äî –ø–æ—Å—Ä–µ–¥–∏–Ω–µ, end-to-end –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ ‚Äî –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –ø–æ–º–æ–≥–∞–µ—Ç –Ω–µ —Å–∫–∞—Ç—ã–≤–∞—Ç—å—Å—è –∫ –ø—Ä–æ–≤–µ—Ä–∫–∞–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

| –£—Ä–æ–≤–µ–Ω—å | –í–æ–ø—Ä–æ—Å | –ù–∞–±–ª—é–¥–µ–Ω–∏–µ | –¢–∏–ø–∏—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã |
| --- | --- | --- | --- |
| –Æ–Ω–∏—Ç (–º–æ–¥–µ–ª—å, —Å–µ—Ä–≤–∏—Å, –æ–±—ä–µ–∫—Ç) | –ö–∞–∫ –≤–µ–¥—ë—Ç —Å–µ–±—è –º–∞–ª–µ–Ω—å–∫–∏–π –∫—É—Å–æ–∫ –ª–æ–≥–∏–∫–∏? | –í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –≤—ã–∑–æ–≤—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—á–µ—Ä–µ–∑ doubles) | `expect`, doubles, pure Ruby |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π / —Å–µ—Ä–≤–∏—Å–Ω—ã–π | –ö–∞–∫ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤? | –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–∏—Å–∞, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏, –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã | Request/feature specs, ActiveJob, mailers |
| Request / API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã | –ß—Ç–æ –≤–∏–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç (frontend, –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å)? | HTTP-—Å—Ç–∞—Ç—É—Å, —Ç–µ–ª–æ –æ—Ç–≤–µ—Ç–∞, –∑–∞–≥–æ–ª–æ–≤–∫–∏ | Request specs, pact/contract tests |
| –°–∏—Å—Ç–µ–º–Ω—ã–π (E2E) | –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –∏—Å—Ç–æ—Ä–∏—è —Ü–µ–ª–∏–∫–æ–º? | UI-—Ä–µ–∞–∫—Ü–∏–∏, end-to-end –ø–æ—Ç–æ–∫ | Capybara, Cypress, etc. |

–ñ–µ–ª–µ–∑–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –æ—Ä–∏–µ–Ω—Ç–∏—Ä—ã:

- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞ —Ç–æ–º —É—Ä–æ–≤–Ω–µ, –≥–¥–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞–±–ª—é–¥–∞—Ç—å. Request spec –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å/–æ—Ç–≤–µ—Ç, –∞ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–∑—ã ‚Äî –∏–Ω–∞—á–µ –≤—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞, –∞ –Ω–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç (—Å–º. –ø—Ä–∞–≤–∏–ª–æ 1).
- –ï—Å–ª–∏ –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω–æ–π –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø–æ–¥—É–º–∞–π—Ç–µ, –Ω–µ –ª—É—á—à–µ –ª–∏ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ —á–∞—Å—Ç—å –ª–æ–≥–∏–∫–∏ –≤ –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø–∏—Ä–∞–º–∏–¥—ã.
- –ï–¥–∏–Ω–∏—á–Ω—ã–π –ø–æ–±–æ—á–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç (—Å–æ–∑–¥–∞–Ω–∞ –∑–∞–ø–∏—Å—å, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–∏—Å—å–º–æ) –ª—É—á—à–µ –≤—ã–Ω–æ—Å–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —é–Ω–∏—Ç/—Å–µ—Ä–≤–∏—Å–Ω—ã–π —Ç–µ—Å—Ç. –í BDD-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞—Ö —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –ª–∏—à—å —Ç–æ, —á—Ç–æ –≤–∞–∂–Ω–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é.
- `:aggregate_failures` (–ø—Ä–∞–≤–∏–ª–æ 23) –ø—Ä–∏–º–µ–Ω—è–µ–º, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≥–æ–≤–æ—Ä–∏–º –æ–± –æ–¥–Ω–æ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –∏ —Ö–æ—Ç–∏–º —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—Ä–∞–∑—É ‚Äî —ç—Ç–æ –Ω–µ —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–æ–≤–∏–Ω—É –ø–∏—Ä–∞–º–∏–¥—ã –≤ –æ–¥–Ω–æ–º `it`.

–° –ø–∏—Ä–∞–º–∏–¥–æ–π –≤ –≥–æ–ª–æ–≤–µ –ª–µ–≥—á–µ —Ä–µ—à–∞—Ç—å, —á—Ç–æ —Å—á–∏—Ç–∞—Ç—å happy path, —á—Ç–æ ‚Äî corner case, –∏ –∫–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å —Ç–µ—Å—Ç–æ–≤ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–µ–Ω –∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞.

## –ì–ª–æ—Å—Å–∞—Ä–∏–π

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è

- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ** ‚Äî –Ω–∞–±–ª—é–¥–∞–µ–º–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏–ª–∏ –µ—ë —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –≤–Ω–µ—à–Ω–µ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ.

  –ü–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ BDD –∏ RSpec ‚Äî —ç—Ç–æ –Ω–µ –∫–∞–∂–¥—ã–π –∞—Ç—Ä–∏–±—É—Ç –∏–ª–∏ –º–µ—Ç–æ–¥ –æ–±—ä–µ–∫—Ç–∞, –∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–π –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã—Ö –ª–∏—Ü.

  **–ü—Ä–∏–º–µ—Ä—ã –ø–æ–≤–µ–¥–µ–Ω–∏–π:**
  - "–°–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"
  - "–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ email"
  - "–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ —Å–µ—Å—Å–∏–∏"
  - "–ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
  - "–í—ã—á–∏—Å–ª—è–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å —É—á—ë—Ç–æ–º —Å–∫–∏–¥–∫–∏"
  **–ù–ï —è–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è–º–∏:**
  - –ö–∞–∂–¥—ã–π –æ—Ç–¥–µ–ª—å–Ω—ã–π –∞—Ç—Ä–∏–±—É—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `name`, `email`, `phone` ‚Äî —ç—Ç–æ —á–∞—Å—Ç–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –æ–±—ä–µ–∫—Ç–∞ User)
  - –ö–∞–∂–¥–æ–µ –ø–æ–ª–µ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ API-–æ—Ç–≤–µ—Ç–∞ (–≤—Å–µ –ø–æ–ª—è –≤–º–µ—Å—Ç–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ—Ç–≤–µ—Ç–∞)
  - –ö–∞–∂–¥—ã–π –≥–µ—Ç—Ç–µ—Ä value object (–≥–µ—Ç—Ç–µ—Ä—ã –≤–º–µ—Å—Ç–µ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)

  **–ü—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –æ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∫–∞–∫ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —ç—Ç–æ —á–∞—Å—Ç—å –±–æ–ª–µ–µ –∫—Ä—É–ø–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

### –í–∏–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º, —Ç–µ—Å—Ç—ã –¥–µ–ª—è—Ç—Å—è –Ω–∞ –¥–≤–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∏–ø–∞:

- **–ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Behavioral testing)** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —á–µ—Ä–µ–∑ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–µ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –∏–ª–∏ —Ä–µ–∞–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã. –ö–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–∂–µ–Ω –¥–ª—è –±–∏–∑–Ω–µ—Å–∞.

  **–ü—Ä–∏–º–µ—Ä—ã:**
  - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –º–µ—Ç–æ–¥ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
  - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email
  - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
  - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ

  **–•–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:**
  - –ö–∞–∂–¥—ã–π —ç—Ñ—Ñ–µ–∫—Ç ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
  - –≠—Ñ—Ñ–µ–∫—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
  - –ú–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—ã–π —ç—Ñ—Ñ–µ–∫—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º: "—Å–∏—Å—Ç–µ–º–∞ –¥–µ–ª–∞–µ—Ç X"

- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Interface testing)** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–±–æ—Ä–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –æ–±—ä–µ–∫—Ç–∞ –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏. –í—Å–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/—Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –µ–¥–∏–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: "–æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å".

  **–ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:**
  - Value objects —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ (Money, Address, Coordinate)
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (Settings, Config, Preferences)
  - Read-only –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏–∑ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
  - Presenter/Decorator –æ–±—ä–µ–∫—Ç—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

  **–•–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏:**
  - –ê—Ç—Ä–∏–±—É—Ç—ã —Å–≤—è–∑–∞–Ω—ã –æ–±—â–∏–º –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö
  - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã —Å—Ä–∞–∑—É
  - –ê—Ç—Ä–∏–±—É—Ç—ã —Ñ–æ—Ä–º–∏—Ä—É—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±—ä–µ–∫—Ç–∞
  - –û–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ "–æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å X"

  **–≠–º–ø–∏—Ä–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –≤—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/—Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç—ã, —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –æ–±—ä–µ–¥–∏–Ω–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –æ–¥–∏–Ω `it` —Å `:aggregate_failures`.

  **–í–∞–∂–Ω–æ:** –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∫ –¥–æ–º–µ–Ω–Ω—ã–º –æ–±—ä–µ–∫—Ç–∞–º. –î–ª—è HTTP API-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ (—Å–º. —Ä–∞–∑–¥–µ–ª "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤: –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ RSpec").

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è

- **–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞** ‚Äî –¥–æ–º–µ–Ω–Ω—ã–π –∞—Å–ø–µ–∫—Ç, –≤–ª–∏—è—é—â–∏–π –Ω–∞ –∏—Å—Ö–æ–¥ –ø–æ–≤–µ–¥–µ–Ω–∏—è (—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã, —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞).
  - *–ö–∞–∫ –Ω–∞–π—Ç–∏:* —Å–ø—Ä–æ—Å–∏—Ç–µ ¬´–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∞—Å–ø–µ–∫—Ç, –∏–∑–º–µ–Ω–∏—Ç—Å—è –ª–∏ –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç?¬ª, –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–µ—á—å –∏–¥—ë—Ç –æ –±–∏–∑–Ω–µ—Å-—Ñ–∞–∫—Ç–µ, –∞ –Ω–µ –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–µ—Ç–∞–ª–∏.

- **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏** ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∑–Ω–∞—á–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –≤–∞–∂–Ω—ã–π –¥–ª—è –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –±–∞–ª–∞–Ω—Å –Ω–∏–∂–µ –ª–∏–º–∏—Ç–∞).
  - *–ö–∞–∫ –≤—ã–¥–µ–ª–∏—Ç—å:* —Å–≥—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–æ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –∏ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –∏—Ö –∫–æ—Ä–æ—Ç–∫–∏–º–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è–º–∏.
  - *–¢–∏–ø—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π:*
    - –±–∏–Ω–∞—Ä–Ω—ã–µ (–¥–∞/–Ω–µ—Ç: –∫–∞—Ä—Ç–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ ‚Üî –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–∞);
    - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ (enum: —Ä–æ–ª—å = admin / manager / guest);
    - –¥–∏–∞–ø–∞–∑–æ–Ω—ã (—á–∏—Å–ª–æ/–¥–∞—Ç–∞: –±–∞–ª–∞–Ω—Å ‚â• —Å—Ç–æ–∏–º–æ—Å—Ç—å / –±–∞–ª–∞–Ω—Å < —Å—Ç–æ–∏–º–æ—Å—Ç—å).

- **–ö–æ–Ω—Ç–µ–∫—Å—Ç (`context`)** ‚Äî –±–ª–æ–∫, —Ñ–∏–∫—Å–∏—Ä—É—é—â–∏–π –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. –ö–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ ¬´Given¬ª-—á–∞—Å—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.
  - **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (–æ–±—ã—á–Ω–æ —á–∞—Å—Ç—å happy path).
  - **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞—Ä—É—à–µ–Ω–æ –∏–ª–∏ –æ—Ç—Ä–∏—Ü–∞–µ—Ç—Å—è (—á–∞—Å—Ç–æ —á–∞—Å—Ç—å corner case).
  - **–í–ª–æ–∂–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç** ‚Äî —É—Ç–æ—á–Ω—è–µ—Ç –≤–Ω–µ—à–Ω–∏–π, –¥–æ–±–∞–≤–ª—è—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–æ–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–ª–∏ —É—Ç–æ—á–Ω—è—è —Ç–µ–∫—É—â—É—é.

- **–ö–µ–π—Å / –ø—Ä–∏–º–µ—Ä (`it`)** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –Ω–∞–±–æ—Ä–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π.
  - **Happy path case** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫: –æ–∂–∏–¥–∞–µ–º—ã–π —É—Å–ø–µ—Ö –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π.
  - **Corner case** ‚Äî –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞: –∫—Ä–∞–π–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è, –æ—à–∏–±–∫–∏, –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏.
  - **–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç** ‚Äî –ø—Ä–∏–º–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ (—á–∞—â–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å happy path).
  - **–û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç** ‚Äî –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Ç–∫–∞–∑ –∏–ª–∏ –∑–∞—â–∏—Ç—É –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (—á–∞—Å—Ç–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å corner case).
  - *–í–∞–∂–Ω–æ:* happy/corner –æ–ø–∏—Å—ã–≤–∞—é—Ç —Ç–∏–ø –∫–µ–π—Å–∞, –∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏. –ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è—Ö –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ happy path –∫–µ–π—Å–æ–≤ –±–µ–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —ç—Ç–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–µ.

- **–ó–∞–¥–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è (`let`/`before`)** ‚Äî –æ–±—ä—è–≤–ª–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∞–µ—Ç —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å—Ç–∏–Ω–Ω–æ–π. –ï–≥–æ —Ä–∞–∑–º–µ—â–∞—é—Ç —Å—Ä–∞–∑—É –ø–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º `context`, —á—Ç–æ–±—ã —Å–≤—è–∑—å –º–µ–∂–¥—É –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–∏—Ç–∞–ª–∞—Å—å –±–µ–∑ –ø–æ–∏—Å–∫–∞ –ø–æ —Ñ–∞–π–ª—É (—Å–º. –ø—É–Ω–∫—Ç 11).

| –¢–∏–ø –∫–µ–π—Å–∞       | –¢–∏–ø –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏                  | –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞             |
| --------------- | -------------------------------------- | --------------------------- |
| Happy path case | –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã                | –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç          |
| Corner case     | –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∏–ª–∏ —É—Ç–æ—á–Ω—è—é—â–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã | –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç / –∑–∞—â–∏—Ç–∞ |

–¢–∞–±–ª–∏—Ü–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—É—é —Å–≤—è–∑—å, –Ω–æ –≤–æ–∑–º–æ–∂–Ω—ã –∏—Å–∫–ª—é—á–µ–Ω–∏—è ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, enum-—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ happy path –∫–µ–π—Å–æ–≤ –±–µ–∑ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, –∏–ª–∏ corner case –º–æ–∂–µ—Ç –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, graceful degradation).

- **Flaky test** ‚Äî —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–µ–¥—ë—Ç —Å–µ–±—è –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ: –∏–Ω–æ–≥–¥–∞ –∑–µ–ª—ë–Ω—ã–π, –∏–Ω–æ–≥–¥–∞ –∫—Ä–∞—Å–Ω—ã–π –ø—Ä–∏ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–º –∫–æ–¥–µ. –ß–∞—â–µ –≤—Å–µ–≥–æ —Å–≤—è–∑–∞–Ω —Å –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º, –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, —Å–ª—É—á–∞–π–Ω—ã–º –ø–æ—Ä—è–¥–∫–æ–º –∏–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤.

# RSpec style guide

## –ü–æ—á–µ–º—É –º—ã –ø–∏—à–µ–º —Ç–µ—Å—Ç—ã –∏–º–µ–Ω–Ω–æ —Ç–∞–∫: –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞

–í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ —ç—Ç–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –æ–¥–Ω–∞ —Ü–µ–ª—å: **—Å–Ω–∏–∑–∏—Ç—å –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏, –ø–æ–Ω–∏–º–∞–Ω–∏–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤**.

**–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** ‚Äî —ç—Ç–æ –æ–±—ä–µ–º —É–º—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É—Å–∏–ª–∏–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏. –í –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ç–µ—Å—Ç–æ–≤ —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- –°–∫–æ–ª—å–∫–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤ –ø–∞–º—è—Ç–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ—Å—Ç?
- –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π —Ç–µ—Å—Ç –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏?
- –ù–∞—Å–∫–æ–ª—å–∫–æ –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π?

### –¢—Ä–∏ —Ç–∏–ø–∞ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö

1. **–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞** ‚Äî —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å–∞–º–æ–π –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏. –≠—Ç–æ –Ω–µ–∏–∑–±–µ–∂–Ω–æ: –µ—Å–ª–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ —Å–ª–æ–∂–Ω–æ–µ, —Ç–µ—Å—Ç –±—É–¥–µ—Ç –æ—Ç—Ä–∞–∂–∞—Ç—å —ç—Ç—É —Å–ª–æ–∂–Ω–æ—Å—Ç—å.

2. **–ü–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞** ‚Äî –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∏–∑-–∑–∞ –ø–ª–æ—Ö–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞. –ü—Ä–∏–º–µ—Ä—ã:
   - –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤–º–µ—Å—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è ‚Üí —á–∏—Ç–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ "–≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ –≤ –≥–æ–ª–æ–≤–µ"
   - –°–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ —Å–∫—Ä—ã—Ç—ã –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –º–µ—Ç–æ–¥–∞—Ö ‚Üí –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
   - –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–≤–µ–¥–µ–Ω–∏–π –≤ –æ–¥–Ω–æ–º `it` ‚Üí –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞—Ä—É—à–µ–Ω–æ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏

3. **–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞** ‚Äî —É—Å–∏–ª–∏—è –Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏. –•–æ—Ä–æ—à–∏–µ —Ç–µ—Å—Ç—ã –ø–æ–º–æ–≥–∞—é—Ç —Å—Ç—Ä–æ–∏—Ç—å —ç—Ç—É –º–æ–¥–µ–ª—å –±—ã—Å—Ç—Ä–æ:
   - –Ø–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `context` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
   - –û–ø–∏—Å–∞–Ω–∏–µ `it` —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ
   - –¢—Ä—ë—Ö—ç—Ç–∞–ø–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Given-When-Then) —É–ø—Ä–æ—â–∞–µ—Ç —á—Ç–µ–Ω–∏–µ

### –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–∞ —Å–Ω–∏–∂–∞—é—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É

–ö–∞–∂–¥–æ–µ –ø—Ä–∞–≤–∏–ª–æ –≤ —ç—Ç–æ–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ –∞—Ç–∞–∫—É–µ—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω—é—é –Ω–∞–≥—Ä—É–∑–∫—É –∏ —É—Å–∏–ª–∏–≤–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é:

- **–ü—Ä–∞–≤–∏–ª–æ 1** (–ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è) ‚Äî —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞—Ç—å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–æ–¥–∞
- **–ü—Ä–∞–≤–∏–ª–æ 5** (–∏–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤) ‚Äî –¥–µ–ª–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –≤–∏–¥–∏–º—ã–º–∏ —Å—Ä–∞–∑—É
- **–ü—Ä–∞–≤–∏–ª–æ 10** (subject) ‚Äî —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è, –Ω–µ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –æ–±—ä–µ–∫—Ç –≤ –æ–∂–∏–¥–∞–Ω–∏—è—Ö
- **–ü—Ä–∞–≤–∏–ª–æ 11** (—Ç—Ä—ë—Ö—ç—Ç–∞–ø–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞) ‚Äî —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —á—Ç–µ–Ω–∏—è
- **–ü—Ä–∞–≤–∏–ª–∞ 12-13** (—Ñ–∞–±—Ä–∏–∫–∏) ‚Äî —Å–∫—Ä—ã–≤–∞—é—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏, –æ—Å—Ç–∞–≤–ª—è—é—Ç —Ç–æ–ª—å–∫–æ –±–∏–∑–Ω–µ—Å-—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
- **–ü—Ä–∞–≤–∏–ª–æ 16** (—è–≤–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ DRY) ‚Äî —Ç–µ—Å—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π, –∞ –Ω–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫–æ–π –∏–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
- **–ü—Ä–∞–≤–∏–ª–æ 23** (aggregate_failures) ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—Ä–∞–∑—É, —ç–∫–æ–Ω–æ–º—è —Ü–∏–∫–ª—ã –æ—Ç–ª–∞–¥–∫–∏

–ö–æ–≥–¥–∞ –≤—ã —Å–ª–µ–¥—É–µ—Ç–µ —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–∞–º, –≤–∞—à–∏ —Ç–µ—Å—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è **–∏—Å–ø–æ–ª–Ω—è–µ–º–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π**: –∫–æ–ª–ª–µ–≥–∏ –º–æ–≥—É—Ç –±—ã—Å—Ç—Ä–æ –ø–æ–Ω—è—Ç—å –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –Ω–æ–≤—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ª–µ–≥–∫–æ –≤–Ω–∏–∫–∞—é—Ç –≤ –¥–æ–º–µ–Ω, –∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏–µ –ø–æ–ª–æ–≤–∏–Ω—ã test suite.

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤–æ–ø—Ä–æ—Å "–∞ —á—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç?" –∏–ª–∏ "–æ—Ç–∫—É–¥–∞ —ç—Ç–æ –±–µ—Ä—ë—Ç—Å—è?", –∑–Ω–∞—á–∏—Ç –ø–æ—Å—Ç–æ—Ä–æ–Ω–Ω—è—è –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∞. –£–ø—Ä–æ—Å—Ç–∏—Ç–µ.

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1. –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

–ï—Å–ª–∏ –≤ –≤–∞—à–µ–º —Ç–µ—Å—Ç–µ –Ω–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è [–ø–æ–≤–µ–¥–µ–Ω–∏—è](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø–æ–Ω—è—Ç–∏—è), —Ç–æ —ç—Ç–æ –Ω–µ —Ç–µ—Å—Ç. –ü–æ—á–µ–º—É? –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø—Ä–∏–≤—è–∑–∫–∞
–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –ø–æ—Å–ª–µ –≤–∞—Å –∫—Ç–æ-—Ç–æ –±—É–¥–µ—Ç —Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ—Å—Ç—ã - –æ–Ω –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–π–º–µ—Ç –∏ —Ç–µ—Å—Ç—ã –æ–∫–∞–∂—É—Ç—Å—è –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º–∏.

###### –¥–∞–ª–µ–µ `some_action` –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö - —ç—Ç–æ –ø—Å–µ–≤–¥–æ–∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Ç–µ—Å—Ç–∏—Ä—É–µ–º –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã –æ–ø–∏—Å—ã–≤–∞–µ–º

```ruby
# –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ
describe "#some_action" do
  # ... —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ –Ω–µ —Å–≤—è–∑—ã–≤–∞–µ–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
  it "true" do          # –∏–∑ —ç—Ç–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–µ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ñ–∞–∫—Ç —Ç–æ–≥–æ, —á—Ç–æ –º—ã –æ–∂–∏–¥–∞–µ–º `true`
    expect(some_action).to be(true)
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe "#some_action" do
  # ... —Å–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —è–≤–Ω–æ –∑–∞–¥–∞—ë–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É, –æ –∫–æ—Ç–æ—Ä–æ–π –≥–æ–≤–æ—Ä–∏–º –≤ `it`
  it "allows unlocking the user" do         # —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–º –æ —Ç–æ–º, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –Ω–∞—à–µ –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç –∫–æ–¥–∞
    expect(some_action).to be(true)
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –û–ø–∏—Å–∞–Ω–∏–µ `it` –Ω–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏; –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–π `true`.
- –ö–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–µ —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–æ–π –ø—Ä–∏–º–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

–ò–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `match_array` –∏–ª–∏ `contain_exactly`, –∫–æ–≥–¥–∞ –ø–∏—à–∏—Ç–µ –æ–∂–∏–¥–∞–Ω–∏–µ –¥–ª—è –º–∞—Å—Å–∏–≤–∞, –ø–æ—Ä—è–¥–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–∞–º –Ω–µ –≤–∞–∂–µ–Ω.

```ruby
# –ø–ª–æ—Ö–æ
expect(some_action).to eq [1, 2, 3] # pass
```

```ruby
# —Ö–æ—Ä–æ—à–æ
expect(some_action).to match_array [2, 3, 1] # pass
expect(some_action).to contain_exactly(1, 2, 3) # pass
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ `eq` –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç —Ç–µ—Å—Ç –∫ –ø–æ—Ä—è–¥–∫—É —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –≤–µ–¥—ë—Ç –∫ –ª–æ–∂–Ω—ã–º –ø–∞–¥–µ–Ω–∏—è–º.
- –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –∞ –Ω–µ –ø—Ä–∞–≤–∏–ª–æ.

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º —á—Ç–æ `some_action` –≤–æ–∑–≤—Ä–∞—â–∞–ª –≤—Å–µ–≥–¥–∞ `[1, 2, 3]` –∏ –≤–∞—à–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥–∏–ª–∏,
–ø–æ—Ç–æ–º –≤—ã –≤–Ω–µ—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥, –æ–±–Ω–æ–≤–∏–ª–∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ —Ç.–¥. –¢–æ –µ—Å—Ç—å –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –ø–æ—Ä—è–¥–æ–∫ –≤ –º–∞—Å—Å–∏–≤–µ –∏–∑–º–µ–Ω–∏–ª—Å—è,
–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–Ω —Å—Ç–∞–ª `[2, 1, 3]`,
–∏ —É –≤–∞—Å –Ω–∞—á–∞–ª–∞ –ø–∞–¥–∞—Ç—å –¥—é–∂–∏–Ω–∞ —Ç–µ—Å—Ç–æ–≤. –ò –≤—Å–µ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –∏–∑-–∑–∞ –≤–∞—à–µ–π –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!
–ù–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫, —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
–ï—Å–ª–∏ —ç—Ç–æ –≤—ã–±–æ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö, —Ç–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ñ–∞–∫—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

–í —Ü–µ–ª–æ–º, –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∫–∞–∫ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –ª—é–±–æ–π –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π (–º–∞—Å—Å–∏–≤—ã, —Ö–µ—à–∏, ActiveRecord::Relation ...)
–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ `eq`, —Ç–æ —ç—Ç–æ –∑–≤–æ–Ω–æ—á–µ–∫, —á—Ç–æ –≤—ã –¥–µ–ª–∞–µ—Ç–µ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫. –í–æ–∑–º–æ–∂–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ö–µ–ª–ø–µ—Ä –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `RSpec Expectations`, –ø–æ–¥—Ö–æ–¥—è—â–∏–π
–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è, –∞ –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã –≤ –ø—Ä–∏–Ω—Ü–∏–ø–µ –Ω–µ —Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ (–Ω–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞) –∏–ª–∏ –¥–∞–∂–µ –Ω–µ —Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç–µ.

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ (`"allows unlocking the user"`) —Å–æ–∑–¥–∞—ë—Ç –º–µ–Ω—Ç–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —á–∏—Ç–∞—Ç—å –∫–æ–¥
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞—Ç—á–µ—Ä (`match_array` –≤–º–µ—Å—Ç–æ `eq`) —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ: "–ø—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–∞–≤, –∞ –Ω–µ –ø–æ—Ä—è–¥–æ–∫"
- –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ —Å —è—Å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å—Ä–∞–∑—É –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ –Ω–∞—Ä—É—à–µ–Ω–æ ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

### 2. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç

–ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ª–æ–≤–∏—Ç –±–∞–≥–∏ ‚Äî —Å–ª–æ–º–∞–π—Ç–µ –∫–æ–¥ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç. –≠—Ç–æ –≤—Ç–æ—Ä–æ–µ –ø–æ –≤–∞–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ –ø–æ—Å–ª–µ "—Ç–µ—Å—Ç–∏—Ä—É–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ": –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–∞ –≤—ã —Ä–∏—Å–∫—É–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –ª–æ–∂–Ω–æ-–∑–µ–ª—ë–Ω—ã–π —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞.

#### –ü—Ä–æ–±–ª–µ–º–∞: code-first –≤–º–µ—Å—Ç–æ test-first

–í –∏–¥–µ–∞–ª—å–Ω–æ–º –º–∏—Ä–µ TDD (test-driven development) —Ü–∏–∫–ª "Red ‚Üí Green ‚Üí Refactor" –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Ç–µ—Å—Ç —Å–Ω–∞—á–∞–ª–∞ –ø–∞–¥–∞–µ—Ç (Red), –∞ –∑–∞—Ç–µ–º –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Green). –ù–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ –Ω–µ —Å–ª–µ–¥—É–µ—Ç —Å—Ç—Ä–æ–≥–æ–º—É TDD ‚Äî —Å–Ω–∞—á–∞–ª–∞ –ø–∏—à–µ—Ç—Å—è –∫–æ–¥, –ø–æ—Ç–æ–º —Ç–µ—Å—Ç—ã. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ —Ä–∏—Å–∫—É "–ø–æ–¥–≥–æ–Ω–∫–∏ —Ç–µ—Å—Ç–∞ –ø–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é": —Ç–µ—Å—Ç –Ω–∞–ø–∏—Å–∞–Ω —Ç–∞–∫, —á—Ç–æ –æ–Ω –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –Ω–æ –Ω–µ –ª–æ–≤–∏—Ç –æ—à–∏–±–∫–∏.

**–¢–∏–ø–∏—á–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**

1. –í—ã –Ω–∞–ø–∏—Å–∞–ª–∏ –∫–æ–¥
2. –ù–∞–ø–∏—Å–∞–ª–∏ —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ—Ö–æ–¥–∏—Ç
3. –ó–∞–∫–æ–º–º–∏—Ç–∏–ª–∏
4. –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –∫—Ç–æ-—Ç–æ –ª–æ–º–∞–µ—Ç –∫–æ–¥
5. –¢–µ—Å—Ç –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–µ–ª—ë–Ω—ã–π ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

#### –ù–∞–¥—É–º–∞–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –û–ø—ã—Ç–Ω–æ–º—É —á–∏—Ç–∞—Ç–µ–ª—é –±—É–¥–µ—Ç –æ—á–µ–≤–∏–¥–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ, –Ω–æ –∞–≤—Ç–æ—Ä—É –≥–∞–π–¥–∞ —Å–ª–æ–∂–Ω–æ –ø—Ä–∏–¥—É–º–∞—Ç—å –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä. –¢–∞–∫–∏–µ —Å–∏—Ç—É–∞—Ü–∏–∏ –æ—á–µ–Ω—å –∫–æ–≤–∞—Ä–Ω—ã –∏ –ª–µ–≥–∫–æ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø–æ–≤—Å–µ–º–µ—Å—Ç–Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –∫–æ–¥–µ, —á–∞—Å—Ç–æ –≤ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –≥–¥–µ –æ—à–∏–±–∫–∞ –Ω–µ —Ç–∞–∫ –∑–∞–º–µ—Ç–Ω–∞.

```ruby
# –∫–æ–¥
class NotificationService
  def notify_user(user, message)
    UserMailer.notification(user.email, message).deliver_later
  end
end
```

```ruby
# –ø–ª–æ—Ö–æ
describe NotificationService do
  let(:user) { double(email: 'user@example.com') }
  let(:mailer) { double(deliver_later: true) }

  before do
    allow(UserMailer).to receive(:notification).and_return(mailer)
  end

  it 'sends notification to user' do
    service.notify_user(user, 'Hello')
    expect(UserMailer).to have_received(:notification)
  end
end
```

**–ß—Ç–æ –Ω–µ —Ç–∞–∫:**

- –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Ñ–∞–∫—Ç –≤—ã–∑–æ–≤–∞ `notification`, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã
- –ï—Å–ª–∏ –∫–æ–¥ —Å–ª–æ–º–∞–µ—Ç—Å—è –∏ –Ω–∞—á–Ω—ë—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `nil` –≤–º–µ—Å—Ç–æ email –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ ‚Äî —Ç–µ—Å—Ç –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –∑–µ–ª—ë–Ω—ã–º
- –ö–∞–∂–µ—Ç—Å—è, —á—Ç–æ –≤—Å—ë –ø–æ–∫—Ä—ã—Ç–æ, –Ω–æ –ø–æ —Ñ–∞–∫—Ç—É –∫—Ä–∏—Ç–∏—á–Ω–∞—è —á–∞—Å—Ç—å (–ø–µ—Ä–µ–¥–∞—á–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö) –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

#### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —á–µ–∫-–ª–∏—Å—Ç

–ü–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ "—Ä—É—á–Ω–æ–π Red":

1. ‚úÖ –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç (Green)
2. üî® –°–ª–æ–º–∞–π—Ç–µ –∫–æ–¥ –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:
   - –í–µ—Ä–Ω–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (`return 0`, `return nil`, `return "wrong"`)
   - –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∫–ª—é—á–µ–≤—É—é —Å—Ç—Ä–æ–∫—É –ª–æ–≥–∏–∫–∏
   - –ò–∑–º–µ–Ω–∏—Ç–µ —É—Å–ª–æ–≤–∏–µ (`if` ‚Üí `unless`, `>` ‚Üí `<`)
   - –ü–µ—Ä–µ–¥–∞–π—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–æ–≤
3. ‚ùå –¢–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —É–ø–∞—Å—Ç—å (Red)
4. üîÑ –í–µ—Ä–Ω–∏—Ç–µ –∫–æ–¥ –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
5. ‚úÖ –¢–µ—Å—Ç —Å–Ω–æ–≤–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç (Green)

–ï—Å–ª–∏ –Ω–∞ —à–∞–≥–µ 3 —Ç–µ—Å—Ç –æ—Å—Ç–∞–ª—Å—è –∑–µ–ª—ë–Ω—ã–º ‚Äî –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–π—Ç–µ —Ç–µ—Å—Ç, –æ–Ω –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –¢–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∞–¥–∞–ª, –Ω–µ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∏—á–µ–≥–æ. –°–ª–æ–º–∞–π—Ç–µ –∫–æ–¥ –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ—Å—Ç –ª–æ–≤–∏—Ç –ø–æ–ª–æ–º–∫—É ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –õ–æ–∂–Ω–æ-–∑–µ–ª—ë–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞—é—Ç –∏–ª–ª—é–∑–∏—é –ø–æ–∫—Ä—ã—Ç–∏—è –∏ –∑–∞—Å—Ç–∞–≤–ª—è—é—Ç –∫–æ–º–∞–Ω–¥—É –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–º–Ω–µ–≤–∞—Ç—å—Å—è: "–∞ —Ç–æ—á–Ω–æ —ç—Ç–æ—Ç —Ç–µ—Å—Ç —á—Ç–æ-—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç?"
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ "—Ä—É—á–Ω–æ–π Red" –¥–∞—ë—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ –≤–æ–ø—Ä–æ—Å "–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —ç—Ç–æ—Ç —Ç–µ—Å—Ç –≤–æ–æ–±—â–µ?"
- –ö–æ–º–∞–Ω–¥–∞ –º–æ–∂–µ—Ç –¥–æ–≤–µ—Ä—è—Ç—å test suite –∏ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —É—Å–∏–ª–∏—è –Ω–∞ –Ω–µ–¥–æ–≤–µ—Ä–∏–µ –∫ —Ç–µ—Å—Ç–∞–º

### 3. –ö–∞–∂–¥—ã–π example (`it`) –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–Ω–æ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

–û–ø–∏—Å–∞–Ω–∏–µ –≤ `it` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ–± –æ–¥–Ω–æ–π –±–∏–∑–Ω–µ—Å-–∏—Å—Ç–∏–Ω–µ. –ï—Å–ª–∏ –¥–≤–∞ –ø—Ä–∏–º–µ—Ä–∞ –Ω–∞–∑—ã–≤–∞—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –∑–Ω–∞—á–∏—Ç –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ä–∞–∑–Ω—ã–º–∏ –ø—É—Ç—è–º–∏. –≠—Ç–æ –∑–∞–ø–∞—Ö: –ª–∏–±–æ –Ω—É–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–µ [–ø–æ–≤–µ–¥–µ–Ω–∏–µ](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø–æ–Ω—è—Ç–∏—è), –ª–∏–±–æ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ –ø–∏—Ä–∞–º–∏–¥–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

- –û–¥–∏–Ω `it` = –æ–¥–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è –∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ = –æ–¥–Ω–æ –∫–ª—é—á–µ–≤–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ.
- –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –≤—ã–±–∏—Ä–∞–µ–º –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (HTTP-—Å—Ç–∞—Ç—É—Å, —Ç–µ–ª–æ –æ—Ç–≤–µ—Ç–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ), –∞ –Ω–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –¥–æ–≥–æ–≤–æ—Ä–∏–ª–∞—Å—å –∏–Ω–∞—á–µ.
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–µ–¥—Å—Ç–≤–∏–π –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞, —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ –∏—Ö –Ω–∞ —Ä–∞–∑–Ω—ã–µ `it`. `:aggregate_failures` –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–∏—à—å –∫–æ–≥–¥–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç–µ –æ–± –æ–¥–Ω–æ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ (—Å–º. –ø—É–Ω–∫—Ç 23).

–¢–µ—Å—Ç ‚Äî —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏, –∞ –Ω–µ –º–∏–Ω–∏-–ø—Ä–æ–≥—Ä–∞–º–º–∞. –ß–µ–º —Ç–æ—á–Ω–µ–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞ `it`, —Ç–µ–º –ª–µ–≥—á–µ —á–∏—Ç–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é.

```ruby
# –ø–ª–æ—Ö–æ
it "creates a user" do
  expect { post_signup }.to change(User, :count)
  expect(response).to redirect_to dashboard_path
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
it "redirects user to dashboard after signup" do
  post_signup
  expect(response).to redirect_to dashboard_path
end

it "persists the user after signup" do
  expect { post_signup }.to change(User, :count)
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–ø—Ä—è—Ç–∞–Ω—ã –≤ –æ–¥–Ω–æ–º `it`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞—Ä—É—à–µ–Ω–æ.
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –æ—Ç—á—ë—Ç–µ RSpec —Ç–µ—Ä—è–µ—Ç —Å–≤—è–∑—å —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∏ —Ç–µ—Å—Ç –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –±—ã—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–µ–π.
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –æ—Ç—á—ë—Ç–µ RSpec –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∞ —Ç–∞–∫ –∂–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Ç–µ—Å—Ç—É, —á—Ç–æ–±—ã —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è, –∫–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—ã–ª–æ –æ–∂–∏–¥–∞–µ–º—ã–º, –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –æ–ø–∏—Å–∞–Ω–∏—è –≤ –æ—Ç—á–µ—Ç–µ.

Request spec –ø—Ä–∏–º–µ—Ä. –ú—ã —Ö–æ—Ç–∏–º —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞, –∏ –≤—ã–±–∏—Ä–∞–µ–º –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ API, –∞ –Ω–µ –ë–î:

```ruby
# –ø–ª–æ—Ö–æ
it "creates a session" do
  post "/sessions", params: creds
  expect(Session.count).to eq 1
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
it "returns an access token" do
  post "/sessions", params: creds
  expect(response).to have_http_status(:created)
  expect(response.parsed_body.fetch("token")).to be_present
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –Ω–∞–ø—Ä—è–º—É—é –∏ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤–º–µ—Å—Ç–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
- –ü–∞–¥–µ–Ω–∏–µ —Ç–∞–∫–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø–æ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ ¬´–∑–∞–ø–∏—Å—å –Ω–µ —Å–æ–∑–¥–∞–Ω–∞¬ª, –∞ –Ω–µ —Ç–æ, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏—à—ë–ª –Ω–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç.

> –ù–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ JSON —Ü–µ–ª–∏–∫–æ–º —Å—Ç—Ä–æ–∫–æ–π: —Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª 22 (¬´–î–µ–ª–∞–π—Ç–µ –≤—ã–≤–æ–¥ –ø–∞–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ —á–∏—Ç–∞–µ–º—ã–º¬ª) ‚Äî —Ç–∞–º –ø–æ–∫–∞–∑–∞–Ω–æ, –∫–∞–∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –¥–∏—Ñ—Ñ –ø–æ–º–æ–≥–∞–µ—Ç —É–≤–∏–¥–µ—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å—Ä–∞–∑—É.

–ï—Å–ª–∏ –≤ `it` –ø–æ—è–≤–ª—è–µ—Ç—Å—è –º–Ω–æ–≥–æ `expect`, —ç—Ç–æ –æ–±—ã—á–Ω–æ —Å–∏–≥–Ω–∞–ª: –º—ã –ø—ã—Ç–∞–µ–º—Å—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤–º–µ—Å—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –¢–∏–ø–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ welcome-–ø–∏—Å—å–º–∞. –í request-spec –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å/–æ—Ç–≤–µ—Ç API, –∞ —Ñ–∞–∫—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞ –æ–ø—É—Å–∫–∞–µ–º –Ω–∞ —É—Ä–æ–≤–µ–Ω—å —é–Ω–∏—Ç/—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (–∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–∏—Ä–∞–º–∏–¥–µ –∏ –ø–∏—à–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –µ—Å–ª–∏ –ø–∏—Å—å–º–æ ‚Äî —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ). –ù–µ –ø—Ä–µ–≤—Ä–∞—â–∞–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –º–∞–ª–µ–Ω—å–∫—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É: —Ü–∏–∫–ª—ã, —É—Å–ª–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —Ç–µ—Å—Ç–∞—Ö ‚Äî –ø—Ä—è–º–æ–π –ø—Ä–∏–∑–Ω–∞–∫, —á—Ç–æ –º—ã –ø–µ—Ä–µ—Å—Ç–∞–ª–∏ –æ–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –∏ –Ω–∞—á–∞–ª–∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é.

**–ü–æ—á–µ–º—É –Ω–µ —Å—Ç–æ–∏—Ç —Å–æ–≤–º–µ—â–∞—Ç—å –º–Ω–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏–π –≤ –æ–¥–∏–Ω `it`:**

–•–æ—Ç—è —ç—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç —Ç–µ—Å—Ç—ã (–¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑, –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –ø–∞–¥–µ–Ω–∏–∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è), —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø—Ä–æ–±–ª–µ–º–∞–º:

1. –ú–µ–Ω–µ–µ —á–∏—Ç–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ —Å–∞–º —Ç–µ—Å—Ç
2. –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—é –≤ `it`
3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–∑–æ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –æ–∂–∏–¥–∞–Ω–∏—è–º–∏
4. **–ì–ª–∞–≤–Ω–æ–µ:** —ç—Ç–æ –∑–∞–ø–∞—Ö –ø–ª–æ—Ö–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞ –∫–æ–¥–∞ ‚Äî –µ—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –≤–µ—â–µ–π, –∑–Ω–∞—á–∏—Ç –∫–æ–¥ –¥–µ–ª–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑–Ω—ã—Ö –≤–µ—â–µ–π, –Ω–∞—Ä—É—à–∞—è –ø—Ä–∏–Ω—Ü–∏–ø "Do One Thing" (Clean Code, Robert Martin)

–ï—Å–ª–∏ —Ç–µ—Å—Ç—ã —Å—Ç–∞–ª–∏ "—Å–ª–∏—à–∫–æ–º —É–º–Ω—ã–º–∏", –≤–µ—Ä–æ—è—Ç–Ω–æ —Ç–∞–∫–æ–≤ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π –∫–æ–¥. –†–∞–∑–¥–µ–ª–∏—Ç–µ –∫–æ–¥ –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ —á–∞—Å—Ç–∏, –Ω–∞–ø–∏—à–∏—Ç–µ –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–π, –∑–∞—Ç–µ–º –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è –∏—Ö –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏.

#### 2.1. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏—Ö –Ω–∞–±–æ—Ä —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ (—Å–º. "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" –≤ –≥–ª–æ—Å—Å–∞—Ä–∏–∏), –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–∂–∏–¥–∞–Ω–∏–π –≤ –æ–¥–Ω–æ–º `it` —Å `:aggregate_failures` –¥–æ–ø—É—Å—Ç–∏–º—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –µ–¥–∏–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: "–æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–¥–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏".

**–ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

- Value objects —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ (Money, Address, Coordinate)
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (Settings, Config, Preferences)
- Read-only –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏–∑ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- Presenter/Decorator –æ–±—ä–µ–∫—Ç—ã, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã

**–≠–º–ø–∏—Ä–∏—á–µ—Å–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –≤—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—Å–µ –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/—Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –Ω–µ –≤–∫–ª—é—á–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç—ã, –æ–±—ä–µ–¥–∏–Ω–∏—Ç–µ –∏—Ö –≤ –æ–¥–∏–Ω `it` —Å `:aggregate_failures`.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–æ–º, –∫–æ–≥–¥–∞ `:aggregate_failures` –¥–æ–ø—É—Å—Ç–∏–º –∏ –∫–∞–∫–∏–µ –µ—Å—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, —Å–º. [–ø—Ä–∞–≤–∏–ª–æ 23](#23-–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ-aggregate_failures-—Ç–æ–ª—å–∫–æ-–∫–æ–≥–¥–∞-–æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ-–æ–¥–Ω–æ-–ø—Ä–∞–≤–∏–ª–æ).

**–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –¥–ª—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤:**

- ‚úÖ `'exposes product catalog interface'` ‚Äî —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- ‚úÖ `'returns complete order summary'` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ `'builds user profile from session data'` ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –∏ —á—Ç–æ —Å—Ç—Ä–æ–∏—Ç—Å—è
- ‚úÖ `'provides shipping address details'` ‚Äî —á—ë—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

**–ò–∑–±–µ–≥–∞–π—Ç–µ:**

- ‚ùå `'works correctly'` ‚Äî —Å–ª–∏—à–∫–æ–º –æ–±—â–µ–µ, –Ω–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
- ‚ùå `'returns correct values'` ‚Äî –Ω–µ —è—Å–Ω–æ, –∫–∞–∫–∏–µ –∏–º–µ–Ω–Ω–æ –∑–Ω–∞—á–µ–Ω–∏—è
- ‚ùå `'has valid attributes'` ‚Äî —Ä–∞—Å–ø–ª—ã–≤—á–∞—Ç–æ, –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```ruby
# –ø–ª–æ—Ö–æ: over-splitting –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
describe ProductPresenter do
  let(:product) { create(:product, name: 'Laptop', price: 999.99, stock: 5, sku: 'LPT-001') }
  subject(:presenter) { described_class.new(product) }
  
  it('returns product name') { expect(presenter.display_name).to eq('Laptop') }
  it('returns formatted price') { expect(presenter.formatted_price).to eq('$999.99') }
  # ... –µ—â–µ 2 –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è availability –∏ SKU
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ: –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å aggregate_failures
describe ProductPresenter do
  let(:product) { create(:product, name: 'Laptop', price: 999.99, stock: 5, sku: 'LPT-001') }
  subject(:presenter) { described_class.new(product) }

  it 'exposes product display interface', :aggregate_failures do
    expect(presenter.display_name).to eq('Laptop')
    expect(presenter.formatted_price).to eq('$999.99')
    # ... –µ—â–µ 2 –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è availability –∏ SKU
  end

  # –û—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è
  context 'when product is out of stock' do
    let(:product) { create(:product, stock: 0) }
    it('indicates unavailability') { expect(presenter.availability).to eq('Out of Stock') }
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –ß–µ—Ç—ã—Ä–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç —á–∞—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∫–æ—Ç–æ—Ä—ã–π presenter –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `product`.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö (product) –ø—Ä–∏–¥—ë—Ç—Å—è –æ–±–Ω–æ–≤–ª—è—Ç—å –≤—Å–µ —á–µ—Ç—ã—Ä–µ —Ç–µ—Å—Ç–∞, —Ö–æ—Ç—è –æ–Ω–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –µ–¥–∏–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
- –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç, —á—Ç–æ –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã —Å–≤—è–∑–∞–Ω—ã –∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–µ–∑–µ–Ω—Ç–µ—Ä–∞.

–ß—Ç–æ –¥–∞—ë—Ç —Ö–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä:

- –û–¥–∏–Ω —Ç–µ—Å—Ç —Å `:aggregate_failures` —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç: "presenter –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è".
- –í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤–º–µ—Å—Ç–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç –µ–¥–∏–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
- –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è `out of stock` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ availability), –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥—Ä—É–≥–æ–π –∞—Ç—Ä–∏–±—É—Ç.

**–í–∞–∂–Ω–æ:** –ù–µ –ø—É—Ç–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤. –ï—Å–ª–∏ –∫–∞–∂–¥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ + –æ—Ç–ø—Ä–∞–≤–∫–∞ email), —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ –∏—Ö –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `it` –ø–æ –æ—Å–Ω–æ–≤–Ω–æ–º—É –ø—Ä–∞–≤–∏–ª—É 2.

#### 2.2. –†–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏

–ö–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç 10+ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —Ç–µ—Å—Ç —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ `expect` —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥—Ä–æ–º–æ–∑–¥–∫–∏–º –∏ —Å–ª–æ–∂–Ω—ã–º –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–±—ä–µ–∫—Ç–∞.

**–î–ª—è –¥–æ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ (value objects, presenters, config):**

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `have_attributes` ‚Äî —ç—Ç–æ –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –∏ —á–∏—Ç–∞–µ–º–µ–µ, —á–µ–º —Å–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö `expect`.

```ruby
# –ø–ª–æ—Ö–æ: –¥–ª–∏–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ expect
describe UserProfile do
  let(:user) { create(:user, first_name: 'John', last_name: 'Doe', email: 'john@example.com') }
  subject(:profile) { described_class.new(user) }

  it 'exposes user profile', :aggregate_failures do
    expect(profile.first_name).to eq('John')
    expect(profile.last_name).to eq('Doe')
    expect(profile.full_name).to eq('John Doe')
    # ... –µ—â–µ 7 –ø–æ—Ö–æ–∂–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è email, phone, city, country, account_type, verified, created_at
  end
end

# —Ö–æ—Ä–æ—à–æ: –∫–æ–º–ø–∞–∫—Ç–Ω–æ —á–µ—Ä–µ–∑ have_attributes
describe UserProfile do
  let(:user) { create(:user, first_name: 'John', last_name: 'Doe', email: 'john@example.com') }
  subject(:profile) { described_class.new(user) }

  it 'exposes user profile' do
    expect(profile).to have_attributes(
      first_name: 'John',
      last_name: 'Doe',
      full_name: 'John Doe'
      # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã: email, phone, city, country, account_type, verified
    )
  end
end
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `have_attributes`:**

- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî –≤—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `:aggregate_failures` ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ä–∞–∑—É
- –ß–∏—Ç–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞

**–î–ª—è JSON API —Å –±–æ–ª—å—à–∏–º–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏:**

–ö–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç API —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–µ—Å—è—Ç–∫–∏ –ø–æ–ª–µ–π –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã inline —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ—á–∏—Ç–∞–µ–º–æ–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ `let`** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é.

```ruby
# –ø–ª–æ—Ö–æ: –≤—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ ‚Äî —Å–ª–æ–∂–Ω–æ —á–∏—Ç–∞—Ç—å
describe 'GET /api/orders/:id' do
  it 'returns order with items and customer' do
    get "/api/orders/#{order.id}"
    
    expect(response.parsed_body).to eq({
      'id' => order.id,
      'status' => 'pending',
      'total' => 150.0,
      'customer' => {
        'id' => customer.id,
        'name' => 'John Doe',
        'email' => 'john@example.com',
        'shipping_address' => {
          'street' => '123 Main St',
          'city' => 'Springfield',
          'postal_code' => '12345',
          'country' => 'USA'
        },
        'billing_address' => { ... }
      },
      'items' => [
        { 'id' => item1.id, 'product_name' => 'Laptop', ... },
        { 'id' => item2.id, 'product_name' => 'Mouse', ... }
      ],
      'created_at' => order.created_at.iso8601,
      'updated_at' => order.updated_at.iso8601
    })
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ: –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —á–µ—Ä–µ–∑ let ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–ª–æ—Å–∫–∞—è –∏ —á–∏—Ç–∞–µ–º–∞—è
describe 'GET /api/orders/:id' do
  let(:order) { create(:order, customer: customer) }
  let(:customer) { create(:customer) }
  let(:item1) { create(:order_item, order: order, product_name: 'Laptop', price: 999.99, quantity: 1) }
  let(:item2) { create(:order_item, order: order, product_name: 'Mouse', price: 25.0, quantity: 2) }

  # –í–ª–æ–∂–µ–Ω–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–∞–∑–Ω–µ—Å–µ–Ω—ã –ø–æ –æ—Ç–¥–µ–ª—å–Ω—ã–º let
  let(:expected_address) do
    {
      'street' => '123 Main St',
      'city' => 'Springfield',
      'postal_code' => '12345',
      'country' => 'USA'
    }
  end

  let(:expected_customer) do
    {
      'id' => customer.id,
      'name' => 'John Doe',
      'email' => 'john@example.com',
      'shipping_address' => expected_address,
      'billing_address' => expected_address
    }
  end

  let(:expected_items) do
    [
      {
        'id' => item1.id,
        'product_name' => 'Laptop',
        'quantity' => 1,
        'price' => 999.99,
        'subtotal' => 999.99
      },
      {
        'id' => item2.id,
        'product_name' => 'Mouse',
        'quantity' => 2,
        'price' => 25.0,
        'subtotal' => 50.0
      }
    ]
  end

  let(:expected_response) do
    {
      'id' => order.id,
      'status' => 'pending',
      'total' => 150.0,
      'customer' => expected_customer,
      'items' => expected_items,
      'created_at' => order.created_at.iso8601,
      'updated_at' => order.updated_at.iso8601
    }
  end

  it 'returns complete order details' do
    get "/api/orders/#{order.id}"
    expect(response.parsed_body).to match(expected_response)
  end
end
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏:**

- –í–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–ª–æ—Å–∫–æ–π –∏ —á–∏—Ç–∞–µ–º–æ–π
- –õ–µ–≥–∫–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —á–∞—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `expected_address`)
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —è—Å–Ω–æ, –∫–∞–∫–æ–π –±–ª–æ–∫ –æ–±–Ω–æ–≤–ª—è—Ç—å
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–µ—Ä–∞—Ä—Ö–∏—è: `expected_response` ‚Üí `expected_customer` ‚Üí `expected_address`

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é —á–µ—Ä–µ–∑ `let`:**

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç–µ **–ø–æ–≤–µ–¥–µ–Ω–∏–µ** ‚Äî –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–∂–Ω—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (5-20 –ø–æ–ª–µ–π —Å 2-3 —É—Ä–æ–≤–Ω—è–º–∏ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏)
- –ù—É–∂–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π (`order.id`, `customer.email`)

**–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç–µ **–∫–æ–Ω—Ç—Ä–∞–∫—Ç API** ‚Äî –≤—Å–µ –ø–æ–ª—è, —Ç–∏–ø—ã, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–≥—Ä–æ–º–Ω–∞—è (50+ –ø–æ–ª–µ–π, –≥–ª—É–±–æ–∫–∞—è –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å)
- –í–∞–∂–Ω–∞ –ø–æ–ª–Ω–∞—è —Ñ–∏–∫—Å–∞—Ü–∏—è —Å—Ö–µ–º—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π

**–î–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã API –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**

- **JSON Schema validation** (thoughtbot/json_matchers) ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ —Ç–∏–ø–æ–≤
- **rspec-openapi** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI –∏–∑ Request specs
- **Snapshot testing** ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—è —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. —Ä–∞–∑–¥–µ–ª ["–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤: –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ RSpec"](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ-api-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤-–≥—Ä–∞–Ω–∏—Ü—ã-–ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏-rspec).

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –û–¥–∏–Ω `it` = –æ–¥–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ ‚Üí –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ —Å—Ä–∞–∑—É —è—Å–Ω–æ, –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –Ω–∞—Ä—É—à–µ–Ω–æ
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è ‚Üí –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π —Ç–µ—Å—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –Ω–µ —á–∏—Ç–∞—è –∫–æ–¥
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏–π –Ω–∞ —Ä–∞–∑–Ω—ã–µ `it` ‚Üí –ª–µ–≥–∫–æ –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ, –Ω–µ —Ç—Ä–æ–≥–∞—è –¥—Ä—É–≥–∏–µ

### 4. –í—ã–¥–µ–ª—è–π—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏—è

**[–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è)** ‚Äî –¥–æ–º–µ–Ω–Ω—ã–π –∞—Å–ø–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∏—è–µ—Ç –Ω–∞ –∏—Å—Ö–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è (—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã, —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞).

**[–°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è)** ‚Äî –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —ç—Ç–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–π –≤–∞–∂–µ–Ω –¥–ª—è –ø—Ä–∞–≤–∏–ª–∞ (–ø–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –±–∞–ª–∞–Ω—Å –º–µ–Ω—å—à–µ –ª–∏–º–∏—Ç–∞, —Å—Ç–∞—Ç—É—Å = shipped).

–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –≤—ã –Ω–∞—à–ª–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É:

- –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å: ¬´–µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∞—Å–ø–µ–∫—Ç, –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è?¬ª;
- —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-—Ñ–∞–∫—Ç, –∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é (`user has subscription`, –∞ –Ω–µ `premium_flag`);
- —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Å—É—â–Ω–æ—Å—Ç—å —Å —É—Ç–æ—á–Ω–µ–Ω–∏–µ–º (`user role`, `card balance`).

–ö–∞–∫ –ø–æ–¥–æ–±—Ä–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è:

- –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑–ª–∏—á–∞–µ—Ç –±–∏–∑–Ω–µ—Å (—Ä–æ–ª—å = admin / customer; —Å—Ç–∞—Ç—É—Å = draft / paid / cancelled);
- —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–ª–∏—á–∏–Ω—ã –≥—Ä—É–ø–ø–∏—Ä—É–π—Ç–µ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ (–±–∞–ª–∞–Ω—Å ‚â• —Å—Ç–æ–∏–º–æ—Å—Ç—å, –±–∞–ª–∞–Ω—Å < —Å—Ç–æ–∏–º–æ—Å—Ç—å);
- –∫–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã—Ä–∞–∂–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–º `context` —Å —è—Å–Ω–æ–π —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–æ–π.

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –Ø–≤–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ ‚Üí —Ç–µ—Å—Ç—ã —á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞, –∞ –Ω–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Å–≤–æ—ë–º `context` ‚Üí –Ω–µ –Ω—É–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ "–∞ –ø—Ä–∏ –∫–∞–∫–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?"
- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ñ–æ—Ä–º—É–ª–∏—Ä—É—é—Ç—Å—è –¥–æ–º–µ–Ω–Ω—ã–º —è–∑—ã–∫–æ–º ‚Üí —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏ –±–∏–∑–Ω–µ—Å –≥–æ–≤–æ—Ä—è—Ç –Ω–∞ –æ–¥–Ω–æ–º —è–∑—ã–∫–µ

### 5. –°—Ç—Ä–æ–π—Ç–µ –∏–µ—Ä–∞—Ä—Ö–∏—é `context` –ø–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (happy path ‚Üí corner cases)

–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –º–æ–≥—É—Ç –±—ã—Ç—å:

- **–±–∞–∑–æ–≤—ã–º–∏** ‚Äî –±–µ–∑ –Ω–∏—Ö –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ –∏–º–µ—é—Ç —Å–º—ã—Å–ª–∞ (–Ω–µ—Ç –∫–∞—Ä—Ç—ã ‚Üí –Ω–µ—Ç –±–∞–ª–∞–Ω—Å–∞);
- **—É—Ç–æ—á–Ω—è—é—â–∏–º–∏** ‚Äî —É—Ç–æ—á–Ω—è—é—Ç –±–∞–∑–æ–≤—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É (–±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∫–∞—Ä—Ç—ã);
- **–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏** ‚Äî –Ω–µ –≤–ª–∏—è—é—Ç –¥—Ä—É–≥ –Ω–∞ –¥—Ä—É–≥–∞ (—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ñ–ª–∞–≥ beta-—Ç–µ—Å—Ç–∞).

–ê–ª–≥–æ—Ä–∏—Ç–º:

1. –í—ã–ø–∏—à–∏—Ç–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è.
2. –û—Ç–º–µ—Ç—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ B –∑–∞–≤–∏—Å–∏—Ç –æ—Ç A, –µ—Å–ª–∏ –µ—ë —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ A.
3. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É –∏–µ—Ä–∞—Ä—Ö–∏–∏.
4. –î–ª—è –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ `context` –æ—Ç –±–∞–∑–æ–≤–æ–π –∫ —É—Ç–æ—á–Ω—è—é—â–µ–π, —É–ø–æ—Ä—è–¥–æ—á–∏–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è: —Å–Ω–∞—á–∞–ª–∞ happy path (–Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π), –∑–∞—Ç–µ–º corner cases (–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è).

#### –ó–∞–≤–∏—Å–∏–º—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–±–∏–Ω–∞—Ä–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞)

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –°–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç |
| --- | --- | --- |
| –ü—Ä–∏–≤—è–∑–∫–∞ –∫–∞—Ä—Ç—ã | has card / has NO card | ‚Äî |
| –ë–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã | balance ‚â• price / balance < price | –ü—Ä–∏–≤—è–∑–∫–∞ –∫–∞—Ä—Ç—ã (has card) |

```ruby
describe '#purchase' do
  context 'when user has a payment card' do               # happy path: –∫–∞—Ä—Ç–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞
    context 'and card balance covers the price' do        # happy path: –±–∞–ª–∞–Ω—Å –¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
      it 'charges the card'
    end

    context 'but card balance does NOT cover the price' do # corner case: –¥–µ–Ω–µ–≥ –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ
      it 'rejects the purchase'
    end
  end

  context 'when user has NO payment card' do              # corner case: –∫–∞—Ä—Ç—ã –Ω–µ—Ç
    it 'rejects the purchase'
  end
end
```

> ```ruby
> # –ø–ª–æ—Ö–æ
> describe '#purchase' do
>   context 'but card balance does NOT cover the price' do
>     it 'rejects the purchase'
>   end
>
>   context 'when user has a payment card' do
>     context 'and card balance covers the price' do
>       it 'charges the card'
>     end
>   end
> end
> ```
>
> –ß—Ç–æ –Ω–µ —Ç–∞–∫:
>
> - –í–µ—Ç–∫–∞ `but ...` –æ—Ç–æ—Ä–≤–∞–Ω–∞ –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ `when user has a payment card`, –ø–æ—ç—Ç–æ–º—É happy path –∏ corner case –º–µ–Ω—è—é—Ç—Å—è –º–µ—Å—Ç–∞–º–∏.
> - –ß–∏—Ç–∞—Ç–µ–ª—é –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é —Ä–∞–Ω—å—à–µ –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å: —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—é —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç—Ä—É–¥–Ω–æ —á–∏—Ç–∞—Ç—å.

#### –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (enum + –±–∏–Ω–∞—Ä–Ω–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞)

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –°–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç |
| --- | --- | --- |
| –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | admin / customer | ‚Äî |
| –§–ª–∞–≥ beta-–¥–æ—Å—Ç—É–ø–∞ | enabled / disabled | ‚Äî |

```ruby
describe '#feature_access' do
  context 'when user role is admin' do        # happy path: –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø
    it('grants access to admin tools') { ... }

    context 'and beta feature is enabled' do  # happy path: –±–æ–Ω—É—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø
      it('grants access to beta tools') { ... }
    end

    context 'but beta feature is disabled' do # corner case –¥–ª—è admin
      it('falls back to standard tools') { ... }
    end
  end

  context 'when user role is customer' do     # corner case: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞
    it('denies access to admin tools') { ... }

    context 'and beta feature is enabled' do  # corner case: —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–º—è–≥—á–µ–Ω–∏–µ
      it('grants access to beta tools') { ... }
    end

    context 'but beta feature is disabled' do # —Å–∞–º—ã–π —Å—Ç—Ä–æ–≥–∏–π corner case
      it('denies access to beta tools') { ... }
    end
  end
end
```

–ü–æ—Ä—è–¥–æ–∫ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å (—Å–Ω–∞—á–∞–ª–∞ —Ñ–ª–∞–≥, –ø–æ—Ç–æ–º —Ä–æ–ª—å), –Ω–æ happy path –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤—ã—à–µ, –∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è ‚Äî –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∏–∂–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —É—Ä–æ–≤–Ω–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –ò–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ ‚Äî –Ω–µ –Ω—É–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å —É—Å–ª–æ–≤–∏—è –≤ –≥–æ–ª–æ–≤–µ
- Happy path —Å–≤–µ—Ä—Ö—É ‚Üí —á–∏—Ç–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –Ω–µ –∫–æ–ø–∞—è—Å—å –≤ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö
- –°–∏–º–º–µ—Ç—Ä–∏—á–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–≤—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ) —É–ø—Ä–æ—â–∞–µ—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏—é: "–≥–¥–µ —Ç–µ—Å—Ç –¥–ª—è —Å–ª—É—á–∞—è X?" ‚Üí "–Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ, —á—Ç–æ Y –∏ Z"
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, –∫—É–¥–∞ –µ–≥–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–∞–º–æ–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è

### 6. –§–∏–Ω–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤: –¥–≤–∞ —Ç–∏–ø–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

–ö–∞–∂–¥—ã–π —Ä–∞–∑, –∫–∞–∫ –≤—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏ —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —Ç–µ—Å—Ç–∞–º–∏, —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ `describe/context` —Ä–µ–∞–ª—å–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –∏ –∏—Ö [—Å–æ—Å—Ç–æ—è–Ω–∏—è–º](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –∏–∑ –≥–ª–æ—Å—Å–∞—Ä–∏—è (—Å–º. –ø—É–Ω–∫—Ç 5). –§–∏–Ω–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç –≤–∫–ª—é—á–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫: –¥—É–±–ª–∏–∫–∞—Ç—ã `let`/`before` –≤—ã–¥–∞—é—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫, –∞ –¥—É–±–ª–∏–∫–∞—Ç—ã `it` —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º–∏ –≤—ã–¥–∞—é—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

#### 6.1. –î—É–±–ª–∏–∫–∞—Ç—ã `let`/`before` –≤—ã–¥–∞—é—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ü–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è `let` –∏–ª–∏ `before` –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ ‚Äî —Ç—Ä–µ–≤–æ–∂–Ω—ã–π —Å–∏–≥–Ω–∞–ª: –∫–∞–∫–æ–µ-—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ –≤—ã–Ω–µ—Å–µ–Ω–æ –≤ —è–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç, –∏ —Ç–µ—Å—Ç –¥–ª—è –Ω–µ–≥–æ –ª–µ–≥–∫–æ –ø–æ—Ç–µ—Ä—è—Ç—å.

–ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è:

- –ü—Ä–æ–π–¥–∏—Ç–µ—Å—å –ø–æ –∫–∞–∂–¥–æ–º—É —É—Ä–æ–≤–Ω—é –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –≤—ã–ø–∏—à–∏—Ç–µ –≤—Å–µ `let`/`before`. –ï—Å–ª–∏ –≤ —Å–æ—Å–µ–¥–Ω–∏—Ö –≤–µ—Ç–∫–∞—Ö –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –Ω—É–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –≤—ã—à–µ –∏–ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–Ω—è—Ç—å –æ–±—â–∏–π `let` –Ω–∞ —É—Ä–æ–≤–µ–Ω—å –≤—ã—à–µ. –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Ä—É—à–∞—Ç—Å—è, –∑–Ω–∞—á–∏—Ç, –≤—ã –æ–±–Ω–∞—Ä—É–∂–∏–ª–∏ —Å–∫—Ä—ã—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –¥–ª—è –Ω–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–∏–º–µ—Ä.
- –°–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–º —Å–ø–∏—Å–∫–æ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π. –ï—Å–ª–∏ –∫–∞–∫–æ–µ-—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∏–≥–¥–µ –Ω–µ –ø—Ä–æ—è–≤–∏–ª–æ—Å—å, —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è –Ω–µ–≥–æ –ø—Ä–æ–ø—É—â–µ–Ω.
- –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ `before`-–±–ª–æ–∫–∏. –ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî —á–∞—Å—Ç—ã–π –ø—Ä–∏–∑–Ω–∞–∫ —Ç–æ–≥–æ, —á—Ç–æ –≤—ã –æ—Å—Ç–∞–≤–∏–ª–∏ —Ç–æ–ª—å–∫–æ happy path –∏ –∑–∞–±—ã–ª–∏ –ø—Ä–æ –≤–µ—Ç–∫—É —Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º.

```ruby
# –ø–ª–æ—Ö–æ
describe Billing::DiscountEvaluator do
  subject(:discount) { described_class.call(order) }

  let(:order) { build(:order, segment: segment, currency: currency, loyalty_status: loyalty_status) }

  context 'when segment is b2c' do
    let(:segment) { :b2c }

    context 'with gold loyalty' do
      let(:loyalty_status) { :gold }
      let(:currency) { :usd }

      it 'returns 0.15' do
        expect(discount).to eq(0.15)
      end
    end

    context 'with silver loyalty' do
      let(:loyalty_status) { :silver }
      let(:currency) { :usd }

      it 'returns 0.10' do
        expect(discount).to eq(0.10)
      end
    end
  end

  context 'when segment is b2b' do
    let(:segment) { :b2b }

    context 'with gold loyalty' do
      let(:loyalty_status) { :gold }
      let(:currency) { :eur }

      it 'returns 0.12' do
        expect(discount).to eq(0.12)
      end
    end

    context 'with silver loyalty' do
      let(:loyalty_status) { :silver }
      let(:currency) { :eur }

      it 'returns 0.05' do
        expect(discount).to eq(0.05)
      end
    end
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe Billing::DiscountEvaluator do
  subject(:discount) { described_class.call(order) }

  let(:order) { build(:order, segment: segment, currency: currency, loyalty_status: loyalty_status) }

  context 'when segment is b2c' do
    let(:segment) { :b2c }

    context 'with USD currency' do
      let(:currency) { :usd }

      context 'and loyalty is gold' do
        let(:loyalty_status) { :gold }
        it('returns 0.15') { ... }
      end

      context 'and loyalty is silver' do
        let(:loyalty_status) { :silver }
        it('returns 0.10') { ... }
      end
    end
  end

  context 'when segment is b2b' do
    let(:segment) { :b2b }

    context 'with USD currency' do
      let(:currency) { :usd }

      context 'and loyalty is gold' do
        let(:loyalty_status) { :gold }
        it('returns 0.11') { ... }
      end

      context 'and loyalty is silver' do
        let(:loyalty_status) { :silver }
        it('returns 0.06') { ... }
      end
    end

    context 'with EUR currency' do
      let(:currency) { :eur }

      context 'and loyalty is gold' do
        let(:loyalty_status) { :gold }
        it('returns 0.12') { ... }
      end

      context 'and loyalty is silver' do
        let(:loyalty_status) { :silver }
        it('returns 0.05') { ... }
      end
    end
  end
end
```

`–ß—Ç–æ` –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –ü–æ –æ–ø–∏—Å–∞–Ω–∏—é –≤—Å—ë –ø–æ—Ö–æ–∂–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é –∏–∑ –ø—É–Ω–∫—Ç–∞ 4, –Ω–æ `currency` –≤ –∫–∞–∂–¥–æ–π –≤–µ—Ç–∫–µ –∑–∞–¥–∞—ë—Ç—Å—è –≤—Ä—É—á–Ω—É—é, –∑–Ω–∞—á–∏—Ç, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ ¬´–∂–∏–≤—ë—Ç¬ª –Ω–µ —Ç–∞–º, –≥–¥–µ –æ–ø–∏—Å–∞–Ω–∞.
- –î–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è `currency: :usd` –≤ —Å–µ–≥–º–µ–Ω—Ç–µ `:b2b` –ø—Ä–∏–º–µ—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –¥–µ—Ñ–µ–∫—Ç –ø—Ä–æ–π–¥—ë—Ç –º–∏–º–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç–µ—Å—Ç—ã —á–∏—Ç–∞—é—Ç—Å—è –∫–∞–∫ –ø–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è.

–¢–µ–ø–µ—Ä—å:

- –í–∞–ª—é—Ç–∞ –∑–∞–Ω–∏–º–∞–µ—Ç —Å–≤–æ—ë –º–µ—Å—Ç–æ –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏, –¥—É–±–ª–∏–∫–∞—Ç—ã `let` –∏—Å—á–µ–∑–ª–∏, –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (—Å–º. –ø—É–Ω–∫—Ç 5).
- –ö–∞–∂–¥–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è `segment ‚Üí currency ‚Üí loyalty_status` –∏–∑ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏ –∏–º–µ–µ—Ç –ø—Ä–∏–º–µ—Ä, –∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π corner case —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
- –§–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ —á–∏—Ç–∞–µ–º—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –∏ happy path —Å—Ç–æ–∏—Ç –≤—ã—à–µ corner case (—Å–º. –ø—É–Ω–∫—Ç 7), –ø–æ—ç—Ç–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ.
- –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ–∫-–ª–∏—Å—Ç —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: –≤—ã –ª–∏–±–æ –¥–æ–±–∞–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç, –ª–∏–±–æ –∑–∞–º–µ—Ç–∏—Ç–µ, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç –∫ –æ–±—â–µ–º—É `let` –ª–æ–º–∞–µ—Ç —Ç–µ—Å—Ç.

#### 6.2. –î—É–±–ª–∏–∫–∞—Ç—ã `it` —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º–∏ –≤—ã–¥–∞—é—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã

–ü–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ (–ø—É–Ω–∫—Ç 5) –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ `let`/`before` (–ø—É–Ω–∫—Ç 6.1), –ø—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ –ª–∏—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã. –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ `it` –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –æ–∂–∏–¥–∞–Ω–∏—è–º–∏ –≤–æ –≤—Å–µ—Ö –∏–ª–∏ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ ‚Äî —ç—Ç–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞: –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤—Å–µ–≥–¥–∞.

–ß–µ–∫-–ª–∏—Å—Ç –ø–æ—Å–ª–µ –Ω–∞–ø–∏—Å–∞–Ω–∏—è:

1. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤—Å–µ –ª–∏—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏ –≤—ã–ø–∏—à–∏—Ç–µ –≤—Å–µ `it`.
2. –ù–∞–π–¥–∏—Ç–µ –æ–∂–∏–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –¥–æ—Å–ª–æ–≤–Ω–æ –∏–ª–∏ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –≤–∞—Ä–∏–∞—Ü–∏—è–º–∏.
3. –ï—Å–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–æ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ ‚Äî —ç—Ç–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
4. –í—ã–Ω–µ—Å–∏—Ç–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤ `shared_examples` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∏—Ö —á–µ—Ä–µ–∑ `it_behaves_like` (—Å–º. –ø—É–Ω–∫—Ç 25.2).

–ü—Ä–∏–º–µ—Ä —Å–º. –≤ –ø—É–Ω–∫—Ç–µ 22.2 ‚Äî –∫–ª–∞—Å—Å `BookingSearchValidator`, –≥–¥–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `respond_to(:valid?)`, `respond_to(:errors)`, `respond_to(:normalized_params)` –ø–æ–≤—Ç–æ—Ä—è–ª–∏—Å—å –≤–æ –≤—Å–µ—Ö —á–µ—Ç—ã—Ä—ë—Ö –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç `client_type` –∏ `region`. –≠—Ç–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `shared_examples 'a booking search validator'`.

–¢–∞–∫–æ–π —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∞ –Ω–µ –Ω–∞–±–æ—Ä–∞ —Å–ª—É—á–∞–π–Ω—ã—Ö happy path.

### 7. –†–∞—Å–ø–æ–ª–∞–≥–∞–π—Ç–µ happy path –ø–µ—Ä–µ–¥ corner cases

–í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ `describe` —á–∏—Ç–∞—é—â–∏–π –æ–∂–∏–¥–∞–µ—Ç —É–≤–∏–¥–µ—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–µ—Ä–≤—ã–º, –∞ —É–∂–µ –∑–∞—Ç–µ–º ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

```ruby
# –ø–ª–æ—Ö–æ
describe '#enroll' do
  context 'when enrollment is rejected because email is invalid' do
    it('shows a validation error') { ... }
  end

  context 'when enrollment is rejected because plan is sold out' do
    it('puts the user on the waitlist') { ... }
  end

  context 'when enrollment is accepted' do # happy path –∑–∞—Ç–µ—Ä—è–Ω –≤–Ω–∏–∑—É
    it('activates the membership') { ... }
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe '#enroll' do
  context 'when enrollment is accepted' do
    it('activates the membership') { ... }
  end

  context 'when enrollment is rejected because email is invalid' do
    it('shows a validation error') { ... }
  end

  context 'when enrollment is rejected because plan is sold out' do
    it('puts the user on the waitlist') { ... }
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- Happy path —Å–ø—Ä—è—Ç–∞–Ω –≤–Ω–∏–∑—É –≤–µ—Ç–∫–∏, –∏–∑-–∑–∞ —á–µ–≥–æ —á–∏—Ç–∞—Ç–µ–ª—å —Ç—Ä–∞—Ç–∏—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.
- –ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö corner cases –ø–æ—Ä—è–¥–æ–∫ –µ—â—ë —Å–∏–ª—å–Ω–µ–µ —Å–º–µ—à–∞–µ—Ç—Å—è, –∏ –æ—Ç—á–µ—Ç RSpec –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —á–∏—Ç–∞—Ç—å—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –¥–æ–±–∞–≤–ª—è—è –Ω–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–ª–æ–∫–∏ happy path –æ—Å—Ç–∞—é—Ç—Å—è –ø–µ—Ä–≤—ã–º–∏ –Ω–∞ —Å–≤–æ–µ–º —É—Ä–æ–≤–Ω–µ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏. Corner cases –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∏–∂–µ –∏ –ª–∏–±–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `but`/`without`, –ª–∏–±–æ —è–≤–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ.

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- Happy path —Å–≤–µ—Ä—Ö—É ‚Üí —á–∏—Ç–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ (—É—Å–ø–µ—Ö ‚Üí –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è) ‚Üí –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä—ã–≥–∞—Ç—å –ø–æ —Ñ–∞–π–ª—É –≤ –ø–æ–∏—Å–∫–∞—Ö "–∫–∞–∫ –æ–Ω–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–æ—Ä–º–µ?"
- –û—Ç—á—ë—Ç RSpec —á–∏—Ç–∞–µ—Ç—Å—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ –∫–∞–∫ –∏—Å—Ç–æ—Ä–∏—è: —Å–Ω–∞—á–∞–ª–∞ –Ω–æ—Ä–º–∞, –ø–æ—Ç–æ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è

### 8. –ü–∏—à–∏—Ç–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç

–ö–∞–∂–¥–∞—è –≤–µ—Ç–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫. –î–ª—è —ç—Ç–∏—Ö —Å–æ—á–µ—Ç–∞–Ω–∏–π –Ω—É–∂–µ–Ω –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∏ –æ–¥–∏–Ω –ø—Ä–∏–º–µ—Ä, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π –æ—Ç–∫–∞–∑ ‚Äî —Ç–∞–∫ –º—ã –∑–∞—â–∏—â–∞–µ–º—Å—è –æ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã.

```ruby
# –ø–ª–æ—Ö–æ
describe "#some_action" do
  # ... –±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Ä–æ–ª—å, –¥–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  let(:user) { build :user, blocked: blocked, blocked_at: blocked_at }

  context "when user is blocked by admin" do # –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked`
    # ... –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è `blocked = true`
    let(:blocked) { true }

    context "and blocking duration is over a month" do # –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
      # ... –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Ç–æ—á–Ω—è—é—â–µ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
      let(:blocked_at) { 2.month.ago }

      it "allows unlocking the user" do
        expect(some_action).to be(true) # –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è —Å–æ—á–µ—Ç–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ `blocked`, `blocked_at`
      end
    end
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe "#some_action" do
  # ... –±–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —Ä–æ–ª—å, –¥–∞—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
  let(:user) { build :user, blocked: blocked, blocked_at: blocked_at }
  
  context "when user is blocked by admin" do # –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked`
    # ... –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked`
    let(:blocked) { true }

    # –ö–æ–Ω—Ç–µ–∫—Å—Ç 2 —É—Ä–æ–≤–Ω—è –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
    context "and blocking duration is over a month" do # –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
      # ... —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Ç–æ—á–Ω—è—é—â–µ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
      let(:blocked_at) { 2.month.ago }
      it("allows unlocking the user") { ... }
    end

    context "but blocking duration is under a month" do # –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
      # ... —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Ç–æ—á–Ω—è—é—â–µ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
      let(:blocked_at) { 1.month.ago }
      it("does NOT allow unlocking the user") { ... }
    end
  end

  context "when user is NOT blocked by admin" do # –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked`
    # ... –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked`
    let(:blocked) { false }
    it("does NOT allow unlocking the user") { ... }
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ `blocked` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
- –£—Ç–æ—á–Ω—è—é—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ `blocked_at`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–æ–ø—É—â–µ–Ω –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è —Å–æ—á–µ—Ç–∞–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–π.
–ï—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–æ–ª—å–∫–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã, —Ç–æ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –Ω–∞ —Ç–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –Ω–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è,
–≤–≤–∏–¥—É —Ç–æ–≥–æ, —á—Ç–æ –æ–Ω–∏ –Ω–µ –æ—Ç—Ä–∞–∑—è—Ç —Ñ–∞–∫—Ç–∞ —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∫–æ–¥–µ,
—Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–µ –±—É–¥—É—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ–±—Ä–∞—Ç–Ω—ã–π —Å–ª—É—á–∞–π.

### 9. –ö–∞–∂–¥—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç—Ä–∞–∂–∞—Ç—å —Ä–∞–∑–ª–∏—á–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–π —á–∞—Å—Ç–∏ –æ—Ç –≤–Ω–µ—à–Ω–µ–π

–ú–æ–∂–Ω–æ –µ—â—ë —Å–∫–∞–∑–∞—Ç—å —Ç–∞–∫: –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –º–µ–∂–¥—É `context "..." do` –∏ `it` –ø—É—Å—Ç–æ, —ç—Ç–æ —á–∏—Å—Ç–æ
—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç. –û–Ω –ª–∏–±–æ –Ω–µ –Ω—É–∂–µ–Ω –≤–æ–≤—Å–µ, –ª–∏–±–æ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –æ–ø–∏—Å–∞–Ω–∏—é –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

–ü—Ä–∞–≤–∏–ª–æ –º–æ–∂–Ω–æ —Å—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–∞—á–µ: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Ç–∏–Ω–Ω—ã–º, –¥–æ–ª–∂–Ω–∞ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∫–∏ `context "..." do`.
–ù–µ –∑–∞—Å—Ç–∞–≤–ª—è–π—Ç–µ —á–∏—Ç–∞—Ç–µ–ª—è –∏—Å–∫–∞—Ç—å –ø–æ –≤—Å–µ–º—É —Ç–µ—Å—Ç—É, –≥–¥–µ –∏–º–µ–Ω–Ω–æ –≥–æ—Ç–æ–≤–∏—Ç—Å—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–¥ –æ–ø–∏—Å–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.

```ruby
# –ï—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –º–µ—Ç–æ–¥ some_action, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å.
# –£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –µ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è `blocked`, `blocked_at`.
```

```ruby
# –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ
describe "#some_action" do
  let(:user) { build :user }
  let(:blocked_user) { build :user, blocked: true }
  let(:old_blocked_user) { build :user, blocked: true, blocked_at: 2.month.ago }

  it "does NOT allow unlocking the user" do
    expect(user.some_action).to be(false)
  end
  
  context "when user is blocked by admin" do # –µ—Å—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
    # –Ω–µ—Ç –Ω–∏–∫–∞–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç –µ–≥–æ –æ—Ç–ª–∏—á–Ω—ã–º –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ –±–ª–æ–∫–∞
    it "allows unlocking the user" do
      expect(blocked_user.some_action).to be(true)
    end
    
    context "and blocking duration is over a month" do 
      # –ß—Ç–æ –æ—Ç–ª–∏—á–∞–µ—Ç —ç—Ç–æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç –≤–Ω–µ—à–Ω–µ–≥–æ? –í –±–æ–ª—å—à–æ–º —Ç–µ—Å—Ç–µ –∏—Å–∫–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±—É–¥–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ.
      # –≠–∫–æ–Ω–æ–º—å—Ç–µ —Å–≤–æ–π –∏ —á—É–∂–æ–π —Ç—Ä—É–¥ ‚Äî —Ä–∞–∑–º–µ—â–∞–π—Ç–µ –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –≥–æ—Ç–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Å—Ä–∞–∑—É –ø–æ–¥ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º: —Ç–∞–º –µ–≥–æ –∏ –æ–∂–∏–¥–∞—é—Ç —É–≤–∏–¥–µ—Ç—å.
      it "allows unlocking the user" do
        expect(old_blocked_user.some_action).to be(true)
      end
    end
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe "#some_action" do
  let(:blocked) { false } # –±–∞–∑–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked`
  let(:blocked_at) { nil } # –±–∞–∑–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`
  let(:user) { build :user, blocked: blocked, blocked_at: blocked_at }
  subject(:result) { user.some_action }

  it "does NOT allow unlocking the user" do
    expect(result).to be(false)
  end

  context "when user is blocked by admin" do
    let(:blocked) { true } # –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Äî –Ω–∞ —Å–≤–æ—ë–º –º–µ—Å—Ç–µ, —Å—Ä–∞–∑—É –∑–∞–º–µ—Ç–Ω–∞

    context "and blocking duration is over a month" do
      let(:blocked_at) { 2.month.ago } # –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ‚Äî –∑–¥–µ—Å—å –∂–µ, –ø–æ–¥ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º

      it "allows unlocking the user" do
        expect(result).to be(true)
      end
    end

    context "but blocking duration is under a month" do
      let(:blocked_at) { 1.month.ago } # –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ `blocked_at`

      it "does NOT allow unlocking the user" do
        expect(result).to be(false)
      end
    end
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –ö–æ–Ω—Ç–µ–∫—Å—Ç `when user is blocked by admin` –Ω–µ –∑–∞–¥–∞—ë—Ç –æ—Ç–ª–∏—á–∞—é—â–∏—Ö —É—Å–ª–æ–≤–∏–π ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `let` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –¥–∞–ª–µ–∫–æ –∏ –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º.
- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π `context` –Ω–µ –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç `blocked_at`, –ø–æ—ç—Ç–æ–º—É —Å–ª–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –∫–∞–∫–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è.

–ö—Ä–æ–º–µ —Ç–æ–≥–æ, —Ç—Ä–µ–±—É–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å—Å—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ–º ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ `before`.

## –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å

–•–æ—Ä–æ—à–∏–π —Å—Ç–∏–ª—å —Ç–µ—Å—Ç–æ–≤ ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–æ –∏ –æ—á–µ–≤–∏–¥–Ω–æ—Å—Ç—å —Ç–æ–≥–æ, —á—Ç–æ —á–∏—Ç–∞–µ—à—å: —è–≤–Ω—ã–π `subject`, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –º–∏–Ω–∏–º—É–º –ø–æ–∏—Å–∫–∞ –≥–ª–∞–∑–∞–º–∏.

### 10. –£–∫–∞–∑—ã–≤–∞–π—Ç–µ `subject`, —á—Ç–æ–±—ã —è–≤–Ω–æ –æ–±–æ–∑–Ω–∞—á–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ö–æ–≥–¥–∞ `subject` —è–≤–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω, —á–∏—Ç–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è, –∏ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç –≤—Ä–µ–º—è –Ω–∞ –ø–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –æ–∂–∏–¥–∞–Ω–∏—è—Ö.

`subject` –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω:

- –ö–æ–≥–¥–∞ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö `it` –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤
- –ö–æ–≥–¥–∞ –¥–µ–π—Å—Ç–≤–∏–µ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏–ª–∏ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –¥–∞—Ç—å –∏–º—è –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–º—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —á–µ—Ä–µ–∑ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π `subject(:result)`

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –Ø–≤–Ω—ã–π `subject` ‚Üí —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è, –Ω–µ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –æ–±—ä–µ–∫—Ç –≤ –∫–∞–∂–¥–æ–º `expect`
- –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π `subject(:result)` ‚Üí –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω–æ–µ –∏–º—è –∑–∞–º–µ–Ω—è–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –≤—ã–∑–æ–≤—ã –º–µ—Ç–æ–¥–∞
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π ‚Üí –º–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –¥–∞–Ω–Ω—ã—Ö

–ì–ª–∞–¥–∫–∏–µ —Ç–µ—Å—Ç—ã —Å—Ç—Ä–æ—è—Ç—Å—è –Ω–∞ –ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–º —Å–µ—Ç–∞–ø–µ: —á—ë—Ç–∫–∏—Ö —Ñ–∞–∑–∞—Ö Given/When/Then, —Ñ–∞–±—Ä–∏–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä—è—á—É—Ç —Ä—É—Ç–∏–Ω—É, –∏ —è–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö. –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª —Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏.

### 11. –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ 3 —ç—Ç–∞–ø–∞ –≤ —Å—Ç—Ä–æ–≥–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

`let` –∏ `let!` –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—é—Ç –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞—é—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏—Å—Ç–∏–Ω–Ω—ã–º (Given), `before` –¥–æ–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º—É –¥–æ –Ω—É–∂–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (When), –∞ –æ–∂–∏–¥–∞–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ `it` —Ñ–∏–∫—Å–∏—Ä—É—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (Then). –ù–µ —Å–º–µ—à–∏–≤–∞–π—Ç–µ —ç—Ç–∏ —Ä–æ–ª–∏.

1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ `let` –∏–ª–∏ —Ñ–∞–±—Ä–∏–∫–∏)
2. –ü–µ—Ä–µ–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω—É–∂–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ/–≤—ã–∑–æ–≤ –¥–µ–π—Å—Ç–≤–∏—è (—á–∞—â–µ `before`, –∏–Ω–æ–≥–¥–∞ –ø—Ä—è–º–æ –≤ `it`)
3. –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (Then)

```ruby
# –æ—á–µ–Ω—å –ø–ª–æ—Ö–æ
describe "#block" do
  before do
    user = create :user # —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    admin = create :admin # —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
    admin.block(user) # –¥–µ–π—Å—Ç–≤–∏–µ
  end

  it "true" do
    expect(User.find(1).blo—Åked).to be(true) # –æ–∂–∏–¥–∞–Ω–∏–µ
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe "#block" do
  # 1 —ç—Ç–∞–ø
  let(:user) { create :user } # —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
  let(:admin) { create :admin }

  # 2 —ç—Ç–∞–ø
  before { admin.block(user) } # –¥–µ–π—Å—Ç–≤–∏–µ/–æ–ø–µ—Ä–∞—Ü–∏—è

  # 3 —ç—Ç–∞–ø
  it "marks the user as blocked" do
    expect(user.blocked).to be(true) # –æ–∂–∏–¥–∞–Ω–∏–µ
  end
end
```

–í–∞—Ä–∏–∞–Ω—Ç —Å –¥–µ–π—Å—Ç–≤–∏–µ–º –≤–Ω—É—Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä–∞:

```ruby
# –Ω–æ—Ä–º–∞–ª—å–Ω–æ
describe "#block" do
  # 1 —ç—Ç–∞–ø
  let(:user) { create :user }
  let(:admin) { create :admin }

  it "marks the user as blocked" do
    # 2 —ç—Ç–∞–ø
    admin.block(user)

    # 3 —ç—Ç–∞–ø
    expect(user.blocked).to be(true)
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –≠—Ç–∞–ø—ã Given/When/Then —Å–º–µ—à–∞–Ω—ã –≤–Ω—É—Ç—Ä–∏ `before`, –∏–∑-–∑–∞ —á–µ–≥–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –≥–¥–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞.
- –¢–µ—Å—Ç –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `User.find(1)` –≤–º–µ—Å—Ç–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —á–µ—Ä–µ–∑ `let`, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏–º–µ—Ä –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

–î–∞–∂–µ –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä—è–º–æ –≤ `it`, –¥–µ—Ä–∂–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —è–≤–Ω–æ–π –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ `before`, –∫–æ–≥–¥–∞ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ.

- `let` –ª–µ–Ω–∏–≤—ã–π: –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏. –ï—Å–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –¥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `it`, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `before` –∏–ª–∏ `let!`, —á—Ç–æ–±—ã —è–≤–Ω–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ –∏ –Ω–µ –Ω–∞—Ä—É—à–∞—Ç—å —ç—Ç–∞–ø—ã –ø—Ä–∞–≤–∏–ª–∞ 8.

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Given ‚Üí When ‚Üí Then) ‚Üí —á–∏—Ç–∞—Ç–µ–ª—å –∑–Ω–∞–µ—Ç, –≥–¥–µ –∏—Å–∫–∞—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É, –¥–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–æ–≤–µ—Ä–∫—É
- –ù–µ –Ω—É–∂–Ω–æ "–≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –≤ –≥–æ–ª–æ–≤–µ", —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ —Å—Ä–∞–∑—É —è—Å–Ω–æ, –≤ –∫–∞–∫—É—é —Å–µ–∫—Ü–∏—é –¥–æ–±–∞–≤–ª—è—Ç—å –∫–æ–¥

### FactoryBot –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

FactoryBot –ø–æ–º–æ–≥–∞–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –¥–æ–º–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ —Ç—Ä–µ–π—Ç—ã –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ö—ç—à–∏, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ, —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –≥–æ–≤–æ—Ä–∏–ª–∏ –æ [–ø–æ–≤–µ–¥–µ–Ω–∏–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø–æ–Ω—è—Ç–∏—è), –∞ –Ω–µ –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –∞—Ç—Ä–∏–±—É—Ç–∞—Ö.

#### 12. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ FactoryBot –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –¥–µ—Ç–∞–ª–µ–π –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –µ—Å—Ç—å FactoryBot, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ, —á—Ç–æ–±—ã —Ç–µ—Å—Ç—ã –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å —á–∏—Ç–∞–±–µ–ª—å–Ω—ã–º–∏ –∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª–∏ —Ç–æ–ª—å–∫–æ [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –∏ –∏—Ö [—Å–æ—Å—Ç–æ—è–Ω–∏—è](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è).

- –î–µ—Ñ–æ–ª—Ç–Ω–∞—è —Ñ–∞–±—Ä–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å ¬´—Å—Ä–µ–¥–Ω–∏–π¬ª –æ–±—ä–µ–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è happy path. –í—Å—ë, —á—Ç–æ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, –ø—Ä—è—á—å—Ç–µ –≤–Ω—É—Ç—Ä—å —Ñ–∞–±—Ä–∏–∫–∏.
- –í –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –æ—Ñ–æ—Ä–º–ª—è–π—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —á–µ—Ä–µ–∑ —Ç—Ä–µ–π—Ç—ã: `:blocked`, `:with_verified_email`, `:expired`. –¢—Ä–µ–π—Ç—ã –º–æ–∂–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å (`create(:user, :blocked, :verified)`), –ø–æ–ª—É—á–∞—è –Ω—É–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–µ–∑ –∫–æ–ø–∏–ø–∞—Å—Ç–∞. –ö–æ–Ω—Ç–µ–∫—Å—Ç—É –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É.
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä—É—á–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–µ—Å—è—Ç–∫–æ–≤ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –≤ `create`. –ï—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–Ω–æ–≥–æ —è–≤–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –≤–æ–∑–º–æ–∂–Ω–æ, —Ñ–∞–±—Ä–∏–∫—É —Å—Ç–æ–∏—Ç —É—Ç–æ—á–Ω–∏—Ç—å –∏–ª–∏ –≤—ã–¥–µ–ª–∏—Ç—å –Ω–æ–≤—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É.

```ruby
# –ø–ª–æ—Ö–æ
describe '#unlock' do
  let(:user) do
    create(:user,
           blocked: true,
           blocked_at: 2.months.ago,
           email_confirmed: true
           # ... –µ—â–µ 2 –∞—Ç—Ä–∏–±—É—Ç–∞: last_sign_in_at, otp_required
    )
  end

  it 'allows unlocking the user' do
    expect(UserUnlocker.call(user)).to be_allowed
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
FactoryBot.define do
  factory :user do
    email { Faker::Internet.email }
    password { 'secret123' }

    trait :blocked do
      blocked { true }
      blocked_at { 2.months.ago }
    end

    trait :verified do
      email_confirmed { true }
    end
  end
end

describe '#unlock' do
  let(:user) { create(:user, :blocked, :verified) }

  it 'allows unlocking the user' do
    expect(UserUnlocker.call(user)).to be_allowed
  end
end
```

- –¢—Ä–µ–π—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –∏–∑–±–∞–≤–ª—è—é—Ç –æ—Ç –≥—Ä–æ–º–æ–∑–¥–∫–∏—Ö setup-–±–ª–æ–∫–æ–≤.
- –ß–∏—Ç–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤–∞–∂–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã (`:blocked`, `:verified`) –∏ –±—ã—Å—Ç—Ä–æ —Å–æ–æ—Ç–Ω–æ—Å–∏—Ç –∏—Ö —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –≤ —Ñ–∞–±—Ä–∏–∫–µ, –ø–æ—ç—Ç–æ–º—É —Ç–µ—Å—Ç—ã –Ω–µ ¬´–∑–∞—Ö–ª–∞–º–ª—è—é—Ç—Å—è¬ª —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö.
- –ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ: —Ñ–∞–±—Ä–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ `create` —Å–æ –≤—Å–µ–º–∏ –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏, –ø–æ—ç—Ç–æ–º—É —Ç–µ—Å—Ç –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–∞–∂–Ω—ã; –ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π —Ç—Ä–µ–±—É–µ—Ç –º–µ–Ω—è—Ç—å —Ç–µ—Å—Ç, –∞ –Ω–µ —Ñ–∞–±—Ä–∏–∫—É.

–¢–∞–∫–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç—ã —á–∏—â–µ, –ª–µ–≥—á–µ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ª—É—á—à–µ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç –±–∏–∑–Ω–µ—Å-–ø–æ–≤–µ–¥–µ–Ω–∏–µ.

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Ö–æ—Ä–æ—à–∏–π –æ–±–∑–æ—Ä –ø—Ä–∏—ë–º–æ–≤ —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–π—Ç–∞–º–∏ –µ—Å—Ç—å —É Thoughtbot ‚Äî [Remove duplication with FactoryBot‚Äôs traits](https://thoughtbot.com/blog/remove-duplication-with-factorybots-traits).

#### 13. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `attributes_for` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è –≤–∞–∂–Ω–æ–π –¥–µ—Ç–∞–ª—å—é –≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è

–ü—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è —á–∞—Å—Ç–æ –≤–∞–∂–µ–Ω —Å–∞–º —Ñ–∞–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è (—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è), –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤. `attributes_for` –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π —Ö—ç—à –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏–∑ —Ñ–∞–±—Ä–∏–∫–∏, –∏–∑–±–µ–≥–∞—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Ñ–∞–±—Ä–∏–∫–æ–π –∏ —Ç–µ—Å—Ç–æ–º.

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `attributes_for`, –∫–æ–≥–¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –Ω–µ –≤–∞–∂–Ω—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è. –ï—Å–ª–∏ –∞—Ç—Ä–∏–±—É—Ç –∫—Ä–∏—Ç–∏—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∞ ‚Äî –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –µ–≥–æ —è–≤–Ω–æ.

#### –û—Å–Ω–æ–≤–Ω–æ–π use case: Request specs

Request specs ‚Äî –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ–µ –º–µ—Å—Ç–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è `attributes_for`, —Ç–∞–∫ –∫–∞–∫ API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç —Ö—ç—à–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.

```ruby
# –ø–ª–æ—Ö–æ
describe 'POST /api/orders' do
  let(:order_params) do
    {
      customer_email: 'user@example.com',
      total: 150.0
      # ... –µ—â–µ 2 –ø–æ–ª—è: currency, status
    }
  end

  before { post '/api/orders', params: order_params }

  it('creates new order') { expect(response).to have_http_status(:created) }
  it('returns order id') { expect(response.parsed_body['id']).to be_present }
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe 'POST /api/orders' do
  let(:order_params) { attributes_for(:order) }
  before { post '/api/orders', params: order_params }

  it('creates new order') { expect(response).to have_http_status(:created) }
  it('returns order id') { expect(response.parsed_body['id']).to be_present }
end
```

**–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:**

- –ó–Ω–∞—á–µ–Ω–∏—è `customer_email`, `total`, `currency`, `status` –Ω–µ –≤–∞–∂–Ω—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ "API —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑"
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ: —Ç–µ –∂–µ –∞—Ç—Ä–∏–±—É—Ç—ã —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `factory :order`
- –ß–∏—Ç–∞—Ç–µ–ª—å –≤—ã–Ω—É–∂–¥–µ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∞—Ç—Ä–∏–±—É—Ç, —Ö–æ—Ç—è –æ–Ω–∏ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ñ–∞–±—Ä–∏–∫–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∏ —Ç–µ—Å—Ç

**–¢–µ–ø–µ—Ä—å:**

- –ß–∏—Ç–∞—Ç–µ–ª—å —Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç: "–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–∫–∞–∑–∞"
- –ù–µ –Ω—É–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–∂–¥—É —Ñ–∞–±—Ä–∏–∫–æ–π –∏ —Ç–µ—Å—Ç–æ–º
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤ —Ñ–∞–±—Ä–∏–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ —Ç–µ—Å—Ç—É

#### –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤

–ï—Å–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ **–≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è**, –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –µ–≥–æ —è–≤–Ω–æ:

```ruby
# —Ö–æ—Ä–æ—à–æ: —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —á—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º b2b-—Å–µ–≥–º–µ–Ω—Ç
describe 'POST /api/orders' do
  let(:order_params) { attributes_for(:order, segment: 'b2b', discount: 0.15) }
  before { post '/api/orders', params: order_params }

  it('applies b2b pricing') { expect(Order.last.pricing_tier).to eq('corporate') }
  it('applies 15% discount') { expect(Order.last.final_total).to eq(order_params[:total] * 0.85) }
end
```

–ó–¥–µ—Å—å `segment: 'b2b'` –∏ `discount: 0.15` ‚Äî –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –ø–æ—ç—Ç–æ–º—É –æ–Ω–∏ —è–≤–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã.

#### –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ç—Ä–µ–π—Ç–∞–º–∏

```ruby
# —Ö–æ—Ä–æ—à–æ: —Ç—Ä–µ–π—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
describe 'POST /api/orders' do
  let(:order_params) { attributes_for(:order, :international, :with_insurance) }

  before { post '/api/orders', params: order_params }

  it('includes customs declaration') { expect(Order.last.customs_required?).to be true }
end
```

–¢—Ä–µ–π—Ç—ã `:international` –∏ `:with_insurance` —è—Å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∑–∞–∫–∞–∑–∞ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –¥–µ—Å—è—Ç–∫–∏ –∞—Ç—Ä–∏–±—É—Ç–æ–≤.

#### –î—Ä—É–≥–∏–µ use cases

`attributes_for` –ø–æ–ª–µ–∑–µ–Ω –≤–µ–∑–¥–µ, –≥–¥–µ –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ö—ç—à–∞–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:

**Form Objects:**

```ruby
describe OrderForm do
  let(:form_params) { attributes_for(:order) }
  let(:form) { described_class.new(form_params) }

  it('validates successfully') { expect(form).to be_valid }
end
```

**Service Objects:**

```ruby
describe OrderCreationService do
  let(:order_params) { attributes_for(:order) }

  it('creates order record') { expect { described_class.call(order_params) }.to change(Order, :count).by(1) }
end
```

#### –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `attributes_for`

‚ùå **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –∫–æ–≥–¥–∞:**

**–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å API –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –º–æ–¥–µ–ª–∏** ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –∏–º–µ—é—Ç –¥—Ä—É–≥–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```ruby
# –ø–ª–æ—Ö–æ: attributes_for –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã –º–æ–¥–µ–ª–∏, –∞ API –æ–∂–∏–¥–∞–µ—Ç –¥—Ä—É–≥–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
describe 'POST /api/orders' do
  let(:order_params) { attributes_for(:order) }  
  # factory –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: { customer_email: '...', total_cents: 15000 }
  # –Ω–æ API –æ–∂–∏–¥–∞–µ—Ç:     { email: '...', amount: 150.0 }

  before { post '/api/orders', params: order_params }

  it('creates new order') { expect(response).to have_http_status(:created) } # —É–ø–∞–¥—ë—Ç: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ: —è–≤–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–≥–ª–∞—Å–Ω–æ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—É
describe 'POST /api/orders' do
  let(:order_params) do
    {
      email: 'user@example.com',      # API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'email', –∞ –º–æ–¥–µ–ª—å 'customer_email'
      amount: 150.0                    # API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 'amount' –≤ —Ä—É–±–ª—è—Ö, –∞ –º–æ–¥–µ–ª—å 'total_cents'
    }
  end

  before { post '/api/orders', params: order_params }

  it('creates new order') { expect(response).to have_http_status(:created) }
  it('maps API params to model attributes') { expect(Order.last).to have_attributes(...) }
end
```

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ç–µ—Å—Ç–∞ —á–∏—Ç–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–±—Ä–∏–∫—É ‚Äî –∑–Ω–∞—á–∏—Ç, –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ª—É—á—à–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å —è–≤–Ω–æ –≤ —Ç–µ—Å—Ç–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `attributes_for` –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –Ω–µ –≤ —É—â–µ—Ä–± —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.

#### 14. –í —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞—Ö (–∫—Ä–æ–º–µ –º–æ–¥–µ–ª–µ–π) –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `build_stubbed`

–Æ–Ω–∏—Ç-—Å–ø–µ–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤, –ø–æ–ª–∏—Ç–∏–∫, presenter'–æ–≤ –∏ form-–æ–±—ä–µ–∫—Ç–æ–≤ –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö. `build_stubbed` —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä–µ–∫—Ç ActiveRecord –±–µ–∑ `INSERT`/`UPDATE`, –Ω–æ —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ `id`, `created_at`, `updated_at` –∏ –∑–∞–ø—Ä–µ—Ç–æ–º –Ω–∞ `save`. –≠—Ç–æ –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç—ã –±—ã—Å—Ç—Ä–µ–µ –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç, —á—Ç–æ –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≥–æ—Ç–æ–≤—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –∞ –Ω–µ —Å—Ç—Ä–æ–∏—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ë–î.

- `build_stubbed` –∏–∑–±–∞–≤–ª—è–µ—Ç –æ—Ç –ª–∏—à–Ω–∏—Ö —Ä–∞—É–Ω–¥-—Ç—Ä–∏–ø–æ–≤ –∫ –ë–î –∏ —É—Å–∫–æ—Ä—è–µ—Ç –ø–∞–∫–µ—Ç –º–æ–¥—É–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.
- –û–±—ä–µ–∫—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å: –µ—Å–ª–∏ –∫–æ–¥ –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã–∑–≤–∞—Ç—å `save`/`reload`, —Ç–µ—Å—Ç —É–ø–∞–¥—ë—Ç –∏ –ø–æ–∫–∞–∂–µ—Ç, —á—Ç–æ –≤—ã –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç–µ –≥—Ä–∞–Ω–∏—Ü—É —É—Ä–æ–≤–Ω—è (–∑–Ω–∞—á–∏—Ç, –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç).
- Stubbed-—ç–∫–∑–µ–º–ø–ª—è—Ä—ã —É–¥–æ–±–Ω–µ–µ –ø–æ–¥–º–µ–Ω—è—Ç—å –≤ doubles: —É –Ω–∏—Ö –µ—Å—Ç—å `id`, –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã callbacks, –ø–æ—ç—Ç–æ–º—É —Ç–µ—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º.

–ö–æ–≥–¥–∞ `build_stubbed` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ —Å—Ç–æ–∏—Ç:

- —Ç–µ—Å—Ç –º–æ–¥–µ–ª–∏ –∏–ª–∏ —Å–∫–æ—É–ø–∞, –≥–¥–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ë–î;
- –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –æ–ø–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ callbacks/—Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–ª–∏ —á–∏—Ç–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ `save`;
- —Ñ–∏—á–∞, –≥–¥–µ –≤–∞–ª–∏–¥–∞—Ü–∏—è/—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å/foreign key –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∏–º–µ–Ω–Ω–æ –ë–î (—Ç–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `create`).

```ruby
# –ø–ª–æ—Ö–æ
describe Orders::Notifier do
  subject(:call) { described_class.call(order) }

  let(:order) { create(:order, total_cents: 25_00, state: :paid) }
  let(:mailer) { instance_double(OrderMailer, deliver_later: true) }

  it 'schedules confirmation email' do
    allow(OrderMailer).to receive(:confirmation).with(order).and_return(mailer)

    expect { call }.not_to change(Order, :count)
    expect(mailer).to have_received(:deliver_later)
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe Orders::Notifier do
  subject(:call) { described_class.call(order) }

  let(:order) { build_stubbed(:order, total_cents: 25_00, state: :paid) }
  let(:mailer) { instance_double(OrderMailer, deliver_later: true) }

  before { allow(OrderMailer).to receive(:confirmation).with(order).and_return(mailer) }

  it 'schedules confirmation email' do
    call
    expect(mailer).to have_received(:deliver_later)
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- `create` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É —Ä–∞–¥–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–º–∏ —Å–µ—Ä–≤–∏—Å —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑—É–µ—Ç—Å—è; —Ç–µ—Å—Ç—ã –∑–∞–º–µ–¥–ª—è—é—Ç—Å—è –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
- –ï—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–µ—Ç `save`/`reload`, —Ç–µ—Å—Ç —ç—Ç–æ–≥–æ –Ω–µ —É–≤–∏–¥–∏—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–±—ä–µ–∫—Ç —É–∂–µ –∂–∏–≤—ë—Ç –≤ –ë–î ‚Äî –º—ã –Ω–µ–∑–∞–º–µ—Ç–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π.

–ß—Ç–æ –¥–∞—ë—Ç —Ö–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä:

- `build_stubbed` —Å–æ–∑–¥–∞—ë—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ë–î, –ø–æ—ç—Ç–æ–º—É —é–Ω–∏—Ç-—Å–ø–µ–∫–∏ –±–µ–≥—É—Ç –±—ã—Å—Ç—Ä–µ–µ –∏ –æ—Å—Ç–∞—é—Ç—Å—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏.
- –ü–æ–ø—ã—Ç–∫–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç –∏–∑ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–¥–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –æ—à–∏–±–∫–æ–π, —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É—è, —á—Ç–æ —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–µ—Ä–µ—à—ë–ª –≥—Ä–∞–Ω–∏—Ü—É —É—Ä–æ–≤–Ω—è –∏ –Ω—É–∂–µ–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç.

–ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ —Ç—Ä–µ–±—É–µ—Ç `save` –∏–ª–∏ —á—Ç–µ–Ω–∏—è –∏–∑ –±–∞–∑—ã, –∑–Ω–∞—á–∏—Ç, –≤—ã —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è ‚Äî –ø–µ—Ä–µ–Ω–µ—Å–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–ª–æ–π –∏–ª–∏ –ø–æ–º–µ–Ω—è–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö.

**–ö–∞–∫ FactoryBot —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- **–¢—Ä–µ–π—Ç—ã** ‚Äî –∏–º—è —Ç—Ä–µ–π—Ç–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç [—Å–æ—Å—Ç–æ—è–Ω–∏–µ](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –º–æ–¥–µ–ª–∏ (`:blocked`, `:verified`) ‚Üí —á–∏—Ç–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è), –Ω–µ –ø–æ–≥—Ä—É–∂–∞—è—Å—å –≤ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏** —Å–ø—Ä—è—Ç–∞–Ω—ã –≤ —Ñ–∞–±—Ä–∏–∫–µ ‚Üí –Ω–µ –Ω—É–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –≤ –≥–æ–ª–æ–≤–µ "–∞ –∑–∞—á–µ–º –∑–¥–µ—Å—å –≤—Å–µ —ç—Ç–∏ –ø–æ–ª—è?"
- **attributes_for** —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–º [–ø–æ–≤–µ–¥–µ–Ω–∏–∏](#–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø–æ–Ω—è—Ç–∏—è) ‚Üí –Ω–µ –Ω—É–∂–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- **build_stubbed** —è–≤–Ω–æ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç "—ç—Ç–æ —é–Ω–∏—Ç-—Ç–µ—Å—Ç" ‚Üí —Å—Ä–∞–∑—É –ø–æ–Ω—è—Ç–µ–Ω —É—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è [—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è)** ‚Üí –≤—Å–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —Ñ–∞–±—Ä–∏–∫–µ, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç –ø—Ä–∞–≤–æ–∫ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞ –Ω–µ –≤ –¥–µ—Å—è—Ç–∫–∞—Ö —Ç–µ—Å—Ç–æ–≤
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –Ω–µ –ª–æ–º–∞—é—Ç —Ç–µ—Å—Ç—ã ‚Üí –º–µ–Ω—å—à–µ –º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ

### 15. –ù–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π—Ç–µ –≤ —Ç–µ—Å—Ç–∞—Ö

–¢–µ—Å—Ç ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∞ –Ω–µ –º–µ—Å—Ç–æ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –º–∏–Ω–∏-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤. –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã—Ö `let`, —Ñ–∞–±—Ä–∏–∫ –∏ helper-–º–µ—Ç–æ–¥–æ–≤ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã —Å –ø—Ä—è–º–æ–π —Ä–∞–±–æ—Ç–æ–π —Å –ë–î, —Ç–µ—Å—Ç –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º –∏ –Ω–∞–¥—ë–∂–Ω—ã–º.

```ruby
# —É–∂–∞—Å–Ω–æ
describe SomeService do
  it 'stores report' do
    result = described_class.call(raw_payload)

    expect(result).to be_success
    expect(find_report(result.id)).to have_attributes(status: 'done', rows: 3)
  end

  private

  def raw_payload
    DB[:reports].insert(name: 'daily', data: '{"rows":[1,2,3]}')
    DB[:reports].where(name: 'daily').first
  end

  def find_report(id)
    DB[:reports].where(id: id).first
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ
describe SomeService do
  let(:report) { create(:report, :daily, :with_rows) }
  subject(:result) { described_class.call(report.payload) }

  it 'stores report' do
    expect(result).to be_success
    expect(report.reload).to have_attributes(status: 'done', rows_count: 3)
  end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å–∫—Ä—ã–≤–∞—é—Ç, –∫–∞–∫ –∑–∞–¥–∞—é—Ç—Å—è —Å–æ—Å—Ç–æ—è–Ω–∏—è: —á–∏—Ç–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ ¬´–≤—ã–ø–æ–ª–Ω–∏—Ç—å¬ª –∫–æ–¥ –≤ –≥–æ–ª–æ–≤–µ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏.
- –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å –ë–î –º–∏–Ω—É–µ—Ç —Ñ–∞–±—Ä–∏–∫–∏/—Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ —Å–æ–∑–¥–∞—ë—Ç –∂—ë—Å—Ç–∫—É—é –ø—Ä–∏–≤—è–∑–∫—É –∫ —Å—Ö–µ–º–µ.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü —Ç–µ—Å—Ç—ã –ª–æ–º–∞—é—Ç—Å—è –º–æ–ª—á–∞ –∏–ª–∏ –¥–∞—é—Ç –Ω–µ—á–∏—Ç–∞–µ–º—ã–µ –æ—à–∏–±–∫–∏.
- –ï—Å–ª–∏ –ø–æ–¥–æ–±–Ω—ã–π —Å—Ç–∏–ª—å –∫–∞–∂–µ—Ç—Å—è —É–¥–æ–±–Ω—ã–º, —ç—Ç–æ —Ç—Ä–µ–≤–æ–∂–Ω—ã–π —Å–∏–≥–Ω–∞–ª: —Ç–∞–∫–∞—è –∑–∞–ø–∏—Å—å —Ç—è–≥–æ—Ç–µ–µ—Ç –∫ assert-style-DSL –≤—Ä–æ–¥–µ minitest. –í RSpec –∂–µ –º—ã –æ–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∞ –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ–º –∫–æ–¥ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞.

–ß—Ç–æ –¥–∞—ë—Ç —Ö–æ—Ä–æ—à–∏–π –ø—Ä–∏–º–µ—Ä:

- `let` —Å —Ñ–∞–±—Ä–∏–∫–æ–π —è–≤–Ω–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É (`report` —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –∏ –¥–∞–Ω–Ω—ã–º–∏), –∞ –Ω–µ SQL-–æ–±—Ö–æ–¥–Ω—ã–µ –ø—É—Ç–∏.
- –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ö–µ–º—ã –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º —Ñ–∞–±—Ä–∏–∫—É ‚Äî —Ç–µ—Å—Ç—ã –æ—Å—Ç–∞—é—Ç—Å—è –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –∏ —Å–ª–µ–¥—É—é—Ç –≥–ª–æ—Å—Å–∞—Ä–∏—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫.

–≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ —Ç–µ—Å–Ω–æ —Å–≤—è–∑–∞–Ω–æ —Å –ø—É–Ω–∫—Ç–∞–º–∏ 1, 7 –∏ 8: –º—ã –æ–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã –ø—Ä–∞–≤–∏–ª–∞ –∏ –¥–µ—Ä–∂–∏–º –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä—è–¥–æ–º —Å –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏–µ–º.

### 16. –Ø–≤–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ DRY

–í BDD-—Ç–µ—Å—Ç–∞—Ö –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –±—ã–ª–æ —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ –ß–¢–û –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è. –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–æ–Ω—è—Ç–Ω–æ—Å—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤–∞–∂–Ω–µ–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞. –ï—Å–ª–∏ extraction –º–µ—Ç–æ–¥–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–µ–ª–∞–µ—Ç —Ç–µ—Å—Ç –º–µ–Ω–µ–µ –æ—á–µ–≤–∏–¥–Ω—ã–º ‚Äî –æ—Å—Ç–∞–≤—å—Ç–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ.

–¢–µ—Å—Ç—ã ‚Äî —ç—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã. –ö–æ–≥–¥–∞ —á–∏—Ç–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç spec-—Ñ–∞–π–ª, –æ–Ω –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –Ω–µ –ø—Ä—ã–≥–∞—è –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤.

–ö–æ–Ω–µ—á–Ω–æ, —ç—Ç–æ –Ω–µ –∑–Ω–∞—á–∏—Ç –æ—Ç–∫–∞–∑ –æ—Ç `let`, —Ñ–∞–±—Ä–∏–∫ –∏–ª–∏ shared contexts ‚Äî –æ–Ω–∏ –∫–∞–∫ —Ä–∞–∑ –ø–æ–º–æ–≥–∞—é—Ç –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ –æ–ø–∏—Å–∞—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏. –ù–æ –µ—Å–ª–∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è —Å–∫—Ä—ã–≤–∞–µ—Ç –≤–∞–∂–Ω—É—é –¥–µ—Ç–∞–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏, –ª—É—á—à–µ –Ω–∞–ø–∏—Å–∞—Ç—å —è–≤–Ω–æ.

**–í–∞–∂–Ω–æ:** –≠—Ç–æ—Ç –ø—É–Ω–∫—Ç —Ç—Ä–µ–±—É–µ—Ç –≤—ã–±–æ—Ä–∞ –∑–æ–ª–æ—Ç–æ–π —Å–µ—Ä–µ–¥–∏–Ω—ã. –í—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –¥–∏—Å–∫—É—Ç–∏—Ä–æ–≤–∞—Ç—å, –≥–¥–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≥—Ä–∞–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ø–æ–ª–µ–∑–Ω–æ–π –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–µ–π –∏ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π —è–≤–Ω–æ—Å—Ç—å—é. –ù–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ ‚Äî —Ä–µ—à–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–º–µ–Ω–∞ –∏ –¥–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–µ–π –∫–æ–º–∞–Ω–¥—ã.

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- **–ï–¥–∏–Ω—ã–π DSL RSpec** ‚Äî –≤—Å–µ –∑–Ω–∞—é—Ç —ç—Ç–æ—Ç —è–∑—ã–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ –Ω—É–∂–Ω–æ –∏–∑—É—á–∞—Ç—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π "–¥–∏–∞–ª–µ–∫—Ç"
- **–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ—Å—Ç–∞—Ö** —Å–æ–∑–¥–∞—ë—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –º–∏–Ω–∏-—è–∑—ã–∫ ‚Üí –∫–æ–º–∞–Ω–¥–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –∏–∑—É—á–∞—Ç—å custom API –∫–∞–∂–¥–æ–≥–æ spec-—Ñ–∞–π–ª–∞
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —ç–∫–æ—Å–∏—Å—Ç–µ–º–æ–π** ‚Äî RSpec DSL –¥–∞—ë—Ç –ø–æ–Ω—è—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏, custom –∫–æ–¥ –≤—ã–¥–∞—ë—Ç –Ω–µ–≤–Ω—è—Ç–Ω—ã–µ –æ—à–∏–±–∫–∏
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞** ‚Äî `let`, —Ñ–∞–±—Ä–∏–∫–∏, –º–∞—Ç—á–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å –ë–î-–ª–æ–≥–∏–∫–æ–π –Ω–∞—Ä—É—à–∞—é—Ç –æ–∂–∏–¥–∞–Ω–∏—è

## –Ø–∑—ã–∫ –æ–ø–∏—Å–∞–Ω–∏—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π

### 17. –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ `context` –∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–µ–π—Å–æ–≤ `it` –≤–º–µ—Å—Ç–µ (–≤–∫–ª—é—á–∞—è `it`) –¥–æ–ª–∂–Ω—ã —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –≤–∞–ª–∏–¥–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ

–û–ø–∏—Å–∞–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π (`describe`/`context`/`it`) –ø–∏—à–∏—Ç–µ –ø–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏: —Ç–∞–∫ –æ—Ç—á—ë—Ç—ã RSpec –æ—Å—Ç–∞—é—Ç—Å—è —á–∏—Ç–∞–µ–º—ã–º–∏ –≤ CI, –∞ –∫–æ–º–∞–Ω–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –µ–¥–∏–Ω—ã–π —è–∑—ã–∫ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è.
–î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤, –±–µ–∑ –ø—Ä–∏–º–µ—Ä–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö.

```ruby
# –æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ
describe "#some_action" do
  context "blocked" do # —á—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –∫–æ–≥–¥–∞, –∫–µ–º? —á—Ç–æ —ç—Ç–æ –≤–æ–æ–±—â–µ –∑–Ω–∞—á–∏—Ç?
    context "month ago" do # –º–µ—Å—è—Ü –Ω–∞–∑–∞–¥ —á—Ç–æ? –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω? —Ç–æ—á–Ω–æ?
      it("true") { test } # —á—Ç–æ –∑–Ω–∞—á–∏—Ç true? –∫–∞–∫ –æ–Ω–æ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è?
    end
  end
end
# –∫–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –æ–Ω –≤–µ—Ä–Ω–µ—Ç –≤–æ—Ç —Ç–∞–∫–æ–µ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
# #some_action user blocked month ago /it/ true

# –∏–¥–µ–∞–ª—å–Ω–æ
describe "#some_action" do
  context "when user is blocked by admin" do # –∑–¥–µ—Å—å –ø–æ–Ω—è—Ç–Ω–æ, –∫—Ç–æ, —á—Ç–æ –∏ —Å –∫–µ–º —Å–¥–µ–ª–∞–ª
    context "and blocking duration is over a month" do # –∞ –∑–¥–µ—Å—å —É–∂–µ –ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ —ç—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –Ω–∞—á–∞—Ç–æ–≥–æ –≤ –ø—Ä–æ—à–ª–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
      it("allows unlocking the user") { test } # –∞–≥–∞, —Ç–µ–ø–µ—Ä—å –≤–æ–æ–±—â–µ –ø–æ–Ω—è—Ç–Ω–æ, –∑–∞—á–µ–º —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –Ω—É–∂–µ–Ω, –≤ —á–µ–º –µ–≥–æ —Ü–µ–Ω–Ω–æ—Å—Ç—å
      # –æ–Ω –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç "–º–æ–∂–Ω–æ –ª–∏ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?"
    end
  end
end
# #some_action when user is blocked by admin and blocking duration is over a month /it/ allows unlocking the user 
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- –ö–æ–Ω—Ç–µ–∫—Å—Ç—ã –Ω–µ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è –≤ —Ü–µ–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ: –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∫—Ç–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏ —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç `month ago`.
- –û–ø–∏—Å–∞–Ω–∏–µ `it("true")` –Ω–µ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏, –ø–æ—ç—Ç–æ–º—É –æ—Ç—á—ë—Ç RSpec –Ω–µ –Ω–µ—Å—ë—Ç —Å–º—ã—Å–ª–∞.

### 18. –û–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ `context` –∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–µ–π—Å–æ–≤ `it` –≤–º–µ—Å—Ç–µ (–≤–∫–ª—é—á–∞—è `it`) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω—ã —Ç–∞–∫, —á—Ç–æ–±—ã –∏—Ö –ø–æ–Ω–∏–º–∞–ª –ª—é–±–æ–π —á–µ–ª–æ–≤–µ–∫

–ó–¥–µ—Å—å –∏–º–µ–µ—Ç—Å—è –≤–≤–∏–¥—É, —á—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–º –∏ –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–º –ø–æ–∑–Ω–∞–Ω–∏—è —á–µ–≥–æ-—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –∏–∑ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.
–í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø—Ä–æ—Å—Ç–æ –¥–∞—Ç—å –≤—Å–µ –æ–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –ª—é–±–æ–º—É —á–µ–ª–æ–≤–µ–∫—É, –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –æ–Ω –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ—á–∏—Ç–∞–≤ –∏—Ö –º–æ–≥ –ø–æ–Ω—è—Ç—å –±–∏–∑–Ω–µ—Å.

```
when user is blocked by admin and blocking duration is over a month /it/ allows unlocking the user
when user is blocked by admin but blocking duration is under a month /it/ does NOT allow unlocking the user
```

–≤–ø–æ–ª–Ω–µ –ø–æ–Ω—è—Ç–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –º–µ–Ω–µ–µ –º–µ—Å—è—Ü–∞ –Ω–∞–∑–∞–¥ –Ω–µ–ª—å–∑—è.

### 19. –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ –≤ describe/context/it

–ú—ã –æ–ø–∏—Å—ã–≤–∞–µ–º —É—Å—Ç–æ–π—á–∏–≤–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã, –ø–æ—ç—Ç–æ–º—É —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –¥–æ–ª–∂–Ω—ã –∑–≤—É—á–∞—Ç—å –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏, –∞ –Ω–µ –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫—É.

1. **Present Simple.** –ü–æ–≤–µ–¥–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–µ—Ä–Ω—ã–º –≤—Å–µ–≥–¥–∞, –ø–æ—ç—Ç–æ–º—É –≥–æ–≤–æ—Ä–∏–º –æ –Ω–µ–º –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º –≤—Ä–µ–º–µ–Ω–∏: `it 'returns the summary'`. –ù–∞—Å—Ç–æ—è—â–µ–µ –ø—Ä–æ—Å—Ç–æ–µ –≤—Ä–µ–º—è –¥–µ–ª–∞–µ—Ç —Ñ—Ä–∞–∑—É —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –∏ —É–±–∏—Ä–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏.
2. **–ê–∫—Ç–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥ –≤ `it`, —Ç—Ä–µ—Ç—å–µ –ª–∏—Ü–æ.** –°—É–±—ä–µ–∫—Ç–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –≤—ã—Å—Ç—É–ø–∞–µ—Ç –æ–±—ä–µ–∫—Ç —Å–∏—Å—Ç–µ–º—ã: `order generates invoice`, `service authenticates user`. –¢–∞–∫ —á–∏—Ç–∞—é—â–∏–π –ø–æ–Ω–∏–º–∞–µ—Ç, –∫—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ, –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ—Å—Ç–∞–µ—Ç—Å—è –∫–æ—Ä–æ—Ç–∫–∏–º.
3. **–ü–∞—Å—Å–∏–≤–Ω—ã–π –∑–∞–ª–æ–≥ –∏ –≥–ª–∞–≥–æ–ª—ã-—Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤.** –ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–¥–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏, –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ñ–æ—Ä–º—É `is/are + V3` –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–æ —Å—Ç–∞—Ç–∏—á–Ω—ã–º –≥–ª–∞–≥–æ–ª–æ–º: `when user is blocked`, `when account has balance`. –¢–∞–∫ –º—ã —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ñ–∞–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è, –∞ –Ω–µ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∫ –Ω–µ–º—É –ø—Ä–∏–≤–µ–ª–æ.
4. **Zero conditional –¥–ª—è —Å–≤—è–∑–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.** –í –ø–∞—Ä–µ `context/it` –æ–±–µ —á–∞—Å—Ç–∏ –æ—Å—Ç–∞—é—Ç—Å—è –≤ Present Simple: `when payment is confirmed, it issues receipt`. –¢–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ ¬´–µ—Å–ª–∏ ‚Ä¶ —Ç–æ ‚Ä¶¬ª –±–µ–∑ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–¥–≤–∏–≥–æ–≤.
5. **–ë–µ–∑ –º–æ–¥–∞–ª—å–Ω—ã—Ö –≥–ª–∞–≥–æ–ª–æ–≤ –∏ –ª–∏—à–Ω–∏—Ö —Å–ª–æ–≤.** –ò–∑–±–µ–≥–∞–µ–º `should`, `can`, `must` –∏ –≤–≤–æ–¥–Ω—ã—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π (`it should`, `it is expected that`). –û—Å—Ç–∞–µ—Ç—Å—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è ‚Äî –æ–Ω–∞ –∫–æ—Ä–æ—á–µ –∏ –ª—É—á—à–µ –ª–æ–∂–∏—Ç—Å—è –≤ –æ—Ç—á–µ—Ç—ã.
6. **–Ø–≤–Ω–æ–µ –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ `NOT`.** –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤—ã–¥–µ–ª—è–µ–º –∫–∞–ø—Å–æ–º: –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö ‚Äî `when user is NOT verified`, –≤ –ø—Ä–∏–º–µ—Ä–∞—Ö ‚Äî `it 'does NOT unlock user'`. –¢–∞–∫ –≤ –æ—Ç—á–µ—Ç–µ —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, —á—Ç–æ –ø–∞–¥–∞–µ—Ç –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π –∫–µ–π—Å.

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω: –æ–±—ä–µ–∫—Ç –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É –æ–ø–∏—Å—ã–≤–∞–µ–º –≤ `describe`, –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî —á–µ—Ä–µ–∑ `context` –≤ –ø–∞—Å—Å–∏–≤–Ω–æ–º –∑–∞–ª–æ–≥–µ, –æ–∂–∏–¥–∞–µ–º—É—é —Ä–µ–∞–∫—Ü–∏—é ‚Äî —á–µ—Ä–µ–∑ `it` –≤ –∞–∫—Ç–∏–≤–Ω–æ–º Present Simple.

```ruby
describe OrderMailer do
  context 'when invoice is generated' do
    it 'sends the invoice email'
  end
end
```

### 20. –Ø–∑—ã–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤: when / with / and / without / but / NOT

–°–ª–µ–¥—É–µ–º –ª–æ–≥–∏–∫–µ Gherkin, —á—Ç–æ–±—ã –≤–µ—Ç–∫–∞ —á–∏—Ç–∞–ª–∞—Å—å –∫–∞–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É—Ç–æ—á–Ω–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ö–∞–∂–¥–∞—è —Å–≤—è–∑–∫–∞ –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–∏–ø—É —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —É—Ä–æ–≤–Ω—é –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏.

- **`when ‚Ä¶`** ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Ç–∫—É –∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏. –ù–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ —á–∞—Å—Ç–æ –Ω–µ—Ç `it`, –ø–æ—Ç–æ–º—É —á—Ç–æ –¥–∞–ª—å—à–µ –≤–µ—Ç–∫–∞ —É—Ç–æ—á–Ω—è–µ—Ç—Å—è. –ü—Ä–∏–º–µ—Ä: `context 'when user has a payment card' do ‚Ä¶ end`.
- **`with ‚Ä¶`** ‚Äî –≤–≤–æ–¥–∏—Ç –ø–µ—Ä–≤–æ–µ —É—Ç–æ—á–Ω—è—é—â–µ–µ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç happy path: `context 'with verified email'`.
- **`and ‚Ä¶`** ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –µ—â—ë –æ–¥–Ω–æ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ —Ç–æ–º –∂–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥—Ä—è–¥, –ø–æ–∫–∞ –≤–µ—Ç–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è —á–∞—Å—Ç—å—é happy path: `context 'and balance covers the price'`.
- **`without ‚Ä¶`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫, –∫–æ–≥–¥–∞ —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–µ –ø–æ–ª—è—Ä–Ω–æ—Å—Ç–∏. Happy path –æ–ø–∏—Å–∞–Ω –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º, –ø–æ—ç—Ç–æ–º—É –≤–µ—Ç–∫–∞ `without ‚Ä¶` —Å—Ä–∞–∑—É —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ—Å—Ç, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∏—Å—Ö–æ–¥: `context 'without verified email' do ‚Ä¶ end`.
- **`but ‚Ä¶`** ‚Äî –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ happy path. –ß–∞—Å—Ç–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è, –∫–æ–≥–¥–∞ happy path –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–æ—Ç–¥–µ–ª—å–Ω—ã–π `with`-–∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –Ω—É–∂–µ–Ω). –ö–æ–Ω—Ç–µ–∫—Å—Ç `but ‚Ä¶` –æ–±—è–∑–∞–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–µ—Å—Ç, –ø–æ–∫–∞–∑—ã–≤–∞—é—â–∏–π, –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è: `context 'but balance does NOT cover the price'`.
- **`NOT`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–ø—Å–æ–º –≤–Ω—É—Ç—Ä–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ `it`, —á—Ç–æ–±—ã –ø–æ–¥—á–µ—Ä–∫–Ω—É—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–∏–Ω–∞—Ä–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –ª–∏–±–æ –≤—ã–¥–µ–ª–∏—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç: `context 'when user does NOT have a payment card'`, `it 'does NOT charge the card'`.
- –ï—Å–ª–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏ `it` –ø–æ—è–≤–ª—è–µ—Ç—Å—è `when`/`with`/`and`/`without`/`but`, –∑–Ω–∞—á–∏—Ç, –≤—ã –ø–æ—Ç–µ—Ä—è–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç. –í—ã–Ω–µ—Å–∏—Ç–µ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ `context`, –∏–Ω–∞—á–µ –ø—Ä–∏–º–µ—Ä –±—É–¥–µ—Ç —Å–º–µ—à–∏–≤–∞—Ç—å Given –∏ Then –∏ –Ω–∞—Ä—É—à–∏—Ç –ø—Ä–∞–≤–∏–ª–∞ 1‚Äì7. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ —Å `does NOT`, –≥–¥–µ `NOT` –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ –Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ –≤–µ—Ç–∫–∏: `when` ‚Üí `with` ‚Üí `and` (–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏) ‚Üí `but`/`without` ‚Üí `it`. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä: happy path –∏–ª–∏ corner case.

```ruby
describe '#charge' do
  context 'when user has a payment card' do                      # –±–∞–∑–æ–≤–∞—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞
    context 'with verified email' do                            # happy path —É—Ç–æ—á–Ω–µ–Ω–∏–µ
      context 'and balance covers the price' do                 # –µ—â—ë –æ–¥–Ω–æ happy path —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        it 'charges the card'                                   # happy path case
      end

      context 'but balance does NOT cover the price' do         # corner case: –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
        it 'does NOT charge the card'                           # –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç
      end
    end

    context 'without verified email' do                         # corner case: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
      it 'does NOT charge the card'
    end
  end

  context 'when user does NOT have a payment card' do           # –¥—Ä—É–≥–∞—è –≤–µ—Ç–∫–∞ –¥–ª—è –±–∏–Ω–∞—Ä–Ω–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
    it 'does NOT charge the card'
  end
end
```

–°–ª–µ–¥–∏—Ç–µ, —á—Ç–æ–±—ã happy path –≤–µ—Ç–∫–∞ —à–ª–∞ –ø–µ—Ä–≤–æ–π –Ω–∞ —Å–≤–æ—ë–º —É—Ä–æ–≤–Ω–µ, –∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã —Å `without`/`but` –ª–æ–≥–∏—á–µ—Å–∫–∏ —Å—Å—ã–ª–∞–ª–∏—Å—å –Ω–∞ –Ω–µ—ë: ¬´–∫–æ–≥–¥–∞ –≤—Å—ë —Ö–æ—Ä–æ—à–æ ‚Üí —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç; –Ω–æ –µ—Å–ª–∏ –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ª–æ–º–∞–µ—Ç—Å—è ‚Üí –∫–∞–∫ –º–µ–Ω—è–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª.

–ò–Ω–æ–≥–¥–∞ happy path —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ –∑–Ω–∞—á–µ–Ω–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π `with`-–∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–µ –Ω—É–∂–µ–Ω ‚Äî –ø—Ä–∏–º–µ—Ä –º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É –ø–æ–¥ `when`. Corner case –≤—Å—ë —Ç–∞–∫ –∂–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `but` –∏–ª–∏ `without` –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ.

```ruby
describe '#authenticate' do
  context 'when account exists' do                        # –±–∞–∑–æ–≤–∞—è –≤–µ—Ç–∫–∞
    it 'signs the user in'                                # happy path —Å—Ä–∞–∑—É –ø–æ–¥ when

    context 'but account is blocked' do                   # corner case –Ω–∞ —Ç–æ–º –∂–µ —É—Ä–æ–≤–Ω–µ
      it 'denies the sign-in'
    end
  end

  context 'when account does NOT exist' do                # –ø—Ä–æ—Ç–∏–≤–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    it 'denies the sign-in'
  end
end
```

### 21. –ò–∑—É—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ rubocop –ø–æ —á–∞—Å—Ç–∏ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è <https://rspec.rubystyle.guide/#naming>

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ—Å—Ç–æ–≤

### 22. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ [any_instance](https://rspec.info/features/3-13/rspec-mocks/old-syntax/any-instance/), allow_any_instance_of, expect_any_instance_of

–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —ç—Ç–æ "–∑–∞–ø–∞—Ö" –∫ —Ç–æ–º—É, —á—Ç–æ –≤—ã –Ω–µ —Å–ª–µ–¥—É–µ—Ç–µ `dependency inversion principle`,
–∏–ª–∏, —á—Ç–æ –≤–∞—à –∫–ª–∞—Å—Å –Ω–µ —Å–ª–µ–¥—É–µ—Ç `single responsibility` –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤ —Å–µ–±–µ –∫–æ–¥ –¥–ª—è –¥–≤—É—Ö –∞–∫—Ç–æ—Ä–æ–≤,
–∫–æ—Ç–æ—Ä—ã–µ –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –∑–∞–≤–∏—Å—è—Ç –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞ –≤ –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–º –ø–æ—Ä—è–¥–∫–µ.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤–∞—à –∫–ª–∞—Å—Å –º–æ–∂–Ω–æ —Ä–∞–∑–±–∏—Ç—å –Ω–∞ –¥–≤–∞ –∫–ª–∞—Å—Å–∞ –ø–æ–º–µ–Ω—å—à–µ, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –º–æ–∂–Ω–æ –ø–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ –∏—Ö –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö.
–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç–∏ —Ä–∞–¥–∏, —Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–æ–º—É –ø—Ä–∞–≤–∏–ª—É –Ω–µ –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ —É –≤–∞—Å –Ω–∞–∫–æ–ø–∏–ª—Å—è –≥–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥, –ø–æ—ç—Ç–æ–º—É —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è.

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–æ–º, –ø–æ—á–µ–º—É –µ–≥–æ –Ω–µ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, —á–∏—Ç–∞–π—Ç–µ –∑–¥–µ—Å—å <https://rspec.info/features/3-13/rspec-mocks/working-with-legacy-code/any-instance/>.

```ruby
# –ø–ª–æ—Ö–æ: allow_any_instance_of –≥–ª–æ–±–∞–ª—å–Ω–æ –º–æ–∫–∞–µ—Ç –≤—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã
describe HighLevelClass do
   before do
      allow_any_instance_of(LowLevelClass).to receive(:foo).and_return({some_key: :some_value})
   end

   it "returns the processed value" do
      expect(HighLevelClass.new.some_method).to eq(:some_expected_value)
   end
end

# —Ö–æ—Ä–æ—à–æ: –∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
describe HighLevelClass do
   let(:low_level_dependency) { instance_double(LowLevelClass) }
   subject(:instance) { described_class.new(low_level_dependency) }

   before do
      allow(low_level_dependency).to receive(:foo).and_return({some_key: :some_value})
      # —Ç–µ–ø–µ—Ä—å –º—ã –ø—Ä–æ—Å—Ç–æ —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤–µ—Ä–Ω—É—Ç—å –Ω—É–∂–Ω–æ–µ –Ω–∞–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ–¥–Ω–æ–º—É instance double
      # –ø—Ä–∏—á–µ–º –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Ç–∞–∫–æ–π –º–µ—Ç–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å —É –¥–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
   end

   it "returns the processed value" do
      expect(instance.some_method).to eq(:some_expected_value)
   end
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- `allow_any_instance_of` –≥–ª–æ–±–∞–ª—å–Ω–æ –ø–æ–¥–º–µ–Ω—è–µ—Ç –º–µ—Ç–æ–¥ `foo` –∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –≤—Å–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–ª–∞—Å—Å–∞, –∏–∑-–∑–∞ —á–µ–≥–æ —Ç–µ—Å—Ç –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –±—ã—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–º.
- –ö–ª–∞—Å—Å –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —è–≤–Ω–æ, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø—Ä–æ–±–∏–≤–∞—Ç—å –º–æ–∫ —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –≤–Ω–µ–¥—Ä–∏—Ç—å –µ–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

### 23. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `:aggregate_failures` —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–¥–∏–Ω `it` —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–¥–Ω—É –ø—Ä–æ–≤–µ—Ä–∫—É. `:aggregate_failures` –ø–æ–ª–µ–∑–µ–Ω, –∫–æ–≥–¥–∞ –º—ã –≥–æ–≤–æ—Ä–∏–º –æ–± –æ–¥–Ω–æ–º –ø–æ–≤–µ–¥–µ–Ω–∏–∏ –∏ —Ö–æ—Ç–∏–º —É–≤–∏–¥–µ—Ç—å –≤—Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—Ä–∞–∑—É, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ —É–ø–∞–≤—à–µ–µ –æ–∂–∏–¥–∞–Ω–∏–µ.

**–ö–ª—é—á–µ–≤–æ–π –ø—Ä–∏–Ω—Ü–∏–ø:** –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `:aggregate_failures` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –æ–∂–∏–¥–∞–Ω–∏—è –æ–ø–∏—Å—ã–≤–∞—é—Ç –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –±–∏–∑–Ω–µ—Å-–∏—Å—Ö–æ–¥ –∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ù–µ –ø—Ä–∏–º–µ–Ω—è–π—Ç–µ —Ñ–ª–∞–≥, —á—Ç–æ–±—ã —Å–ø—Ä—è—Ç–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º `it` ‚Äî —Ç–∞–∫ –≤—ã –Ω–∞—Ä—É—à–∞–µ—Ç–µ –ø—Ä–∞–≤–∏–ª–æ 3.

#### –ó–∞—á–µ–º –Ω—É–∂–µ–Ω `:aggregate_failures`: –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ë–µ–∑ `:aggregate_failures` RSpec –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —É–ø–∞–≤—à–µ–º –æ–∂–∏–¥–∞–Ω–∏–∏. –≠—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–∏–π —Ü–∏–∫–ª –æ—Ç–ª–∞–¥–∫–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: [Flaky-—Ç–µ—Å—Ç—ã](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è), –∫–æ—Ç–æ—Ä—ã–µ –ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –≤ CI**

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ: —É –≤–∞—Å –µ—Å—Ç—å —Ç–µ—Å—Ç API-—ç–Ω–¥–ø–æ–∏–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω–æ–≥–¥–∞ –ø–∞–¥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ CI-–æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–ø—Ä–æ–±–ª–µ–º—ã —Å —Ç–∞–π–º–∏–Ω–≥–∞–º–∏, race conditions, –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö). –õ–æ–∫–∞–ª—å–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, –∏ –∫–∞–∂–¥–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è –æ—Ç–ª–∞–¥–∫–∏ —á–µ—Ä–µ–∑ CI –∑–∞–Ω–∏–º–∞–µ—Ç 10-15 –º–∏–Ω—É—Ç.

```ruby
# –±–µ–∑ aggregate_failures
it 'returns order details' do
  get "/api/orders/#{order.id}"
  
  expect(response).to have_http_status(:ok)           # ‚úÖ –ø—Ä–æ—à–ª–æ
  expect(response.content_type).to match(/json/)      # ‚úÖ –ø—Ä–æ—à–ª–æ
  expect(response.parsed_body['id']).to eq(order.id)  # ‚ùå –ü–ê–î–ï–ù–ò–ï: nil –≤–º–µ—Å—Ç–æ order.id
  # –¢–µ—Å—Ç –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∑–¥–µ—Å—å. –í—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ –ø—Ä–æ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  expect(response.parsed_body['status']).to eq('pending')
  expect(response.parsed_body['total']).to eq(150.0)
  expect(response.parsed_body['customer_email']).to be_present
end
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. CI –ø–∞–¥–∞–µ—Ç: "expected order.id, got nil"
2. –í–∏–¥—è —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –æ—à–∏–±–∫—É, –≤—ã –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç–µ: "–Ω–∞–≤–µ—Ä–Ω–æ–µ, –ø—Ä–æ–±–ª–µ–º–∞ —Å ID –≤ –º–∞—Ä—à—Ä—É—Ç–µ". –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è `order.id`, –ø—É—à–∏—Ç–µ, –∂–¥—ë—Ç–µ 15 –º–∏–Ω—É—Ç
3. CI –ø–∞–¥–∞–µ—Ç —Å–Ω–æ–≤–∞: "expected 'pending', got nil" ‚Äî –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, `status` —Ç–æ–∂–µ `nil`. –¢–µ–ø–µ—Ä—å –¥—É–º–∞–µ—Ç–µ: "–º–æ–∂–µ—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –≤ scope –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞?"
4. –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ scope, –ø—É—à–∏—Ç–µ, –∂–¥—ë—Ç–µ –µ—â—ë 15 –º–∏–Ω—É—Ç
5. CI –ø–∞–¥–∞–µ—Ç: "expected 150.0, got nil" ‚Äî –∏ `total` —Ç–æ–∂–µ —Å–ª–æ–º–∞–Ω. –ù–∞–∫–æ–Ω–µ—Ü –ø–æ–Ω–∏–º–∞–µ—Ç–µ: –≤–µ—Å—å —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
6. **–ò—Ç–æ–≥–æ: 45+ –º–∏–Ω—É—Ç –ø–æ—Ç—Ä–∞—á–µ–Ω–æ + 2 –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑-–∑–∞ –Ω–µ–ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**

**–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ–ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:** –í–∏–¥—è —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ –ø–∞–¥–µ–Ω–∏–µ, –≤—ã –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç–µ –º–∞—Å—à—Ç–∞–± –ø—Ä–æ–±–ª–µ–º—ã. –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã —Å—Ä–∞–∑—É —É–≤–∏–¥–µ—Ç—å "–≤–µ—Å—å `parsed_body` –ø—É—Å—Ç–æ–π ‚Üí —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä —Å–ª–æ–º–∞–Ω", –≤—ã —Ä–µ—à–∞–µ—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (`id`, –ø–æ—Ç–æ–º `status`, –ø–æ—Ç–æ–º `total`), –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Å–∏–º–ø—Ç–æ–º—ã –æ–¥–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø—Ä–∏—á–∏–Ω—ã. –ù–µ–ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤–µ–¥—ë—Ç –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–µ –∏ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º. –ö–∞–∫ –≥–æ–≤–æ—Ä–∏—Ç—Å—è, –∑–Ω–∞–Ω–∏–µ ‚Äî —Å–∏–ª–∞.

```ruby
# —Å aggregate_failures
it 'returns order details', :aggregate_failures do
  get "/api/orders/#{order.id}"
  
  expect(response).to have_http_status(:ok)
  expect(response.content_type).to match(/json/)
  expect(response.parsed_body['id']).to eq(order.id)
  expect(response.parsed_body['status']).to eq('pending')
  expect(response.parsed_body['total']).to eq(150.0)
  expect(response.parsed_body['customer_email']).to be_present
end
```

**–í—ã–≤–æ–¥ —Å aggregate_failures –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–Å —Å—Ä–∞–∑—É:**

```
Failures:

  1) GET /api/orders/:id returns order details
     Got 4 failures:

     1.1) Failure/Error: expect(response.parsed_body['id']).to eq(order.id)
            expected: 123
                 got: nil

     1.2) Failure/Error: expect(response.parsed_body['status']).to eq('pending')
            expected: "pending"
                 got: nil

     1.3) Failure/Error: expect(response.parsed_body['total']).to eq(150.0)
            expected: 150.0
                 got: nil

     1.4) Failure/Error: expect(response.parsed_body['customer_email']).to be_present
            expected present value
                 got: nil
```

–í—ã **—Å—Ä–∞–∑—É –≤–∏–¥–∏—Ç–µ**, —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –≥–ª–æ–±–∞–ª—å–Ω–∞—è ‚Äî —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –≤–æ–æ–±—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, `parsed_body` –ø—É—Å—Ç–æ–π. –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑, –ø—É—à–∏—Ç–µ, –∂–¥—ë—Ç–µ 15 –º–∏–Ω—É—Ç ‚Äî –≥–æ—Ç–æ–≤–æ. **–≠–∫–æ–Ω–æ–º–∏—è: 30+ –º–∏–Ω—É—Ç.**

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: –¢–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ª—å–∑—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ**

–ò–Ω–æ–≥–¥–∞ —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä–æ–µ —Å–ª–æ–∂–Ω–æ –ø–æ–¥–Ω—è—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ:

- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º —Å–µ—Ä–≤–∏—Å–æ–º (staging-–æ–∫—Ä—É–∂–µ–Ω–∏–µ)
- –°–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (Kubernetes, –æ—Å–æ–±—ã–µ —Å–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- –î–æ—Å—Ç—É–ø –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∏–ª–∏ credentials, –∫–æ—Ç–æ—Ä—ã–µ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –≤ CI

–í —Ç–∞–∫–∏—Ö —Å–ª—É—á–∞—è—Ö –∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ ‚Äî —ç—Ç–æ –∫–æ–º–º–∏—Ç + push + –æ–∂–∏–¥–∞–Ω–∏–µ CI. –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç 6 –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –æ–±—ä–µ–∫—Ç–∞ –∏ –≤—Å–µ —Å–ª–æ–º–∞–Ω—ã, –±–µ–∑ `:aggregate_failures` –≤–∞–º –ø—Ä–∏–¥—ë—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å 6 –∏—Ç–µ—Ä–∞—Ü–∏–π –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π.

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Å –¥–ª–∏—Ç–µ–ª—å–Ω—ã–º–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏, —Ö–æ—Ç—è —Ç–∞–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Ä–µ–¥–∫–æ.

**–ü—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞—Ç—Ä–∏–±—É—Ç—ã –æ–¥–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (–æ–±—ä–µ–∫—Ç, HTTP-–æ—Ç–≤–µ—Ç, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–π) –∏ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –±—ã—Å—Ç—Ä–æ –ø–µ—Ä–µ–∏—Ç–µ—Ä–∏—Ä–æ–≤–∞—Ç—å (CI-only, [flaky](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è)), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `:aggregate_failures`. –≠—Ç–æ —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è –∏ –Ω–µ—Ä–≤—ã –∫–æ–º–∞–Ω–¥—ã.

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `:aggregate_failures`

‚úÖ **–ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –∫–æ–≥–¥–∞:**

1. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –∞—Ç—Ä–∏–±—É—Ç—ã –æ–¥–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ/–ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞** ‚Äî –∞—Ç—Ä–∏–±—É—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Å–º. –ø—Ä–∞–≤–∏–ª–æ 3.1 "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"):

   ```ruby
   # –Ω–æ—Ä–º–∞–ª—å–Ω–æ: aggregate_failures –ø–æ–∫–∞–∂–µ—Ç –≤—Å–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ä–∞–∑—É
   it 'exposes user profile attributes', :aggregate_failures do
     expect(profile.full_name).to eq('John Doe')
     expect(profile.email).to eq('john@example.com')
     expect(profile.account_type).to eq('premium')
   end
   
   # –∏–¥–µ–∞–ª—å–Ω–æ: have_attributes –¥–∞—ë—Ç —Ç–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç + –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ
   it 'exposes user profile attributes' do
     expect(profile).to have_attributes(
       full_name: 'John Doe',
       email: 'john@example.com',
       account_type: 'premium'
     )
   end
   ```

   **–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ `have_attributes`** –∫–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –∞—Ç—Ä–∏–±—É—Ç—ã –æ–±—ä–µ–∫—Ç–∞ ‚Äî –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—Ç–∞–µ–º–µ–µ (—Å–º. –ø—Ä–∞–≤–∏–ª–æ 3.1).

2. **–¢–µ—Å—Ç–∏—Ä—É–µ—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å/–∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±—ä–µ–∫—Ç–∞ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏** ‚Äî –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –µ–¥–∏–Ω–æ–º—É –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—é:

   ```ruby
   # –Ω–æ—Ä–º–∞–ª—å–Ω–æ
   it 'provides shipping address details', :aggregate_failures do
     expect(address.street).to eq('123 Main St')
     expect(address.city).to eq('Springfield')
     expect(address.postal_code).to eq('12345')
     expect(address.country).to eq('USA')
   end
   
   # –∏–¥–µ–∞–ª—å–Ω–æ
   it 'provides shipping address details' do
     expect(address).to have_attributes(
       street: '123 Main St',
       city: 'Springfield',
       postal_code: '12345',
       country: 'USA'
     )
   end
   ```

3. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É HTTP-–æ—Ç–≤–µ—Ç–∞** ‚Äî —Å—Ç–∞—Ç—É—Å, –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è —Ç–µ–ª–∞ –æ—Ç–≤–µ—Ç–∞ –∫–∞–∫ –µ–¥–∏–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç:

   ```ruby
   it 'returns successful response with order data', :aggregate_failures do
     post '/orders', params: order_params
     expect(response).to have_http_status(:created)
     expect(response.content_type).to match(/json/)
     expect(response.parsed_body).to include('id', 'status', 'total')
   end
   ```

4. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è, –≤—ã–≤–µ–¥–µ–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞** ‚Äî –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –∏–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã:

   ```ruby
   it 'calculates order totals correctly', :aggregate_failures do
     expect(order.subtotal).to eq(100.0)
     expect(order.tax).to eq(8.0)
     expect(order.total).to eq(108.0)
   end
   ```

‚ùå **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ô–¢–ï –∫–æ–≥–¥–∞:**

1. **–¢–µ—Å—Ç–∏—Ä—É–µ—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è** ‚Äî –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –±–∏–∑–Ω–µ—Å-—ç—Ñ—Ñ–µ–∫—Ç:

   ```ruby
   # –ø–ª–æ—Ö–æ: –¥–≤–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –ø–æ–≤–µ–¥–µ–Ω–∏—è
   it 'creates order and sends confirmation', :aggregate_failures do
     expect { place_order }.to change(Order, :count).by(1)
     expect { place_order }.to have_enqueued_job(OrderConfirmationJob)
   end
   
   # —Ö–æ—Ä–æ—à–æ: —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
   it 'creates an order' do
     expect { place_order }.to change(Order, :count).by(1)
   end
   
   it 'enqueues confirmation email' do
     expect { place_order }.to have_enqueued_job(OrderConfirmationJob)
   end
   ```

2. **–¢–µ—Å—Ç–∏—Ä—É–µ—Ç–µ —Ä–∞–∑–Ω—ã—Ö –∞–∫—Ç–æ—Ä–æ–≤** ‚Äî –∫–∞–∂–¥—ã–π –∞–∫—Ç–æ—Ä –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:

   ```ruby
   # –ø–ª–æ—Ö–æ: –¥–≤–∞ –∞–∫—Ç–æ—Ä–∞ —Å —Ä–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
   it 'hides notifications', :aggregate_failures do
     expect(admin_notifications).to be_hidden
     expect(user_notifications).not_to be_hidden
   end
   
   # —Ö–æ—Ä–æ—à–æ: –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–∫—Ç–æ—Ä–∞
   context 'for admin' do
     it 'hides admin notifications' do
       expect(admin_notifications).to be_hidden
     end
   end
   
   context 'for regular user' do
     it 'does NOT hide user notifications' do
       expect(user_notifications).not_to be_hidden
     end
   end
   ```

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–î–µ—Ä–∂–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º:** –î–∞–∂–µ —Å —Ñ–ª–∞–≥–æ–º –Ω–∞–∑–≤–∞–Ω–∏–µ `it` –¥–æ–ª–∂–Ω–æ —á—ë—Ç–∫–æ —É–∫–∞–∑—ã–≤–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è. –ò–∑–±–µ–≥–∞–π—Ç–µ –æ–±—â–∏—Ö —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–æ–∫ (`'works correctly'`, `'returns data'`).
- **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–∂–∏–¥–∞–Ω–∏–π:** –ï—Å–ª–∏ –≤ —Ç–µ—Å—Ç–µ –±–æ–ª—å—à–µ 10-15 –æ–∂–∏–¥–∞–Ω–∏–π, –≤–æ–∑–º–æ–∂–Ω–æ –≤—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ ‚Äî –ø–æ–¥—É–º–∞–π—Ç–µ –æ —Ä–∞–∑–±–∏–µ–Ω–∏–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤ –∏–ª–∏ –≤—ã–Ω–µ—Å–µ–Ω–∏–∏ —á–∞—Å—Ç–∏ –ª–æ–≥–∏–∫–∏.
- **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–µ –æ–ø—Ä–∞–≤–¥—ã–≤–∞–µ—Ç —Å–º–µ—à–∏–≤–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏–π:** –î–∞–∂–µ –µ—Å–ª–∏ setup –¥–æ—Ä–æ–≥–æ–π, –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–±—Ä–∏–∫–∏ –∏–ª–∏ –≤—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –≤ `before`, —á–µ–º –ø—Ä—è—Ç–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ –æ–¥–Ω–æ–º `it`.

### –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–∏–Ω—è—Ç–∏—é —Ä–µ—à–µ–Ω–∏—è: –æ–¥–∏–Ω `it` –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ?

–ö–æ–≥–¥–∞ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –æ–¥–∏–Ω —Ç–µ—Å—Ç –∏–ª–∏ —Ä–∞–∑–¥–µ–ª—è—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã:

#### 1. "–ú–æ–∂–Ω–æ –ª–∏ –æ–ø–∏—Å–∞—Ç—å —ç—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –¥–ª—è –Ω–µ—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?"

**–ï—Å–ª–∏ –ù–ï–¢** (—Ç—Ä–µ–±—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) ‚Üí –†–∞–∑–¥–µ–ª—è–π—Ç–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `it`.

–ü—Ä–∏–º–µ—Ä: "–°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑" –∏ "—Å–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ" ‚Äî –Ω—É–∂–Ω—ã –¥–≤–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, —ç—Ç–æ –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –±–∏–∑–Ω–µ—Å–∞.

**–ï—Å–ª–∏ –î–ê** (–æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å—ë) ‚Üí –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –æ–¥–∏–Ω `it` —Å `:aggregate_failures`.

–ü—Ä–∏–º–µ—Ä: "–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è, email –∏ —Ç–∏–ø –∞–∫–∫–∞—É–Ω—Ç–∞" ‚Äî –æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è.

#### 2. "–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ª–∏ –∫–∞–∂–¥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –ø—É—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞?"

**–ï—Å–ª–∏ –î–ê** ‚Üí –†–∞–∑–¥–µ–ª—è–π—Ç–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `it`.

–ü—Ä–∏–º–µ—Ä: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ (`expect { ... }.to change(Order, :count)`) –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email (`expect { ... }.to have_enqueued_job`) –≤—ã–ø–æ–ª–Ω—è—é—Ç —Ä–∞–∑–Ω—ã–µ –≤–µ—Ç–∫–∏ –ª–æ–≥–∏–∫–∏.

**–ï—Å–ª–∏ –ù–ï–¢** ‚Üí –û–¥–∏–Ω `it` —Å `:aggregate_failures`.

–ü—Ä–∏–º–µ—Ä: –í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –ø—Ä–µ–∑–µ–Ω—Ç–µ—Ä–∞ –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∏–∑ –æ–¥–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ `product` ‚Äî –Ω–µ—Ç –≤–µ—Ç–≤–ª–µ–Ω–∏—è, —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö.

#### 3. "–ü—Ä–æ–≤–µ—Ä—è—é –ª–∏ —è —Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞?"

**–ï—Å–ª–∏ –î–ê, —Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–∏** ‚Üí –†–∞–∑–¥–µ–ª—è–π—Ç–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ `it`.

–ü—Ä–∏–º–µ—Ä: `#create_order` –∏ `#send_confirmation` ‚Äî —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

**–ï—Å–ª–∏ –ù–ï–¢, –æ–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** ‚Üí –û–¥–∏–Ω `it` —Å `:aggregate_failures`.

–ü—Ä–∏–º–µ—Ä: –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è –∫ –∞—Ç—Ä–∏–±—É—Ç–∞–º –æ–¥–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞ `#summary` ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—ä–µ–∫—Ç–∞ –≤ –∑–∞–¥–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

#### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

```ruby
# –í–æ–ø—Ä–æ—Å 1: –ú–æ–∂–Ω–æ –ª–∏ –æ–ø–∏—Å–∞—Ç—å —ç—Ç–æ –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º?
# "–°–æ–∑–¥–∞—ë—Ç –∑–∞–∫–∞–∑" + "–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email"
# ‚Üí –ù–ï–¢, –Ω—É–∂–Ω—ã –¥–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è ‚Üí –†–∞–∑–¥–µ–ª—è–µ–º

# ‚ùå –ù–µ –¥–µ–ª–∞–π—Ç–µ —Ç–∞–∫:
it 'processes order', :aggregate_failures do
  expect { place_order }.to change(Order, :count).by(1)
  expect { place_order }.to have_enqueued_job(OrderConfirmationJob)
end

# ‚úÖ –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è:
it 'creates an order' do
  expect { place_order }.to change(Order, :count).by(1)
end

it 'enqueues confirmation email' do
  expect { place_order }.to have_enqueued_job(OrderConfirmationJob)
end

# ‚úÖ –ù–æ –µ—Å–ª–∏ —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
# "–ü—Ä–æ–¥—É–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤–æ–π –∫–∞—Ç–∞–ª–æ–∂–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∏–º—è + —Ü–µ–Ω–∞ + –Ω–∞–ª–∏—á–∏–µ)"
# ‚Üí –î–ê, –æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å—ë ‚Üí –û–±—ä–µ–¥–∏–Ω—è–µ–º

# –Ω–æ—Ä–º–∞–ª—å–Ω–æ
it 'exposes catalog interface', :aggregate_failures do
  expect(product.name).to eq('Laptop')
  expect(product.price).to eq(999.99)
  expect(product.availability).to eq('In Stock')
end

# –∏–¥–µ–∞–ª—å–Ω–æ: have_attributes –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –∏ –¥–∞—ë—Ç —Ç–æ—Ç –∂–µ —ç—Ñ—Ñ–µ–∫—Ç
it 'exposes catalog interface' do
  expect(product).to have_attributes(
    name: 'Laptop',
    price: 999.99,
    availability: 'In Stock'
  )
end
```

```ruby
# –í–æ–ø—Ä–æ—Å 2: –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—É—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è?
# –°–æ–∑–¥–∞–Ω–∏–µ Order –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ Email ‚Äî —Ä–∞–∑–Ω—ã–µ –ø—É—Ç–∏
# ‚Üí –î–ê ‚Üí –†–∞–∑–¥–µ–ª—è–µ–º

it 'creates an order' do
  expect { checkout }.to change(Order, :count).by(1)
end

it 'sends confirmation email' do
  expect { checkout }.to have_enqueued_job(OrderConfirmationJob)
end
```

```ruby
# –í–æ–ø—Ä–æ—Å 3: –û–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ —Ä–∞–∑–Ω—ã–µ?
# AddressPresenter#formatted_address –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ –∞–¥—Ä–µ—Å–∞
# ‚Üí –û–¥–∏–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ‚Üí –û–±—ä–µ–¥–∏–Ω—è–µ–º

# –Ω–æ—Ä–º–∞–ª—å–Ω–æ
it 'formats address with all components', :aggregate_failures do
  expect(presenter.street_line).to eq('123 Main St')
  expect(presenter.city_line).to eq('Springfield, IL')
  expect(presenter.country_line).to eq('USA 12345')
end

# –∏–¥–µ–∞–ª—å–Ω–æ
it 'formats address with all components' do
  expect(presenter).to have_attributes(
    street_line: '123 Main St',
    city_line: 'Springfield, IL',
    country_line: 'USA 12345'
  )
end
```

#### –ë—ã—Å—Ç—Ä—ã–π —á–µ–∫-–ª–∏—Å—Ç

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –†–∞–∑–¥–µ–ª—è—Ç—å | –û–±—ä–µ–¥–∏–Ω—è—Ç—å |
|----------|-----------|------------|
| –ú–æ–∂–Ω–æ –æ–ø–∏—Å–∞—Ç—å –∫–∞–∂–¥—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Ç–¥–µ–ª—å–Ω—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ | ‚úÖ | ‚ùå |
| –ü—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—É—Ç–∏ –∫–æ–¥–∞ | ‚úÖ | ‚ùå |
| –¢–µ—Å—Ç–∏—Ä—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –º–µ—Ç–æ–¥—ã/–ø–æ–≤–µ–¥–µ–Ω–∏—è | ‚úÖ | ‚ùå |
| –í—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞/—Å–æ—Å—Ç–æ—è–Ω–∏—è | ‚ùå | ‚úÖ |
| –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—ä–µ–∫—Ç–∞ (value object, presenter, config) | ‚ùå | ‚úÖ |
| –ü—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –µ–¥–∏–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | ‚ùå | ‚úÖ |

**–ó–æ–ª–æ—Ç–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ï—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç–µ—Å—å ‚Äî —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ. –õ—É—á—à–µ –∏–º–µ—Ç—å –±–æ–ª—å—à–µ —Ç–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤, —á–µ–º –æ–¥–∏–Ω –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π.

### –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –¥–æ/–ø–æ—Å–ª–µ

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∏–ø–∏—á–Ω—ã–µ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –∏—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏.

#### –ü—Ä–∏–º–µ—Ä 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞

‚ùå **Over-splitting (–∏–∑–ª–∏—à–Ω–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ):**

```ruby
describe AppConfig do
  subject(:config) { described_class.new(env_vars) }

  let(:env_vars) do
    {
      'APP_NAME' => 'MyStore',
      'APP_URL' => 'https://mystore.com',
      'SUPPORT_EMAIL' => 'support@mystore.com'
      # ... –µ—â–µ 3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: NOREPLY_EMAIL, MAX_UPLOAD_SIZE, SESSION_TIMEOUT
    }
  end

  it('returns application name from ENV') { expect(config.app_name).to eq('MyStore') }
  it('returns application URL from ENV') { expect(config.app_url).to eq('https://mystore.com') }
  it('returns support email from ENV') { expect(config.support_email).to eq('support@mystore.com') }
  # ... –µ—â–µ 3 –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è noreply_email, max_upload_size, session_timeout
end
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

- 6 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ–¥–Ω–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ: "–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏–∑ ENV"
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –ø—Ä–∏–¥—ë—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –µ—â—ë –æ–¥–∏–Ω —Ç–µ—Å—Ç
- –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç –æ–¥–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (`env_vars`), –Ω–æ —ç—Ç–æ –Ω–µ –æ—Ç—Ä–∞–∂–µ–Ω–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- –ï—Å–ª–∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–º–µ–Ω–∏—Ç—Å—è, –≤—Å–µ 6 —Ç–µ—Å—Ç–æ–≤ —É–ø–∞–¥—É—Ç, —Ö–æ—Ç—è –ø—Ä–æ–±–ª–µ–º–∞ –æ–¥–Ω–∞

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```ruby
describe AppConfig do
  subject(:config) { described_class.new(env_vars) }

  context 'when initialized from environment variables' do
    let(:env_vars) do
      {
        'APP_NAME' => 'MyStore',
        'APP_URL' => 'https://mystore.com',
        'SUPPORT_EMAIL' => 'support@mystore.com'
        # ... –µ—â–µ 3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: NOREPLY_EMAIL, MAX_UPLOAD_SIZE, SESSION_TIMEOUT
      }
    end

    it 'exposes configuration interface from ENV', :aggregate_failures do
      # Application identity
      expect(config.app_name).to eq('MyStore')
      expect(config.app_url).to eq('https://mystore.com')
      
      # ... –µ—â–µ 4 –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è email –∞–¥—Ä–µ—Å–æ–≤ –∏ –ª–∏–º–∏—Ç–æ–≤
    end
  end

  context 'when required ENV variables are missing' do
    let(:env_vars) { {} }

    it 'raises configuration error' do
      expect { config.app_name }.to raise_error(AppConfig::MissingConfigError)
    end
  end
end
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- –û–¥–∏–Ω —Ç–µ—Å—Ç —è—Å–Ω–æ –≤—ã—Ä–∞–∂–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ: "–æ–±—ä–µ–∫—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–∑ ENV"
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è error case –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥—Ä—É–≥–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–≤–∞–ª–∏–¥–∞—Ü–∏—é)
- –ë—ã—Å—Ç—Ä–µ–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è (–æ–¥–∏–Ω setup –≤–º–µ—Å—Ç–æ —à–µ—Å—Ç–∏)
- –õ–µ–≥—á–µ —á–∏—Ç–∞–µ—Ç—Å—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

#### –ü—Ä–∏–º–µ—Ä 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–æ—Ç–≤–µ—Ç–∞

‚ùå **–ò–∑–ª–∏—à–Ω—è—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ —Ö—ç—à–∞):**

```ruby
describe 'GET /api/products/:id' do
  let(:product) { create(:product, name: 'Laptop', price: 999.99, sku: 'LPT-001', stock: 5) }

  it 'returns product details' do
    get "/api/products/#{product.id}"
    
    expect(response.parsed_body).to eq({
      'id' => product.id,
      'name' => 'Laptop',
      'price' => 999.99,
      'sku' => 'LPT-001',
      'stock' => 5
      # ... –µ—â–µ 6 –ø–æ–ª–µ–π: category, created_at, updated_at, description, weight, dimensions
    })
  end
end
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

- –¢–µ—Å—Ç —Å–ª–æ–º–∞–µ—Ç—Å—è –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—è –≤ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä
- –ü—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ (`created_at`, `updated_at`), –Ω–µ –≤–∞–∂–Ω—ã–µ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞
- –ù–µ –ø–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫–∏–µ –ø–æ–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ API
- –¢–µ—Å—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é, –∞ –Ω–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç

‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª–µ–π + —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**

```ruby
describe 'GET /api/products/:id' do
  let(:product) { create(:product, name: 'Laptop', price: 999.99, sku: 'LPT-001') }

  it 'returns product with essential attributes', :aggregate_failures do
    get "/api/products/#{product.id}"
    
    expect(response).to have_http_status(:ok)
    expect(response.parsed_body).to include(
      'id' => product.id,
      'name' => 'Laptop',
      'price' => a_value_within(0.01).of(999.99),
      'sku' => 'LPT-001'
    )
  end

  # –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ rspec-openapi –∏–ª–∏ RSwag
  # (—Å–º. —Ä–∞–∑–¥–µ–ª "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤")
end
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞ –ø–æ–ª—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `include` –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ —Ç–µ—Å—Ç–∞
- `a_value_within` —É—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Float-–∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∏
- –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ API —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ (OpenAPI, JSON Schema)

#### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ª–µ–Ω–∏–≤–æ–≥–æ let

‚ùå **–í—ã–∑–æ–≤ let –≤–Ω—É—Ç—Ä–∏ before (–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω eager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏):**

```ruby
describe OrderProcessor do
  subject(:processor) { described_class.new }

  context 'when products are available in stock' do
    let(:product) { create(:product, stock: 10) }
    let(:order) { create(:order, product: product) }

    before do
      product  # <- –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –¥–ª—è eager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
      order
    end

    it 'processes the order successfully' do
      result = processor.call(order)
      expect(result).to be_success
    end

    it 'decreases product stock' do
      processor.call(order)
      expect(product.reload.stock).to eq(9)
    end
  end
end
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

- `let` —Å–æ–∑–¥–∞–Ω –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (lazy evaluation), –∞ `before` –≤—ã–∑—ã–≤–∞–µ—Ç –∏—Ö –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
- –ù–µ–æ—á–µ–≤–∏–¥–Ω–æ, –∑–∞—á–µ–º –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π `before` –±–ª–æ–∫ ‚Äî —ç—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ø—É—Ç–∞–Ω–∏—Ü—É –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏
- –°–º–µ—à–∏–≤–∞–µ—Ç—Å—è —Ä–æ–ª—å Given (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `let`) —Å —è–≤–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π (—Ä–æ–ª—å `before`)
- –ù–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø —è–≤–Ω–æ—Å—Ç–∏ ‚Äî –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ eager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –¥–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å `let!`

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ let! –¥–ª—è eager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**

```ruby
describe OrderProcessor do
  subject(:processor) { described_class.new }

  context 'when products are available in stock' do
    let!(:product) { create(:product, stock: 10) }
    let!(:order) { create(:order, product: product) }

    it 'processes the order successfully' do
      result = processor.call(order)
      expect(result).to be_success
    end

    it 'decreases product stock' do
      processor.call(order)
      expect(product.reload.stock).to eq(9)
    end
  end
end
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- `let!` —è–≤–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –æ–±—ä–µ–∫—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º (eager evaluation)
- –ú–µ–Ω—å—à–µ –∫–æ–¥–∞, –Ω–µ—Ç –ª–∏—à–Ω–µ–≥–æ `before` –±–ª–æ–∫–∞
- –ò–¥–∏–æ–º–∞—Ç–∏—á–Ω—ã–π RSpec ‚Äî `let!` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–π —Ü–µ–ª–∏
- –°–æ–±–ª—é–¥–∞–µ—Ç—Å—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π –∏–∑ –ø—É–Ω–∫—Ç–∞ 11: `let!` = Given (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö), `before` –æ—Å—Ç–∞—ë—Ç—Å—è –¥–ª—è When (–¥–µ–π—Å—Ç–≤–∏–µ/–æ–ø–µ—Ä–∞—Ü–∏—è)

**–ö–∞–∫ —ç—Ç–æ —Å–Ω–∏–∂–∞–µ—Ç –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É:**
- –í–∏–¥–∏–º –≤—Å–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—Ä–∞–∑—É ‚Üí –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è subject–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞
- –≠–∫–æ–Ω–æ–º–∏—è —Ü–∏–∫–ª–æ–≤ –æ—Ç–ª–∞–¥–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ –≤ CI) ‚Üí –º–µ–Ω—å—à–µ —Ñ—Ä—É—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- –§–ª–∞–≥ `:aggregate_failures` —è–≤–Ω–æ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç "—ç—Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–¥–Ω–æ–≥–æ –ø—Ä–∞–≤–∏–ª–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –∞—Å–ø–µ–∫—Ç–æ–≤"

### 24. –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ verifying doubles (`instance_double`, `class_double`, `object_double`)

`double` —Å–æ–∑–¥–∞—ë—Ç ¬´–∞–Ω–æ–Ω–∏–º–Ω—ã–π¬ª –¥–≤–æ–π–Ω–∏–∫ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–º–æ–∫–∞—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã –∏ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Ä–µ–≥—Ä–µ—Å—Å–∏—é, –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –º–µ–Ω—è–µ—Ç—Å—è. `instance_double`, `class_double` –∏ `object_double` –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –ª–æ–∂–Ω—ã—Ö –∑–µ–ª—ë–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

```ruby
# –ø–ª–æ—Ö–æ
let(:gateway) { double('PaymentGateway', charge: true) }

it 'charges the card' do
  service = Checkout.new(gateway: gateway)
  service.call(order)
  expect(gateway).to have_received(:charge).with(order.total_cents)
end

# —Ö–æ—Ä–æ—à–æ
let(:gateway) { instance_double(PaymentGateway, charge: true) }

it 'charges the card' do
  service = Checkout.new(gateway: gateway)
  service.call(order)
  expect(gateway).to have_received(:charge).with(order.total_cents)
end
```

–ß—Ç–æ –Ω–µ —Ç–∞–∫ –≤ –ø–ª–æ—Ö–æ–º –ø—Ä–∏–º–µ—Ä–µ:

- `double` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±—ã–µ –º–µ—Ç–æ–¥—ã, –ø–æ—ç—Ç–æ–º—É –æ–ø–µ—á–∞—Ç–∫–∞ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–æ–π–¥—É—Ç –Ω–µ–∑–∞–º–µ—á–µ–Ω–Ω—ã–º–∏.
- –¢–µ—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –∑–µ–ª—ë–Ω—ã–º –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω—ã–º `PaymentGateway`, –∏ —Ä–µ–≥—Ä–µ—Å—Å–∏—è –ø–æ–ø–∞–¥—ë—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω.

- `instance_double(SomeClass)` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–µ—Ç–æ–¥—ã —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ `SomeClass`.
- `class_double(SomeClass)` ‚Äî –º–µ—Ç–æ–¥—ã —Å–∞–º–æ–≥–æ –∫–ª–∞—Å—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `.find`, `.call`).
- `object_double(existing_object)` ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (—É–¥–æ–±–Ω–æ –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –≤ —Ç–µ—Å—Ç–µ).

**–ö–æ–≥–¥–∞ verifying double –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è:**

- –ö–ª–∞—Å—Å –∏–ª–∏ –º–æ–¥—É–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ –º–æ–º–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ (`require` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç).
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `method_missing`/`respond_to_missing?`, –∏ –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–µ—Ç —Å–∏–≥–Ω–∞—Ç—É—Ä, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, `OpenStruct`, `Hashie::Mash`).
- –í—ã –º–æ–∫–∞–µ—Ç–µ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç Ruby-–∫–ª–∞—Å—Å–∞ (SOAP/XML API), –∏ —ç–º—É–ª—è—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `Struct.new` –∏–ª–∏ –æ–±—ë—Ä—Ç–∫—É –Ω–∞ –ª–µ—Ç—É.

–í —ç—Ç–∏—Ö —Ä–µ–¥–∫–∏—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö:

- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏—á–∏–Ω—É (`let(:gateway) { double('LegacyGateway') } # –Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞, –º–µ—Ç–æ–¥ –∑–∞–¥–∞—ë—Ç—Å—è –≤ runtime`).
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç —è–≤–Ω—ã–º–∏ `allow(...).to receive(:method)` –∏ –¥–æ–±–∞–≤—å—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä–∏—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ.

–í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –≤—ã–±–∏—Ä–∞–π—Ç–µ verifying doubles ‚Äî —ç—Ç–æ –¥–µ—à—ë–≤—ã–π —Å–ø–æ—Å–æ–± –ø–æ–π–º–∞—Ç—å –æ–ø–µ—á–∞—Ç–∫—É –µ—â—ë –¥–æ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### 25. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ shared examples –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤

`shared_examples` —Å–ª—É–∂–∞—Ç –¥–ª—è –¥–µ–∫–ª–∞—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ ‚Äî –æ–∂–∏–¥–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö. –û–Ω–∏ –Ω–µ –ø—Ä–æ DRY —Ä–∞–¥–∏ —Å–Ω–∏–∂–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ ‚Äî —Ç–µ—Å—Ç—ã –º—ã –Ω–µ ¬´–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–µ–º¬ª (—Å–º. –ø—É–Ω–∫—Ç 15), –æ–Ω–∏ –æ–ø–∏—Å—ã–≤–∞—é—Ç –ø—Ä–∞–≤–∏–ª–∞. –ï—Å–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –≤—ã–Ω–æ—Å–∏—Ç–µ –∏–º–µ–Ω–Ω–æ –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è shared examples:

#### 23.1. –î–ª—è –æ–±—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤

–ö–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Å–æ–≤ —Ä–µ–∞–ª–∏–∑—É—é—Ç –æ–¥–∏–Ω –∫–æ–Ω—Ç—Ä–∞–∫—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∫–ª—é—á–∞—é—Ç –æ–±—â–∏–π –º–æ–¥—É–ª—å), –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ shared examples –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–±—â–µ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è.

- –ù–∞–∑–≤–∞–Ω–∏–µ `shared_examples` —Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —Ñ–æ—Ä–º—É–ª–µ: **`'a/an + [–ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω–æ–µ] + —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–µ [+ —É—Ç–æ—á–Ω–µ–Ω–∏–µ]'`**. –ü—Ä–∏–º–µ—Ä—ã: `'an enumerable resource'`, `'a pageable API'`, `'a collection of orders'`. –¢–∞–∫ –≤ –≤—ã–≤–æ–¥–µ RSpec –≤–∏–¥–Ω–æ, –∫–∞–∫–æ–µ –ø—Ä–∞–≤–∏–ª–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è.
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏: –ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ **"it behaves like [–≤–∞—à–µ_–Ω–∞–∑–≤–∞–Ω–∏–µ]"**. –ï—Å–ª–∏ –∑–≤—É—á–∏—Ç –∫–∞–∫ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–∏—Ç.
  - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ: –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–µ–∑ –∞—Ä—Ç–∏–∫–ª—è (`'sortability'`, `'enumerability'`).
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ `it_behaves_like`/`it_should_behave_like` —Ç–∞–º, –≥–¥–µ –æ–±—ä–µ–∫—Ç —Ä–µ–∞–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç: –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–ª–∞—Å—Å –≤–∫–ª—é—á–∞–µ—Ç –º–æ–¥—É–ª—å —Å –æ–±—â–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ (`Enumerable`, –≤–∞—à `Paginatable` mixin).
- –í–Ω—É—Ç—Ä–∏ shared examples —Ä–∞–±–æ—Ç–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å –ø—É–±–ª–∏—á–Ω—ã–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, –æ–∂–∏–¥–∞—è —Ç–æ –∂–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ–≤–µ—Ä—è–ª –±—ã –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–µ—Å—Ç.

```ruby
# shared_examples: spec/support/shared_examples/paginatable.rb
RSpec.shared_examples 'a pageable API' do
  it('returns the second page') { expect(resource.paginate(page: 2).current_page).to eq 2 }
  it('limits page size') { expect(resource.paginate(page: 1, per_page: 5).items.count).to eq 5 }
end

# –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
describe OrdersQuery do
  subject(:resource) { described_class.new(scope: Order.all) }

  it_behaves_like 'a pageable API'
end

describe UsersQuery do
  subject(:resource) { described_class.new(scope: User.active) }

  it_behaves_like 'a pageable API'
end
```

- Shared example —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç ¬´—á—Ç–æ –∑–Ω–∞—á–∏—Ç –±—ã—Ç—å pageable¬ª, –±–µ–∑ –Ω–µ–ª–µ–ø—ã—Ö ¬´general behaviour¬ª.
- –ö–∞–∂–¥—ã–π –∫–ª–∞—Å—Å, –≤–∫–ª—é—á–∞—é—â–∏–π –º–æ–¥—É–ª—å `Paginatable`, –ø–æ–¥–∫–ª—é—á–∞–µ—Ç shared example –∏ –¥–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è.
- –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É), —Ä–∞—Å—à–∏—Ä—è–µ—Ç–µ shared example ‚Äî –≤—Å–µ –∫–ª–∏–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç.

#### 23.2. –î–ª—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã—Ö –æ–∂–∏–¥–∞–Ω–∏–π –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

–ö–æ–≥–¥–∞ –≤—ã –ø—Ä–æ–≤–µ—Ä—è–µ—Ç–µ –æ–±—ä–µ–∫—Ç —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç–µ –æ–∂–∏–¥–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫), ‚Äî —ç—Ç–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞. –û–Ω–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤—Å–µ–≥–¥–∞, –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

- –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–µ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã—è–≤–ª—è—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ (—Å–º. –ø—É–Ω–∫—Ç 6.2).
- –í—ã–Ω–µ—Å–∏—Ç–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è `it` –≤ `shared_examples` –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∏—Ö –≤ –∫–æ—Ä–Ω–µ–≤–æ–º `describe` –∏–ª–∏ –≤ –∫–∞–∂–¥–æ–º –ª–∏—Å—Ç–æ–≤–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —á–µ—Ä–µ–∑ `it_behaves_like`.
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–∞–∫—Ç: `'valid booking search params'`, `'serializable to JSON'`, `'responds to required methods'`.

–ü—Ä–∏–º–µ—Ä: –∫–ª–∞—Å—Å `BookingSearchValidator` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –æ—Ç–µ–ª–µ–π. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–∏–ø–∞ –∫–ª–∏–µ–Ω—Ç–∞ (b2c/b2b) –∏ —Ä–µ–≥–∏–æ–Ω–∞ –ø–æ–∏—Å–∫–∞ (domestic/international), –æ–Ω –≤—Å–µ–≥–¥–∞ –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø–æ–ª—è–º–∏ `valid?`, `errors`, `normalized_params`.

```ruby
# –ø–ª–æ—Ö–æ: –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è it –≤–æ –≤—Å–µ—Ö –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö
describe BookingSearchValidator do
  subject(:validator) { described_class.new(params, client_type: client_type, region: region) }

  context 'when client is b2c' do
    let(:client_type) { :b2c }

    context 'and region is domestic' do
      let(:region) { :domestic }
      let(:params) { ... } # –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–∏—Å–∫–∞

      it('validates check_in date') { expect(validator.valid?).to be true }
      # ... —Ç–µ –∂–µ —Ç—Ä–∏ it 'responds to' –¥–ª—è valid?, errors, normalized_params
    end

    context 'and region is international' do
      let(:region) { :international }
      let(:params) { ... } # –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

      it('validates international booking rules') { expect(validator.valid?).to be true }
      # ... —Ç–µ –∂–µ —Ç—Ä–∏ it 'responds to' –¥–ª—è valid?, errors, normalized_params
    end
  end

  context 'when client is b2b' do
    let(:client_type) { :b2b }

    context 'and region is domestic' do
      let(:region) { :domestic }
      let(:params) { ... } # –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–∏—Å–∫–∞

      it('applies b2b pricing rules') { expect(validator.normalized_params[:pricing_tier]).to eq('corporate') }
      # ... —Ç–µ –∂–µ —Ç—Ä–∏ it 'responds to' –¥–ª—è valid?, errors, normalized_params
    end

    context 'and region is international' do
      let(:region) { :international }
      let(:params) { ... } # –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

      it('applies international b2b rules') { expect(validator.normalized_params[:requires_passport]).to be true }
      # ... —Ç–µ –∂–µ —Ç—Ä–∏ it 'responds to' –¥–ª—è valid?, errors, normalized_params
    end
  end
end
```

```ruby
# —Ö–æ—Ä–æ—à–æ: –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –≤—ã–Ω–µ—Å–µ–Ω –≤ shared_examples
RSpec.shared_examples 'a booking search validator' do
  it('responds to valid?') { expect(validator).to respond_to(:valid?) }
  it('responds to errors') { expect(validator).to respond_to(:errors) }
  it('responds to normalized_params') { expect(validator).to respond_to(:normalized_params) }
end

describe BookingSearchValidator do
  subject(:validator) { described_class.new(params, client_type: client_type, region: region) }

  context 'when client is b2c' do
    let(:client_type) { :b2c }

    context 'and region is domestic' do
      let(:region) { :domestic }
      let(:params) { { check_in: '2025-11-01', check_out: '2025-11-03', guests: 2 } }

      it_behaves_like 'a booking search validator'

      it 'validates check_in date' do
        expect(validator.valid?).to be true
      end
    end

    context 'and region is international' do
      let(:region) { :international }
      let(:params) { { check_in: '2025-12-01', check_out: '2025-12-05', guests: 1 } }

      it_behaves_like 'a booking search validator'

      it 'validates international booking rules' do
        expect(validator.valid?).to be true
      end
    end
  end

  context 'when client is b2b' do
    let(:client_type) { :b2b }

    context 'and region is domestic' do
      let(:region) { :domestic }
      let(:params) { { check_in: '2025-11-10', check_out: '2025-11-15', guests: 5 } }

      it_behaves_like 'a booking search validator'

      it 'applies b2b pricing rules' do
        expect(validator.normalized_params[:pricing_tier]).to eq('corporate')
      end
    end

    context 'and region is international' do
      let(:region) { :international }
      let(:params) { { check_in: '2026-01-01', check_out: '2026-01-10', guests: 3 } }

      it_behaves_like 'a booking search validator'

      it 'applies international b2b rules' do
        expect(validator.normalized_params[:requires_passport]).to be true
      end
    end
  end
end
```

- –¢—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ `respond_to` –ø–æ–≤—Ç–æ—Ä—è–ª–∏—Å—å –≤–æ –≤—Å–µ—Ö —á–µ—Ç—ã—Ä—ë—Ö –ª–∏—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö ‚Äî —ç—Ç–æ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.
- Shared example `'a booking search validator'` –¥–µ–∫–ª–∞—Ä–∏—Ä—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- –ö–∞–∂–¥—ã–π –ª–∏—Å—Ç–æ–≤–æ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è –µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (b2c/b2b, domestic/international).
- –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `warnings`), –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å shared example, –∏ –≤—Å–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç –Ω–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ shared examples –Ω–µ –æ—Ç–º–µ–Ω—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–∏—Å–∞—Ç—å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã –∏ `it`. –û–Ω–∏ –ø–æ–º–æ–≥–∞—é—Ç –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤, –Ω–æ –Ω–µ –ø–æ–¥–º–µ–Ω—è—é—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.

### 26. –ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–π—Ç–µ Request specs –≤–º–µ—Å—Ç–æ controller specs

Controller specs —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å—Ç–∞—Ä–µ–≤—à–∏–º–∏: Rails core –∏ RSpec core –∫–æ–º–∞–Ω–¥—ã –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é—Ç –ø–∏—Å–∞—Ç—å Request specs, –Ω–∞—á–∏–Ω–∞—è —Å —Ä–µ–ª–∏–∑–∞ RSpec 3.5 –∏ Rails 5.0 ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://rspec.info/blog/2016/07/rspec-3-5-has-been-released/#rails-support-for-rails-5)). Request specs –ø—Ä–æ–≤–µ—Ä—è—é—Ç HTTP-–∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∞ –∑–Ω–∞—á–∏—Ç –æ—Å—Ç–∞—é—Ç—Å—è –±–ª–∏–∂–µ –∫ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é –∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤.

- –î–ª—è –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤ –≤—ã–±–∏—Ä–∞–π—Ç–µ Request specs; —Ç–æ–ª—å–∫–æ –æ–Ω–∏ –ø–æ–∫—Ä—ã–≤–∞—é—Ç —Å—Ç–µ–∫ Rack ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä ‚Üí middleware —Ü–µ–ª–∏–∫–æ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ —É–≤–∏–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç.
- –ï—Å–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å legacy controller specs, –ø–æ–º–µ—á–∞–π—Ç–µ –∏—Ö –∫–∞–∫ –Ω–∞—Å–ª–µ–¥–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `describe SomeController, :legacy`) –∏ –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é. –ü—Ä–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞—Ö —Ä–∞—Å—à–∏—Ä—è–π—Ç–µ –ø–æ –ø–∏—Ä–∞–º–∏–¥–µ: –ø–æ–≤–µ–¥–µ–Ω–∏–µ ‚Äî –≤ Request spec, –º–µ–ª–∫—É—é –ª–æ–≥–∏–∫—É –≤—ã–Ω–æ—Å–∏—Ç–µ –≤ —Å–µ—Ä–≤–∏—Å/–º–æ–¥–µ–ª—å –∏ –ø–æ–∫—Ä—ã–≤–∞–π—Ç–µ —é–Ω–∏—Ç–∞–º–∏.
- –ù–µ –¥—É–±–ª–∏—Ä—É–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫–∏: –µ—Å–ª–∏ –¥–µ–π—Å—Ç–≤–∏–µ —É–∂–µ –æ–ø–∏—Å–∞–Ω–æ –Ω–∞ —É—Ä–æ–≤–Ω–µ Request spec, controller spec –ª–∏—à—å –ø–æ–≤—Ç–æ—Ä–∏—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏ –±—É–¥–µ—Ç –ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤: –≥—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ RSpec

–î–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞–∑–±–æ—Ä –ø–µ—Ä–µ–µ—Ö–∞–ª –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç `guide.api.ru.md`, —á—Ç–æ–±—ã –æ—Å–Ω–æ–≤–Ω–æ–π –≥–∞–π–¥ –æ—Å—Ç–∞–≤–∞–ª—Å—è –∫–æ–º–ø–∞–∫—Ç–Ω—ã–º.

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ RSpec Request specs –¥–ª—è –ø–æ–≤–µ–¥–µ–Ω–∏—è: HTTP-—Å—Ç–∞—Ç—É—Å—ã, –∫–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è –∏ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã.
- –î–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON-–æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (JSON Schema, rswag, Pact) ‚Äî –æ–Ω–∏ –ø—É–±–ª–∏–∫—É—é—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ –Ω–µ –ª–æ–º–∞—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
- –ù–µ –ø—ã—Ç–∞–π—Ç–µ—Å—å —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤ –¥–µ—Å—è—Ç–∫–∞—Ö `expect`: –¥–µ—Ä–∂–∏—Ç–µ –µ–≥–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ, –∞ –≤ RSpec –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–æ–ª—å–∫–æ –Ω–∞–±–ª—é–¥–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞.

[–ü–æ–ª–Ω—ã–π –≥–∞–π–¥ —Å –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –ø–∞–π–ø–ª–∞–π–Ω–æ–º ‚Üí](./guide.api.ru.md)

## –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã

- **HTTP-–∑–∞–ø—Ä–æ—Å—ã.** –†–µ–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤ —Ç–µ—Å—Ç–∞—Ö –∑–∞–ø—Ä–µ—â–µ–Ω—ã: –≤–∫–ª—é—á–∞–π—Ç–µ WebMock (–∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –∏ —è–≤–Ω–æ —Ä–∞–∑—Ä–µ—à–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ —Ç–µ —Ö–æ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —ç–º—É–ª–∏—Ä—É–µ—Ç–µ. –õ—é–±–∞—è –ø–æ–ø—ã—Ç–∫–∞ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤–æ –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ–ª–∂–Ω–∞ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –ø–æ–Ω—è—Ç–Ω–æ–π –æ—à–∏–±–∫–æ–π.
- **–§–∏–∫—Å–∞—Ü–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.** –ï—Å–ª–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª —Å—Ç–∞–±–∏–ª–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ VCR ‚Äî –æ–Ω —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Ñ–ª–µ–π–∫–∏. –ö–æ–≥–¥–∞ –≤–∞–∂–Ω–µ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç –∏ —Å–µ–º–∞–Ω—Ç–∏–∫—É, –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã: Pact –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å ‚Üî –ø–æ—Å—Ç–∞–≤—â–∏–∫, `rspec-openapi` –∏–ª–∏ RSwag –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π OpenAPI-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í –∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –ø–æ–ª—è, –∏–Ω–∞—á–µ –ø–æ–ª—É—á–∏—Ç—Å—è —Ç–µ—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.
- **–û—á–µ—Ä–µ–¥–∏ –∏ —Ñ–æ–Ω–æ–≤—ã–µ –¥–∂–æ–±—ã.** –í —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è—Ö –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ñ–∞–∫—Ç –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (`expect { ... }.to have_enqueued_job`) –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É —Å–∞–º–æ–π –¥–∂–æ–±—ã –≤—ã–Ω–æ—Å–∏—Ç–µ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —é–Ω–∏—Ç-—Ç–µ—Å—Ç: —Ç–∞–º –∑–∞–ø—É—Å–∫–∞–µ–º `perform`/`perform_now` –∏ —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º –¥–æ–º–µ–Ω–∞.

## –ù—é–∞–Ω—Å—ã –≤—Ä–µ–º–µ–Ω–∏ –º–µ–∂–¥—É Ruby –∏ PostgreSQL

- `Date#wday` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0 –¥–ª—è –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ `EXTRACT(DOW FROM ...)` –≤ PostgreSQL –¥–∞—ë—Ç 0 –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º –∏ 1 –ø–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞–º. –°–æ–≤–º–µ—â–∞—è Ruby- –∏ SQL-–ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö, —è–≤–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –æ–∂–∏–¥–∞–µ–º—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –∏ –Ω–µ —Å—Ä–∞–≤–Ω–∏–≤–∞–π—Ç–µ —Ü–∏—Ñ—Ä—ã ¬´–∫–∞–∫ –µ—Å—Ç—å¬ª.
- `Date.current.beginning_of_week` –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è `Rails.application.config.beginning_of_week`, –∞ `date_trunc('week', ...)` –≤ PostgreSQL –ø–æ ISO –≤—Å–µ–≥–¥–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞. –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∞–ª–µ–Ω–¥–∞—Ä—ë–º, –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Ç–µ—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ¬´–ø–µ—Ä–≤—ã–π –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏¬ª —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –∏–Ω–∞—á–µ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å [flaky —Ç–µ—Å—Ç](#—Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏-–∏-—Å–æ—Å—Ç–æ—è–Ω–∏—è) –ø—Ä–∏ —Å–º–µ–Ω–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
- `Date.parse` –∏ `Time.parse` –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç `Time.zone`, —Ç–æ–≥–¥–∞ –∫–∞–∫ ActiveRecord —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `timestamp` –≤ UTC. –í —Ç–µ—Å—Ç–∞—Ö, –≥–¥–µ –≤–∞–∂–Ω–∞ –∑–æ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Time.zone.parse`, `Time.zone.local` –∏ `in_time_zone`, –∞ –æ–∂–∏–¥–∞–Ω–∏—è –≤—ã–Ω–æ—Å–∏—Ç–µ –≤ `Time.zone.at`/`change`.
- –ü–µ—Ä–µ—Ö–æ–¥—ã —á–µ—Ä–µ–∑ –ø–æ–ª–Ω–æ—á—å –∏ DST: PostgreSQL –≤—ã—á–∏—Å–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã UTC-–∑–Ω–∞—á–µ–Ω–∏—è–º–∏, –∞ Ruby –ø—Ä–∏ `travel_to` –º–æ–∂–µ—Ç –ø–æ–ø–∞—Å—Ç—å –≤ ¬´–Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π¬ª —á–∞—Å. –ß—Ç–æ–±—ã –Ω–µ –ª–æ–≤–∏—Ç—å –ø–ª–∞–≤–∞—é—â–∏–µ –ø–∞–¥–µ–Ω–∏—è, —Ñ–∏–∫—Å–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –¥–Ω—è (`travel_to(Time.zone.parse('2024-03-25 12:00'))`) –∏ –ø–∏—à–∏—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥—ã, –µ—Å–ª–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç –∫—Ä–∞–π–Ω–∏–µ —Ç–æ—á–∫–∏.
